<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>ICT第七次笔记 | 总会有地上的生灵 敢于直面雷霆的威光</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="路径控制​      传统的路由转发原理是首先根据报文的目的地址查找路由表，然后进行报文转发。但是目前越来越多的用户希望能够在传统路由转发的基础上根据自己定义的策略进行报文转发和选路。策略路由使网络管理者不仅能够根据报文的目的地址，而且能够根据报文的源地址、报文大小和链路质量等属性来制定策略路由，以改变数据包转发路径，满足用户需求。 拓扑图：  实验要求：源地址为4.4.4.4的数据包走CNC（联">
<meta property="og:type" content="article">
<meta property="og:title" content="ICT第七次笔记">
<meta property="og:url" content="http://lanyangyangy.github.io/2023/01/26/ICT%E7%AC%AC%E4%B8%83%E6%AC%A1%E7%AC%94%E8%AE%B0/index.html">
<meta property="og:site_name" content="总会有地上的生灵 敢于直面雷霆的威光">
<meta property="og:description" content="路径控制​      传统的路由转发原理是首先根据报文的目的地址查找路由表，然后进行报文转发。但是目前越来越多的用户希望能够在传统路由转发的基础上根据自己定义的策略进行报文转发和选路。策略路由使网络管理者不仅能够根据报文的目的地址，而且能够根据报文的源地址、报文大小和链路质量等属性来制定策略路由，以改变数据包转发路径，满足用户需求。 拓扑图：  实验要求：源地址为4.4.4.4的数据包走CNC（联">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://lanyangyangy.github.io/2023/01/26/ICT%E7%AC%AC%E4%B8%83%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221120211946322.png">
<meta property="og:image" content="http://lanyangyangy.github.io/2023/01/26/ICT%E7%AC%AC%E4%B8%83%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221120211946322.png">
<meta property="og:image" content="http://lanyangyangy.github.io/2023/01/26/ICT%E7%AC%AC%E4%B8%83%E6%AC%A1%E7%AC%94%E8%AE%B0/41531.png">
<meta property="og:image" content="http://lanyangyangy.github.io/2023/01/26/ICT%E7%AC%AC%E4%B8%83%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221123184819223.png">
<meta property="og:image" content="http://lanyangyangy.github.io/2023/01/26/ICT%E7%AC%AC%E4%B8%83%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221123235153721.png">
<meta property="og:image" content="http://lanyangyangy.github.io/2023/01/26/ICT%E7%AC%AC%E4%B8%83%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221123232007338.png">
<meta property="og:image" content="http://lanyangyangy.github.io/2023/01/26/ICT%E7%AC%AC%E4%B8%83%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221123232018620.png">
<meta property="og:image" content="http://lanyangyangy.github.io/2023/01/26/ICT%E7%AC%AC%E4%B8%83%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221124000252920.png">
<meta property="og:image" content="http://lanyangyangy.github.io/2023/01/26/ICT%E7%AC%AC%E4%B8%83%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221124000411237.png">
<meta property="article:published_time" content="2023-01-26T04:44:43.000Z">
<meta property="article:modified_time" content="2023-01-28T12:38:06.383Z">
<meta property="article:author" content="懒懒当大厨">
<meta property="article:tag" content="ICT 数通">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://lanyangyangy.github.io/2023/01/26/ICT%E7%AC%AC%E4%B8%83%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221120211946322.png">
  
    <link rel="alternate" href="/atom.xml" title="总会有地上的生灵 敢于直面雷霆的威光" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 6.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">总会有地上的生灵 敢于直面雷霆的威光</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://lanyangyangy.github.io"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-ICT第七次笔记" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/01/26/ICT%E7%AC%AC%E4%B8%83%E6%AC%A1%E7%AC%94%E8%AE%B0/" class="article-date">
  <time class="dt-published" datetime="2023-01-26T04:44:43.000Z" itemprop="datePublished">2023-01-26</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      ICT第七次笔记
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h4 id="路径控制"><a href="#路径控制" class="headerlink" title="路径控制"></a>路径控制</h4><p>​      传统的路由转发原理是首先根据报文的目的地址查找路由表，然后进行报文转发。但是目前越来越多的用户希望能够在传统路由转发的基础上根据自己定义的策略进行报文转发和选路。策略路由使网络管理者不仅能够根据报文的目的地址，而且能够根据报文的源地址、报文大小和链路质量等属性来制定策略路由，以改变数据包转发路径，满足用户需求。</p>
<h5 id="拓扑图："><a href="#拓扑图：" class="headerlink" title="拓扑图："></a>拓扑图：</h5><img src="/2023/01/26/ICT%E7%AC%AC%E4%B8%83%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221120211946322.png" class="" title="image-20221120211946322">

<h5 id="实验要求："><a href="#实验要求：" class="headerlink" title="实验要求："></a>实验要求：</h5><p>源地址为4.4.4.4的数据包走CNC（联通）出网 </p>
<p>源地址为192.168.1.0&#x2F;24的数据包走CT（电信）出网</p>
<h5 id="实验配置："><a href="#实验配置：" class="headerlink" title="实验配置："></a>实验配置：</h5><h6 id="基本配置："><a href="#基本配置：" class="headerlink" title="基本配置："></a>基本配置：</h6><p>除CE，R4外其余IP配置均已完成</p>
<p>配置CE：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[CE]inter g0/0/0</span><br><span class="line">[CE-GigabitEthernet0/0/0]ip add 183.165.11.2 30</span><br><span class="line">[CE]inter g0/0/1</span><br><span class="line">[CE-GigabitEthernet0/0/1]ip add 61.16.18.2 30</span><br><span class="line">[CE]inter g0/0/2</span><br><span class="line">[CE-GigabitEthernet0/0/2]ip add 192.168.1.1 24</span><br><span class="line">[CE]ip route-static 4.4.4.4 32 192.168.1.2    #配置静态路由指向R4环回口</span><br></pre></td></tr></table></figure>

<p>配置NAT：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[CE]acl number 2100 </span><br><span class="line">[CE-acl-basic-2100]rule  permit    #匹配所有流量</span><br><span class="line">[CE]inter g0/0/0</span><br><span class="line">[CE-GigabitEthernet0/0/0]nat outbound 2100</span><br><span class="line">[CE]inter g0/0/1     </span><br><span class="line">[CE-GigabitEthernet0/0/1]nat outbound 2100</span><br></pre></td></tr></table></figure>

<p>AR4 IP配置：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[R4]inter g0/0/0</span><br><span class="line">[R4-GigabitEthernet0/0/0]ip add 192.168.1.2 24</span><br><span class="line">[R4]ip  route-static 0.0.0.0 0.0.0.0 192.168.1.1</span><br><span class="line">[R4]int LoopBack 0					配置环回口地址</span><br><span class="line">[R4-LoopBack0]ip add 4.4.4.4 32  </span><br></pre></td></tr></table></figure>

<h6 id="配置基于接口-策略路由"><a href="#配置基于接口-策略路由" class="headerlink" title="配置基于接口 策略路由"></a>配置基于接口 策略路由</h6><p>使用traffic-class流量分类</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[CE]acl number 2000</span><br><span class="line">[CE-acl-basic-2000]rule permit source 4.4.4.4 0</span><br><span class="line">[CE-acl-basic-2000]rule deny </span><br><span class="line">[CE]acl number 2001 </span><br><span class="line"></span><br><span class="line">[CE-acl-basic-2001]rule  permit source 192.168.1.0 0.0.0.255</span><br><span class="line"></span><br><span class="line">[CE]traffic classifier CT</span><br><span class="line">[CE-classifier-CT]if-match acl 2001</span><br><span class="line"></span><br><span class="line">[CE]traffic classifier CNC</span><br><span class="line">[CE-classifier-CNC]if-match acl 2000</span><br></pre></td></tr></table></figure>

<p>使用traffic-behave设置对应动作</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[CE]traffic behavior CT</span><br><span class="line">[CE-behavior-CT]redirect ip-nexthop 61.16.18.1   //指向电信</span><br><span class="line">[CE]traffic behavior CNC          </span><br><span class="line">[CE-behavior-CNC]redirect ip-nexthop 183.165.11.1 	//指向联通</span><br></pre></td></tr></table></figure>

<p>实验用traffic-polic关联流量和动作</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[CE]traffic policy PBR</span><br><span class="line">[CE-trafficpolicy-PBR]classifier CT behavior CT</span><br><span class="line">[CE-trafficpolicy-PBR]classifier CNC behavior CNC</span><br></pre></td></tr></table></figure>



<p>路由控制步骤：</p>
<ol>
<li>进行分类</li>
<li>设置动作，移动方向</li>
<li>进行关联</li>
</ol>
<h5 id="2、基于链路检测策略路由"><a href="#2、基于链路检测策略路由" class="headerlink" title="2、基于链路检测策略路由"></a>2、基于链路检测策略路由</h5><img src="/2023/01/26/ICT%E7%AC%AC%E4%B8%83%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221120211946322.png" class="" title="image-20221120211946322">

<p>需求：</p>
<p>源地址为4.4.4.4的数据包走CNC（联通）出网，当链路出现故障时候走电信 </p>
<p>源地址为192.168.1.0&#x2F;24的数据包走CT（电信）出网，当链路出现故障时候走联通</p>
<h6 id="配置NQA检测链路："><a href="#配置NQA检测链路：" class="headerlink" title="配置NQA检测链路："></a>配置NQA检测链路：</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[CE]nqa test-instance icmp CT</span><br><span class="line">[CE-nqa-icmp-CT]test-type icmp</span><br><span class="line">[CE-nqa-icmp-CT]source-address ipv4 61.16.18.2 </span><br><span class="line"></span><br><span class="line">[CE-nqa-icmp-CT]destination-address ipv4 61.16.18.1</span><br><span class="line">[CE-nqa-icmp-CT]frequency 20 </span><br><span class="line">[CE-nqa-icmp-CT]probe-count 1</span><br><span class="line">[CE-nqa-icmp-CT]start now </span><br><span class="line"></span><br><span class="line">[CE]nqa test-instance icmp CNC</span><br><span class="line"></span><br><span class="line">[CE-nqa-icmp-CNC]test-type icmp</span><br><span class="line"></span><br><span class="line">[CE-nqa-icmp-CNC]source-address ipv4 183.165.11.2</span><br><span class="line">[CE-nqa-icmp-CNC]destination-address ipv4 183.165.11.1</span><br><span class="line">[CE-nqa-icmp-CNC]frequency 20 </span><br><span class="line"></span><br><span class="line">[CE-nqa-icmp-CNC]probe-count 1</span><br><span class="line">[CE-nqa-icmp-CNC]start now </span><br></pre></td></tr></table></figure>

<h6 id="将NAQ和traffic-behave关联"><a href="#将NAQ和traffic-behave关联" class="headerlink" title="将NAQ和traffic behave关联"></a>将NAQ和traffic behave关联</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[CE]traffic behavior CT                              </span><br><span class="line">[CE-behavior-CT]redirect ip-nexthop 61.16.18.1 track nqa icmp CT</span><br><span class="line"></span><br><span class="line">[CE]traffic behavior CNC</span><br><span class="line"></span><br><span class="line">[CE-behavior-CNC]redirect ip-nexthop 183.165.11.1 track nqa icmp CNC </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h6 id="使用traffic-class流量分类"><a href="#使用traffic-class流量分类" class="headerlink" title="使用traffic-class流量分类"></a>使用traffic-class流量分类</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[CE]acl number 2000</span><br><span class="line">[CE-acl-basic-2000]rule permit source 4.4.4.4 0</span><br><span class="line">[CE-acl-basic-2000]rule deny </span><br><span class="line">[CE]acl number 2001 </span><br><span class="line"></span><br><span class="line">[CE-acl-basic-2001]rule  permit source 192.168.1.0 0.0.0.255</span><br><span class="line"></span><br><span class="line">[CE]traffic classifier CT</span><br><span class="line"></span><br><span class="line">[CE-classifier-CT]if-match acl 2001</span><br><span class="line">[CE]traffic classifier CNC</span><br><span class="line"></span><br><span class="line">[CE-classifier-CNC]if-match acl 2000</span><br></pre></td></tr></table></figure>

<h6 id="实验用traffic-polic关联流量和动作"><a href="#实验用traffic-polic关联流量和动作" class="headerlink" title="实验用traffic-polic关联流量和动作"></a>实验用traffic-polic关联流量和动作</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[CE]traffic policy PBR</span><br><span class="line">[CE-trafficpolicy-PBR]classifier CT behavior CT preference 10   #最后的命令在ensp上是没有的需要真机或者eve-ng上的ar1000v</span><br><span class="line"></span><br><span class="line">[CE-trafficpolicy-PBR]classifier CNC behavior CNC preference 30</span><br></pre></td></tr></table></figure>

<h6 id="华为路由器默认不切换，只是失效，失效后安装路由进行数据转发"><a href="#华为路由器默认不切换，只是失效，失效后安装路由进行数据转发" class="headerlink" title="华为路由器默认不切换，只是失效，失效后安装路由进行数据转发"></a>华为路由器默认不切换，只是失效，失效后安装路由进行数据转发</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ip route-static 0.0.0.0 0.0.0.0 61.16.18.1 track nqa CT icmp</span><br><span class="line">ip route-static 0.0.0.0 0.0.0.0 183.165.11.1 track nqa CNC icmp</span><br></pre></td></tr></table></figure>

<p>可以参考<a target="_blank" rel="noopener" href="https://support.huawei.com/enterprise/zh/doc/EDOC1000178149/70bbde5f">华为官方配置</a></p>
<h4 id="NAT"><a href="#NAT" class="headerlink" title="NAT"></a>NAT</h4><p>NAT都是应用在端口上</p>
<img src="/2023/01/26/ICT%E7%AC%AC%E4%B8%83%E6%AC%A1%E7%AC%94%E8%AE%B0/41531.png" class="" title="img">



<h5 id="1-basic-nat"><a href="#1-basic-nat" class="headerlink" title="1.basic nat"></a>1.basic nat</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[Huawei]nat address-group 1 192.168.1.15 192.168.1.16  #定义公网地址池</span><br><span class="line">[Huawei]acl number 2000 </span><br><span class="line"></span><br><span class="line">[Huawei-acl-basic-2000]rule permit source 192.168.10.0 0.0.0.2255     #定义那些内网地址进行nat转换</span><br><span class="line">[Huawei-acl-basic-2000]rule deny </span><br><span class="line">[Huawei]interface GigabitEthernet 0/0/1</span><br><span class="line">[Huawei-GigabitEthernet0/0/1]nat outbound 2000 address-group 1 no-pat </span><br></pre></td></tr></table></figure>

<blockquote>
<p>NO-PAT（Not Port Address Translation）模式下，一个外网地址同一时间只能分配给一个内网地址进行地址转换，不能同时被多个内网地址共用。当使用某外网地址的内网用户停止访问外网时，NAT会将其占用的外网地址释放并分配给其他内网用户使用。</p>
<p>该模式下，NAT设备只对报文的IP地址进行NAT转换，同时会建立一个NO-PAT表项用于记录IP地址映射关系，并可支持所有IP协议的报文。</p>
</blockquote>
<h6 id="2-PAT"><a href="#2-PAT" class="headerlink" title="2.PAT"></a>2.PAT</h6><p>PAT（Port Address Translation）模式下，一个NAT地址可以同时分配给多个内网地址共用。该模式下，NAT设备需要对报文的<strong>IP地址</strong>和<strong>传输层端口</strong>同时进行转换，且只支持TCP、UDP和ICMP（Internet Control Message Protocol，互联网控制消息协议）查询报文。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[Huawei]nat address-group 1 192.168.1.15 192.168.1.16  #定义公网地址池</span><br><span class="line">[Huawei]acl number 2000 </span><br><span class="line"></span><br><span class="line">[Huawei-acl-basic-2000]rule permit source 192.168.10.0 0.0.0.2255     #定义那些内网地址进行nat转换</span><br><span class="line">[Huawei-acl-basic-2000]rule deny </span><br><span class="line">[Huawei]interface GigabitEthernet 0/0/1</span><br><span class="line">[Huawei-GigabitEthernet0/0/1]nat outbound 2000 address-group 1</span><br></pre></td></tr></table></figure>

<h6 id="3-Easy-IP"><a href="#3-Easy-IP" class="headerlink" title="3.Easy 	IP"></a>3.Easy 	IP</h6><p><strong>NAT设备直接使用出接口的IP地址作为转换后的源地址</strong></p>
<p><strong>不用预先配置地址池</strong></p>
<p><strong>工作原理与普通NAPT相同，是NAPT的一种特例</strong></p>
<p><strong>适用于拨号接入Internet或动态获得IP地址的场合</strong></p>
<p>配置步骤：</p>
<img src="/2023/01/26/ICT%E7%AC%AC%E4%B8%83%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221123184819223.png" class="" title="image-20221123184819223">

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[Huawei]acl number 2000 </span><br><span class="line"></span><br><span class="line">[Huawei-acl-basic-2000]rule permit source 192.168.10.0 0.0.0.2255     #定义那些内网地址进行nat转换</span><br><span class="line">[Huawei-acl-basic-2000]rule deny </span><br><span class="line"></span><br><span class="line">[Huawei]inter g0/0/1</span><br><span class="line">[Huawei-GigabitEthernet0/0/1]nat   outbound 2000</span><br></pre></td></tr></table></figure>

<h6 id="4-静态NAT"><a href="#4-静态NAT" class="headerlink" title="4.静态NAT"></a>4.静态NAT</h6><p>允许外网访问内网web服务器所有服务，相当于给服务器配置一个独立公网地址</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nat static global 192.168.1.15 inside 192.168.10.250</span><br></pre></td></tr></table></figure>

<h6 id="5-端口映射"><a href="#5-端口映射" class="headerlink" title="5.端口映射"></a>5.端口映射</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[Huawei-GigabitEthernet0/0/1]nat static protocol tcp global current-interface  8081 inside 192.168.10.250 80</span><br><span class="line">配置nat端口映射，将公网当前接口G0/0/1的ip对应8081端口的数据流，转换为内网192.168.10.250ip及端口80发送到目标地址</span><br></pre></td></tr></table></figure>

<h4 id="VRRP"><a href="#VRRP" class="headerlink" title="VRRP"></a>VRRP</h4><img src="/2023/01/26/ICT%E7%AC%AC%E4%B8%83%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221123235153721.png" class="" title="image-20221123235153721">

<h5 id="基本配置：-1"><a href="#基本配置：-1" class="headerlink" title="基本配置："></a>基本配置：</h5><p>AR2、AR3、AR4同配置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">int g0/0/0</span><br><span class="line">vrrp vrid 1 virtual-ip 10.234.1.1</span><br></pre></td></tr></table></figure>

<p>可以发现AR2被选为Master</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">display vrrp</span><br></pre></td></tr></table></figure>

<img src="/2023/01/26/ICT%E7%AC%AC%E4%B8%83%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221123232007338.png" class="" title="image-20221123232007338">

<p>AR3、AR4</p>
<img src="/2023/01/26/ICT%E7%AC%AC%E4%B8%83%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221123232018620.png" class="">

<p>IP地址不具有抢占</p>
<p>优先级存在抢占  master断掉后就不再是master</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vrrp vrid 1 priority 110  //更改优先级</span><br><span class="line"></span><br><span class="line">vrrp vrid 1preempt disable 不主动参与优先级比较，但是重新进行选举时，仍会参与选举。</span><br></pre></td></tr></table></figure>

<p>在修改R2的优先级，断开R2的g&#x2F;0&#x2F;0&#x2F;0后发现R3成为了Master</p>
<img src="/2023/01/26/ICT%E7%AC%AC%E4%B8%83%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221124000252920.png" class="" title="image-20221124000252920">

<p>在R2的线重连后，重新竞选后R2成为了Master,R3又是backup</p>
<img src="/2023/01/26/ICT%E7%AC%AC%E4%B8%83%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221124000411237.png" class="" title="image-20221124000411237">

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vrrp只是与端口上关联，而与上方不关联</span><br><span class="line">vrrpvrid 1track nqa vrrpicmp reduce xx   //xx为优先级减少的数量    即断开后该优先级会减少xx</span><br><span class="line">increase  增加</span><br><span class="line"></span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://lanyangyangy.github.io/2023/01/26/ICT%E7%AC%AC%E4%B8%83%E6%AC%A1%E7%AC%94%E8%AE%B0/" data-id="cldfxvta80001vg9u59yi5fgf" data-title="ICT第七次笔记" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ICT-%E6%95%B0%E9%80%9A/" rel="tag">ICT 数通</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2023/01/26/ICT%E7%AC%AC%E5%85%AB%E6%AC%A1%E7%AC%94%E8%AE%B0/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          ICT第八次笔记
        
      </div>
    </a>
  
  
    <a href="/2023/01/26/ICT%E7%AC%AC%E5%85%AD%E6%AC%A1%E7%AC%94%E8%AE%B0/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">ICT第六次笔记</div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/ICT-%E6%95%B0%E9%80%9A/" rel="tag">ICT 数通</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/numpy/" rel="tag">numpy</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python-%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/" rel="tag">python 面向对象</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/ICT-%E6%95%B0%E9%80%9A/" style="font-size: 20px;">ICT 数通</a> <a href="/tags/numpy/" style="font-size: 10px;">numpy</a> <a href="/tags/python-%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/" style="font-size: 10px;">python 面向对象</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/01/">January 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/12/">December 2022</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2023/01/26/ICT%E7%AC%AC%E5%8D%81%E4%B8%80%E6%AC%A1%E7%AC%94%E8%AE%B0/">ICT第十一次笔记</a>
          </li>
        
          <li>
            <a href="/2023/01/26/ICT%E7%AC%AC%E5%8D%81%E6%AC%A1%E7%AC%94%E8%AE%B0/">ICT第十次笔记</a>
          </li>
        
          <li>
            <a href="/2023/01/26/ICT%E7%AC%AC%E4%B9%9D%E6%AC%A1%E7%AC%94%E8%AE%B0/">ICT第九次笔记</a>
          </li>
        
          <li>
            <a href="/2023/01/26/ICT%E7%AC%AC%E5%85%AB%E6%AC%A1%E7%AC%94%E8%AE%B0/">ICT第八次笔记</a>
          </li>
        
          <li>
            <a href="/2023/01/26/ICT%E7%AC%AC%E4%B8%83%E6%AC%A1%E7%AC%94%E8%AE%B0/">ICT第七次笔记</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2023 懒懒当大厨<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>