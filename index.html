<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>波波，早点走出来</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="波波，早点走出来">
<meta property="og:url" content="http://lanyangyangy.github.io/index.html">
<meta property="og:site_name" content="波波，早点走出来">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="懒懒当大厨">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="波波，早点走出来" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 6.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">波波，早点走出来</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://lanyangyangy.github.io"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-ICT第十一次笔记" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/01/26/ICT%E7%AC%AC%E5%8D%81%E4%B8%80%E6%AC%A1%E7%AC%94%E8%AE%B0/" class="article-date">
  <time class="dt-published" datetime="2023-01-26T04:52:27.000Z" itemprop="datePublished">2023-01-26</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/01/26/ICT%E7%AC%AC%E5%8D%81%E4%B8%80%E6%AC%A1%E7%AC%94%E8%AE%B0/">ICT第十一次笔记</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>IS-IS是OSI定协议栈中的CLNS的一部分。</p>
<p>IS-IS在自治系统内采用骨干区域与非骨干区域两级的分层结构：</p>
<ul>
<li>Level-1路由器部署在非骨干区域。</li>
<li>Level-2路由器和Level-1-1路由器部署在骨干区域。</li>
<li>每一个非骨干区域都通过Level-1-2路由器与骨干网络相连。</li>
</ul>
<img src="/2023/01/26/ICT%E7%AC%AC%E5%8D%81%E4%B8%80%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221218100646448.png" class="" title="image-20221218100646448">

<img src="/2023/01/26/ICT%E7%AC%AC%E5%8D%81%E4%B8%80%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221218100840759.png" class="" title="image-20221218100840759">

<img src="/2023/01/26/ICT%E7%AC%AC%E5%8D%81%E4%B8%80%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221218104112044.png" class="" title="image-20221218104112044">

<img src="/2023/01/26/ICT%E7%AC%AC%E5%8D%81%E4%B8%80%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221221160523513.png" class="" title="image-20221221160523513">

<img src="/2023/01/26/ICT%E7%AC%AC%E5%8D%81%E4%B8%80%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221221161943357.png" class="" title="image-20221221161943357">

<p>实验：<img src="/2023/01/26/ICT%E7%AC%AC%E5%8D%81%E4%B8%80%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221218102228146.png" class="" title="image-20221218102228146"></p>
<p>R6:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[R6]<span class="built_in">int</span> g0/<span class="number">00</span>/<span class="number">0</span></span><br><span class="line">[R6-GigabitEthernet0/<span class="number">0</span>/<span class="number">0</span>]ip add <span class="number">67.1</span><span class="number">.1</span><span class="number">.6</span> <span class="number">24</span></span><br><span class="line">[R6-GigabitEthernet0/<span class="number">0</span>/<span class="number">0</span>]isis <span class="number">1</span></span><br><span class="line">[R6-isis-<span class="number">1</span>]<span class="keyword">is</span>-level level-<span class="number">1</span></span><br><span class="line">[R6-isis-<span class="number">1</span>]<span class="built_in">int</span> g0/<span class="number">00</span>/<span class="number">0</span></span><br><span class="line">[R6-GigabitEthernet0/<span class="number">0</span>/<span class="number">0</span>]isis enable <span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>R7:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[R7]int g0/0/0</span><br><span class="line">[R7-GigabitEthernet0/0/0]ip add 67.1.1.7 24</span><br><span class="line">[R7-GigabitEthernet0/0/0]isis 1</span><br><span class="line">[R7-isis-1]is-level level-1</span><br><span class="line">[R7-isis-1]int g0/0/0</span><br><span class="line">[R7-GigabitEthernet0/0/0]isis enable 1</span><br></pre></td></tr></table></figure>



<p><img src="/ICT%E7%AC%AC%E5%8D%81%E4%B8%80%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221221163408378.png" alt="image-20221221163408378"><img src="/ICT%E7%AC%AC%E5%8D%81%E4%B8%80%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221221163442106.png" alt="image-20221221163442106"></p>
<p>修改IS-IS开销：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">isis cost xx</span><br></pre></td></tr></table></figure>



<p>ISIS是直接封装在数据链路层的帧结构中。</p>
<img src="/2023/01/26/ICT%E7%AC%AC%E5%8D%81%E4%B8%80%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221218104531404.png" class="" title="image-20221218104531404">

<img src="/2023/01/26/ICT%E7%AC%AC%E5%8D%81%E4%B8%80%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221218112455614.png" class="" title="image-20221218112455614">

<img src="/2023/01/26/ICT%E7%AC%AC%E5%8D%81%E4%B8%80%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221218112922389.png" class="" title="image-20221218112922389">

<img src="/2023/01/26/ICT%E7%AC%AC%E5%8D%81%E4%B8%80%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221218114313207.png" class="" title="image-20221218114313207">

<p>实验：</p>
<img src="/2023/01/26/ICT%E7%AC%AC%E5%8D%81%E4%B8%80%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221221182407285.png" class="" title="image-20221221182407285">

<p>AR1：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[AR1(L1)]isis 1 </span><br><span class="line"></span><br><span class="line">[AR1(L1)-isis-1]is-level level-1  </span><br><span class="line"></span><br><span class="line">[AR1(L1)-isis-1]network-entity 49.0001.0000.0000.0001.00</span><br><span class="line">[AR1(L1)-isis-1]quit</span><br><span class="line"></span><br><span class="line">[AR1(L1)]inter g0/0/1</span><br><span class="line"></span><br><span class="line">[AR1(L1)-GigabitEthernet0/0/1]isis enable </span><br><span class="line">[AR1(L1)-GigabitEthernet0/0/1]inter g0/0/2</span><br><span class="line">[AR1(L1)-GigabitEthernet0/0/2]isis enable </span><br><span class="line"></span><br><span class="line">[AR1(L1)-GigabitEthernet0/0/2]inter lo 0 </span><br><span class="line">[AR1(L1)-LoopBack0]isis enable</span><br></pre></td></tr></table></figure>

<p>AR2:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[AR2(L1/2)]isis 1 </span><br><span class="line"></span><br><span class="line">[AR2(L1/2)-isis-1]network-entity 49.0001.0000.0000.0002.00</span><br><span class="line"></span><br><span class="line">[AR2(L1/2)-isis-1]is-level level-1-2</span><br><span class="line">[AR2(L1/2)-isis-1]quit</span><br><span class="line"></span><br><span class="line">[AR2(L1/2)]inter g0/0/0</span><br><span class="line"></span><br><span class="line">[AR2(L1/2)-GigabitEthernet0/0/0]isis enable </span><br><span class="line"></span><br><span class="line">[AR2(L1/2)-GigabitEthernet0/0/0]inter g0/0/1</span><br><span class="line">[AR2(L1/2)-GigabitEthernet0/0/1]isis enable </span><br><span class="line">[AR2(L1/2)-GigabitEthernet0/0/1]inte lo 0   </span><br><span class="line">[AR2(L1/2)-LoopBack0]isis enable</span><br></pre></td></tr></table></figure>

<p>AR3:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[AR3(L1/2)]isis 1 </span><br><span class="line"></span><br><span class="line">[AR3(L1/2)-isis-1]network-entity 49.0001.0000.0000.0003.00</span><br><span class="line"></span><br><span class="line">[AR3(L1/2)-isis-1]is-level level-1-2 </span><br><span class="line">[AR3(L1/2)]interface g0/0/0</span><br><span class="line"></span><br><span class="line">[AR3(L1/2)-GigabitEthernet0/0/0]isis enable</span><br><span class="line">[AR3(L1/2)-GigabitEthernet0/0/1]inter  lo 0 </span><br><span class="line">[AR3(L1/2)-LoopBack0]isis enable</span><br><span class="line">[AR3(L1/2)-LoopBack0]interface g0/0/2</span><br><span class="line">[AR3(L1/2)-GigabitEthernet0/0/2]isis enable   </span><br></pre></td></tr></table></figure>

<p>AR4:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[AR4(L2)]isis 1 </span><br><span class="line"></span><br><span class="line">[AR4(L2)-isis-1]network-entity 49.0002.0000.0000.0004.00</span><br><span class="line"></span><br><span class="line">[AR4(L2)-isis-1]is-level level-2  </span><br><span class="line">[AR4(L2)-isis-1]quit</span><br><span class="line"></span><br><span class="line">[AR4(L2)]inter g0/0/0</span><br><span class="line">[AR4(L2)-GigabitEthernet0/0/0]isis enable  </span><br><span class="line">[AR4(L2)-GigabitEthernet0/0/0]inter g0/0/1</span><br><span class="line">[AR4(L2)-GigabitEthernet0/0/1]isis enable </span><br><span class="line">[AR4(L2)-GigabitEthernet0/0/1]inter lo 0 </span><br><span class="line">[AR4(L2)-LoopBack0]isis enable</span><br></pre></td></tr></table></figure>

<p>AR5:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[AR5(L2)]isis 1 </span><br><span class="line">[AR5(L2)-isis-1]network-entity 49.0002.0000.0000.0005.00</span><br><span class="line">[AR5(L2)-isis-1]is-level level-2</span><br><span class="line">[AR5(L2)-isis-1]quit</span><br><span class="line"></span><br><span class="line">[AR5(L2)]inter g0/0/0</span><br><span class="line">[AR5(L2)-GigabitEthernet0/0/0]isis enable</span><br><span class="line"></span><br><span class="line">[AR5(L2)-GigabitEthernet0/0/0]inter g0/0/1</span><br><span class="line">[AR5(L2)-GigabitEthernet0/0/1]isis enable</span><br><span class="line"></span><br><span class="line">[AR5(L2)]inter lo 0 </span><br><span class="line">[AR5(L2)-LoopBack0]isis enable </span><br></pre></td></tr></table></figure>

<p>结果：在AR2上通过ISIS学到了路由</p>
<p><img src="D:\Desktop\QQ图片20221221182943.jpg" alt="QQ图片20221221182943"></p>
<p>路由渗透（解决次优路径）：</p>
<p>AR2:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[AR2(L1/2)]ip ip-prefix 1 permit 4.4.4.4 32 </span><br><span class="line">[AR2(L1/2)]isis 1 </span><br><span class="line"></span><br><span class="line">[AR2(L1/2)-isis-1]import-route isis level-2 into level-1 filter-policy ip-prefix 1  </span><br></pre></td></tr></table></figure>

<p>AR3:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[AR3(L1/2)]ip ip-prefix 1 permit 5.5.5.5 32</span><br><span class="line">[AR3(L1/2)]isis 1 </span><br><span class="line">[AR3(L1/2)-isis-1]import-route isis level-2 into level-1 filter-policy ip-prefix 1 </span><br></pre></td></tr></table></figure>



<h4 id="vxlan"><a href="#vxlan" class="headerlink" title="vxlan"></a>vxlan</h4><p>VXLAN的特点是将L2的以太帧封装到UDP报文（即L2 over L4）中，并在L3网络中传输。</p>
<p>VXLAN本质上是一种隧道技术，在源网络设备与目的网络设备之间的IP网络上，建立一条逻辑隧道，将用户侧报文经过特定的封装后通过这条隧道转发。从用户的角度来看，接入网络的服务器就像是连接到了一个虚拟的二层交换机的不同端口上（可把蓝色虚框表示的数据中心VXLAN网络看成一个二层虚拟交换机），可以方便地通信。</p>
<h5 id="VTEP"><a href="#VTEP" class="headerlink" title="VTEP"></a>VTEP</h5><p>VTEP（VXLAN Tunnel Endpoints，VXLAN隧道端点）是VXLAN网络的边缘设备，是VXLAN隧道的起点和终点，VXLAN对用户原始数据帧的封装和解封装均在VTEP上进行。</p>
<h5 id="VNI"><a href="#VNI" class="headerlink" title="VNI"></a>VNI</h5><p>VNI是一种类似于VLAN ID的用户标识，一个VNI代表了一个租户，属于不同VNI的虚拟机之间不能直接进行二层通信。</p>
<p>在分布式网关部署场景下，VNI还可分为二层VNI和三层VNI，它们的作用不同：</p>
<ul>
<li>二层VNI是普通的VNI，以1：1方式映射到广播域BD，实现VXLAN报文同子网的转发。</li>
<li>三层VNI和VPN实例进行关联，用于VXLAN报文跨子网的转发。</li>
</ul>
<img src="/2023/01/26/ICT%E7%AC%AC%E5%8D%81%E4%B8%80%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221218152820898.png" class="" title="image-20221218152820898">

<p>实验:</p>
<img src="/2023/01/26/ICT%E7%AC%AC%E5%8D%81%E4%B8%80%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221221222644291.png" class="" title="image-20221221222644291">

<p>配置过程:</p>
<p>1、搭好实验环境，导入号CE12800镜像。 </p>
<p>2、基础配置。（修改设备名、直连接口IP地址、设备vlan，trunk划分。） 3、配置路由协议。（保证CE1、CE2、CE3 loopback能通） </p>
<p>4、VXLAN相关配置。（建立VXLAN隧道、配置VNI号等） </p>
<p>5、验证。</p>
<p>基本配置:</p>
<p>CE交换机要敲commit,且其端口默认shutdown.</p>
<p>CE1:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;HUAWEI&gt;sys</span><br><span class="line">[~HUAWEI]sys CE1</span><br><span class="line">[*HUAWEI]commit </span><br><span class="line">[~CE1]inter g1/<span class="number">0</span>/<span class="number">0</span></span><br><span class="line"></span><br><span class="line">[~CE1-GE1/<span class="number">0</span>/<span class="number">0</span>]undo portswitch </span><br><span class="line">[*CE1-GE1/<span class="number">0</span>/<span class="number">0</span>]ip add <span class="number">12.1</span><span class="number">.1</span><span class="number">.1</span> <span class="number">24</span></span><br><span class="line"></span><br><span class="line">[*CE1-GE1/<span class="number">0</span>/<span class="number">0</span>]undo shutdown </span><br><span class="line">[*CE1]inter lo <span class="number">0</span>            </span><br><span class="line">[*CE1-LoopBack0]ip add <span class="number">10.10</span><span class="number">.10</span><span class="number">.10</span> <span class="number">24</span> </span><br><span class="line">[*CE1-LoopBack0]quit</span><br><span class="line">[*CE1]commit </span><br><span class="line"></span><br><span class="line">//路由配置</span><br><span class="line">[~CE1]ospf <span class="number">1</span></span><br><span class="line">[*CE1-ospf-<span class="number">1</span>]area <span class="number">0</span> </span><br><span class="line">[*CE1-ospf-<span class="number">1</span>-area-<span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>]network <span class="number">12.1</span><span class="number">.1</span><span class="number">.0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.255</span></span><br><span class="line">[*CE1-ospf-<span class="number">1</span>-area-<span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>]network <span class="number">10.10</span><span class="number">.10</span><span class="number">.10</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>  </span><br><span class="line">[*CE1-ospf-<span class="number">1</span>-area-<span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>]quit</span><br><span class="line">[*CE1-ospf-<span class="number">1</span>]quit</span><br><span class="line">[*CE1]commit</span><br></pre></td></tr></table></figure>

<p>CE2:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;HUAWEI&gt;sys</span><br><span class="line">[~HUAWEI]sysname CE2</span><br><span class="line"></span><br><span class="line">[*HUAWEI]commit </span><br><span class="line">[~CE2]inter g1/0/0</span><br><span class="line">[~CE2-GE1/0/0]undo portswitch </span><br><span class="line">[*CE2-GE1/0/0]ip add 12.1.1.2 24</span><br><span class="line">[*CE2-GE1/0/0]undo shutdown</span><br><span class="line">[*CE2-GE1/0/0]quit</span><br><span class="line">[*CE2]inter lo 0 </span><br><span class="line">[*CE2-LoopBack0]ip add 20.20.20.20 24</span><br><span class="line">[*CE2-LoopBack0]quit</span><br><span class="line">[*CE2]inter g1/0/1</span><br><span class="line">[*CE2-GE1/0/1]undo portswitch</span><br><span class="line">[*CE2-GE1/0/1]ip add 23.1.1.2 24</span><br><span class="line">[*CE2-GE1/0/1]undo shutdown</span><br><span class="line">[*CE2-GE1/0/1]quit</span><br><span class="line">[*CE2]commit</span><br><span class="line">//路由配置</span><br><span class="line">[~CE2]ospf 1 </span><br><span class="line">[*CE2-ospf-1]area 0 </span><br><span class="line"></span><br><span class="line">[*CE2-ospf-1-area-0.0.0.0]network 12.1.1.0 0.0.0.255</span><br><span class="line">[*CE2-ospf-1-area-0.0.0.0]network 23.1.1.0 0.0.0.255</span><br><span class="line">[*CE2-ospf-1-area-0.0.0.0]network 20.20.20.20 0.0.0.0</span><br><span class="line">[*CE2-ospf-1-area-0.0.0.0]quit</span><br><span class="line">[*CE2-ospf-1]quit</span><br><span class="line">[*CE2]commit</span><br></pre></td></tr></table></figure>

<p>CE3:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;HUAWEI&gt;sys</span><br><span class="line">[~HUAWEI]sysname CE3</span><br><span class="line"></span><br><span class="line">[*HUAWEI]commit </span><br><span class="line">[~CE3]inter g1/0/0</span><br><span class="line">[~CE3-GE1/0/0]undo portswitch</span><br><span class="line">[*CE3-GE1/0/0]ip add 23.1.1.3 24</span><br><span class="line">[*CE3-GE1/0/0]undo shutdown</span><br><span class="line">[*CE3-GE1/0/0]quit</span><br><span class="line">[*CE3]inter lo 0 </span><br><span class="line">[*CE3-LoopBack0]ip add 30.30.30.30 24</span><br><span class="line">[*CE3-LoopBack0]quit</span><br><span class="line">[*CE3]commit</span><br><span class="line">//路由配置</span><br><span class="line">[~CE3]ospf  1</span><br><span class="line">[*CE3-ospf-1]area 0 </span><br><span class="line"></span><br><span class="line">[*CE3-ospf-1-area-0.0.0.0]network 23.1.1.0 0.0.0.255</span><br><span class="line">[*CE3-ospf-1-area-0.0.0.0]network 30.30.30.30 0.0.0.0</span><br><span class="line">[*CE3-ospf-1-area-0.0.0.0]quit</span><br><span class="line">[*CE3-ospf-1]quit</span><br><span class="line"></span><br><span class="line">[*CE3]commit </span><br></pre></td></tr></table></figure>

<p>LSW2:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[LSW2]inter g0/0/1</span><br><span class="line"></span><br><span class="line">[LSW2-GigabitEthernet0/0/1]port link-type trunk </span><br><span class="line">[LSW2-GigabitEthernet0/0/1]port trunk allow-pass vlan all</span><br><span class="line">[LSW2]vlan 10 </span><br><span class="line">[LSW2-vlan10]quit</span><br><span class="line">[LSW2]inter g0/0/2</span><br><span class="line">[LSW2-GigabitEthernet0/0/2]port default vlan 10 </span><br></pre></td></tr></table></figure>

<p>LSW3:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[LSW3]interface g0/0/1</span><br><span class="line">[LSW3-GigabitEthernet0/0/1]port link-type trunk</span><br><span class="line">[LSW3-GigabitEthernet0/0/1]port trunk allow-pass vlan all </span><br><span class="line">[LSW3-GigabitEthernet0/0/1]quit  </span><br><span class="line">[LSW3]vlan 10 </span><br><span class="line">[LSW3-vlan10]quit</span><br><span class="line">[LSW3]inter g0/0/2</span><br><span class="line">[LSW3-GigabitEthernet0/0/2]port link-type access </span><br><span class="line">[LSW3-GigabitEthernet0/0/2]port default vlan 10</span><br></pre></td></tr></table></figure>

<p>VXLAN配置:<br>CE1:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[~CE1]vlan 10 </span><br><span class="line">[*CE1-vlan10]quit</span><br><span class="line">[*CE1]bridge-domain 10</span><br><span class="line">[*CE1-bd10]quit</span><br><span class="line">[*CE1]interface g1/0/1.1 mode l2</span><br><span class="line">[*CE1-GE1/0/1.1]encapsulation dot1q vid 10 </span><br><span class="line">[*CE1-GE1/0/1.1]bridge-domain 10 </span><br><span class="line">[*CE1-GE1/0/1.1]quit</span><br><span class="line">[~CE1]inter g1/0/1</span><br><span class="line"></span><br><span class="line">[~CE1-GE1/0/1]undo shutdown </span><br><span class="line">[*CE1-GE1/0/1]quit</span><br><span class="line">[*CE1]commit </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>CE2:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[~CE3]vlan 10</span><br><span class="line">[*CE3-vlan10]quit</span><br><span class="line">[*CE3]bridge-domain 10 </span><br><span class="line">[*CE3-bd10]quit</span><br><span class="line"></span><br><span class="line">[*CE3]int g1/0/1.1 mode l2   </span><br><span class="line">[*CE3-GE1/0/1.1]encapsulation dot1q vid 10</span><br><span class="line">[*CE3-GE1/0/1.1]bridge-domain 10</span><br><span class="line">[*CE3-GE1/0/1.1]quit</span><br><span class="line">[~CE3]inter g1/0/1</span><br><span class="line"></span><br><span class="line">[~CE3-GE1/0/1]undo shutdown </span><br><span class="line">[*CE3-GE1/0/1]quit</span><br><span class="line">[*CE3]commit</span><br></pre></td></tr></table></figure>

<p>配置VXLAN隧道:</p>
<p>CE1:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">VNI与BD配置</span><br><span class="line">[~CE1]bridge-domain 10   #系统视图下创建广播域BD，进入BD视图。ID取值范围为1～16777215。</span><br><span class="line"></span><br><span class="line">[~CE1-bd10]vxlan vni 1   #BD视图下创建VXLAN网络标识VNI并关联广播域BD。ID取值范围为1～16777215。</span><br><span class="line">Info: Please disable dynamic ARP learning when the controller is used to deliver ARP entries.</span><br><span class="line">[*CE1-bd10]quit</span><br><span class="line"></span><br><span class="line">VTEP配置</span><br><span class="line">[*CE1]interface Nve 1    #创建NVE接口，并进入NVE接口视图。一般情况下NVE接口编号有且仅为1。</span><br><span class="line">[*CE1-Nve1]source 10.10.10.10    #配置源端VTEP的IP地址。推荐使用Loopback接口的地址。</span><br><span class="line">[*CE1-Nve1]vni 1 head-end peer-list 30.30.30.30    #NVE视图下配置VNI指定多个远端VTEP的IP地址建立头端复制列表。本端NVE将根据此列表复制并转发报文。</span><br><span class="line">[*CE1-Nve1]quit</span><br><span class="line"></span><br><span class="line">[*CE1]commit </span><br></pre></td></tr></table></figure>

<p>CE3:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">VNI与BD配置</span><br><span class="line">[~CE3]bridge-domain 10</span><br><span class="line">[~CE3-bd10]vxlan vni 1</span><br><span class="line">Info: Please disable dynamic ARP learning when the controller is used to deliver ARP entries.</span><br><span class="line">[*CE3-bd10]quit</span><br><span class="line"></span><br><span class="line">VTEP配置</span><br><span class="line">[*CE3]interface nve 1</span><br><span class="line">[*CE3-Nve1]source 30.30.30.30</span><br><span class="line"></span><br><span class="line">[*CE3-Nve1]vni 1 head-end peer-list 10.10.10.10</span><br><span class="line">[*CE3-Nve1]quit</span><br><span class="line"></span><br><span class="line">[*CE3]commit </span><br><span class="line">[~CE3]</span><br></pre></td></tr></table></figure>

<p>验证:</p>
<img src="/2023/01/26/ICT%E7%AC%AC%E5%8D%81%E4%B8%80%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221221223212599.png" class="" title="image-20221221223212599">

      
    </div>
    <footer class="article-footer">
      <a data-url="http://lanyangyangy.github.io/2023/01/26/ICT%E7%AC%AC%E5%8D%81%E4%B8%80%E6%AC%A1%E7%AC%94%E8%AE%B0/" data-id="cldfxvtai000fvg9ufqxe0lz5" data-title="ICT第十一次笔记" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ICT-%E6%95%B0%E9%80%9A/" rel="tag">ICT 数通</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-ICT第十次笔记" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/01/26/ICT%E7%AC%AC%E5%8D%81%E6%AC%A1%E7%AC%94%E8%AE%B0/" class="article-date">
  <time class="dt-published" datetime="2023-01-26T04:52:15.000Z" itemprop="datePublished">2023-01-26</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/01/26/ICT%E7%AC%AC%E5%8D%81%E6%AC%A1%E7%AC%94%E8%AE%B0/">ICT第十次笔记</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h4 id="MPLS-VPN"><a href="#MPLS-VPN" class="headerlink" title="MPLS VPN"></a>MPLS VPN</h4><p>VPN网络架构：CE、PE、P    PE和P是运营商设备，CE是用户端设备</p>
<p>MPLS VPN技术架构</p>
<img src="/2023/01/26/ICT%E7%AC%AC%E5%8D%81%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221213162743454.png" class="" title="image-20221213162743454">

<p>VRF（虚拟路由转发），又称VPN实例，是MPLS VPN架构的关键级数，每一个VPN实例使用独立的路由转发表项，实现VPN之间的逻辑隔离。</p>
<p>RD   本地</p>
<p>RT    全局</p>
<img src="/2023/01/26/ICT%E7%AC%AC%E5%8D%81%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221213160415097.png" class="" title="image-20221213160415097">

<p>实验配置：</p>
<h6 id="配置一-配置VPN-instance："><a href="#配置一-配置VPN-instance：" class="headerlink" title="配置一   配置VPN-instance："></a>配置一   配置VPN-instance：</h6><p>PE1：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[Huawei]sys PE1</span><br><span class="line">[PE1]ip vpn-instance CEA</span><br><span class="line"></span><br><span class="line">[PE1-vpn-instance-CEA] ipv4-family</span><br><span class="line">[PE1-vpn-instance-CEA-af-ipv4]</span><br><span class="line">[PE1-vpn-instance-CEA-af-ipv4]  route-distinguisher 1:1</span><br><span class="line">[PE1-vpn-instance-CEA-af-ipv4]</span><br><span class="line">[PE1-vpn-instance-CEA-af-ipv4]  vpn-target 1:1 export-extcommunity</span><br><span class="line">[PE1-vpn-instance-CEA-af-ipv4]  vpn-target 1:1 import-extcommunity</span><br><span class="line"></span><br><span class="line">[PE1-vpn-instance-CEA-af-ipv4]ip vpn-instance CEB</span><br><span class="line">[PE1-vpn-instance-CEB] ipv4-family</span><br><span class="line">[PE1-vpn-instance-CEB-af-ipv4]  route-distinguisher 2:2</span><br><span class="line">[PE1-vpn-instance-CEB-af-ipv4]</span><br><span class="line">[PE1-vpn-instance-CEB-af-ipv4]  vpn-target 2:2 export-extcommunity</span><br><span class="line">[PE1-vpn-instance-CEB-af-ipv4]  vpn-target 2:2 import-extcommunity</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>PE2:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[Huawei]sys PE1</span><br><span class="line">[PE2]ip vpn-instance CEA</span><br><span class="line"></span><br><span class="line">[PE2-vpn-instance-CEA] ipv4-family</span><br><span class="line">[PE2-vpn-instance-CEA-af-ipv4]</span><br><span class="line">[PE2-vpn-instance-CEA-af-ipv4]  route-distinguisher 1:1</span><br><span class="line">[PE2-vpn-instance-CEA-af-ipv4]</span><br><span class="line">[PE2-vpn-instance-CEA-af-ipv4]  vpn-target 1:1 export-extcommunity</span><br><span class="line">[PE2-vpn-instance-CEA-af-ipv4]  vpn-target 1:1 import-extcommunity</span><br><span class="line"></span><br><span class="line">[PE2-vpn-instance-CEA-af-ipv4]ip vpn-instance CEB</span><br><span class="line">[PE2-vpn-instance-CEB] ipv4-family</span><br><span class="line">[PE2-vpn-instance-CEB-af-ipv4]  route-distinguisher 2:2</span><br><span class="line">[PE2-vpn-instance-CEB-af-ipv4]</span><br><span class="line">[PE2-vpn-instance-CEB-af-ipv4]  vpn-target 2:2 export-extcommunity</span><br><span class="line">[PE2-vpn-instance-CEB-af-ipv4]  vpn-target 2:2 import-extcommunity</span><br></pre></td></tr></table></figure>

<h6 id="配置二-将接口划入对应VPN实例："><a href="#配置二-将接口划入对应VPN实例：" class="headerlink" title="配置二 	将接口划入对应VPN实例："></a>配置二 	将接口划入对应VPN实例：</h6><p>PE1：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[PE1]inter g0/0/0</span><br><span class="line">[PE1-GigabitEthernet0/0/0]ip binding vpn-instance CEA</span><br><span class="line">[PE1-GigabitEthernet0/0/0]ip add 10.1.1.1 24</span><br><span class="line">[PE1-GigabitEthernet0/0/0]inter g0/0/1</span><br><span class="line">[PE1-GigabitEthernet0/0/1]ip binding vpn-instance CEB</span><br><span class="line">[PE1-GigabitEthernet0/0/1]ip add 10.1.1.1 24</span><br></pre></td></tr></table></figure>

<p>PE2:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[PE2]inter g0/0/1</span><br><span class="line">[PE2-GigabitEthernet0/0/1]ip binding vpn-instance CEA</span><br><span class="line">[PE2-GigabitEthernet0/0/1]ip add 10.1.2.1 24</span><br><span class="line">[PE2]inter g0/0/2</span><br><span class="line">[PE2-GigabitEthernet0/0/2]ip binding vpn-instance CEB</span><br><span class="line">[PE2-GigabitEthernet0/0/2]ip add 10.1.2.1 24</span><br></pre></td></tr></table></figure>



<p>此时我们通过 display ip interface brief 查询端口链路IP时可以发现PE1的两个接口IP是一样的。</p>
<img src="/2023/01/26/ICT%E7%AC%AC%E5%8D%81%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221215151533537.png" class="" title="image-20221215151533537">

<p>但是在通过 display ip routing-table 并查不到路由</p>
<img src="/2023/01/26/ICT%E7%AC%AC%E5%8D%81%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221215151647024.png" class="" title="image-20221215151647024">

<p>应使用display ip routing-table vpn-instance xx 进行查询，如：</p>
<img src="/2023/01/26/ICT%E7%AC%AC%E5%8D%81%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221215151808024.png" class="" title="image-20221215151808024">



<h6 id="配置三-配置客户到ISP路由协议OSPF"><a href="#配置三-配置客户到ISP路由协议OSPF" class="headerlink" title="配置三 	配置客户到ISP路由协议OSPF"></a>配置三 	配置客户到ISP路由协议OSPF</h6><p>CE1-A</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[CE1-A]inter g0/0/0</span><br><span class="line">[CE1-A-GigabitEthernet0/0/0]ip add 10.1.1.2 24 </span><br><span class="line"></span><br><span class="line">[CE1-A]int loopback 0</span><br><span class="line">[CE1-A-LoopBack0]ip add 4.4.4.4 32</span><br><span class="line">[CE1-A-LoopBack0]quit</span><br><span class="line"></span><br><span class="line">[CE1-A]ospf 1</span><br><span class="line">[CE1-A-ospf-1]area 0</span><br><span class="line">[CE1-A-ospf-1-area-0.0.0.0]net	</span><br><span class="line">[CE1-A-ospf-1-area-0.0.0.0]network  4.4.4.4 0.0.0.0	</span><br><span class="line">[CE1-A-ospf-1-area-0.0.0.0]network 10.1.1.0 0.0.0.255</span><br></pre></td></tr></table></figure>

<p>CE2-A</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[CE2-A]inter g0/0/0</span><br><span class="line">[CE2-A-GigabitEthernet0/0/0]ip add 10.1.2.2 24 </span><br><span class="line"></span><br><span class="line">[CE2-A-GigabitEthernet0/0/0]inter lo 0 </span><br><span class="line">[CE2-A-LoopBack0]ip add 5.5.5.5 32</span><br><span class="line"></span><br><span class="line">[CE2-A]ospf 1 </span><br><span class="line">[CE2-A-ospf-1]area 0 </span><br><span class="line">[CE2-A-ospf-1-area-0.0.0.0]network 10.1.2.0 0.0.0.255</span><br><span class="line">[CE2-A-ospf-1-area-0.0.0.0]network 5.5.5.5 0.0.0.0</span><br></pre></td></tr></table></figure>

<p> PE1:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[PE1]ospf vpn-instance CEA 1    #在VRF路由器CEA上启用ospf进程1    进程号全局唯一</span><br><span class="line">[PE1-ospf-1]area 0 </span><br><span class="line">[PE1-ospf-1-area-0.0.0.0]network 10.1.1.0 0.0.0.255</span><br></pre></td></tr></table></figure>

<p>PE2:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[PE2]ospf vpn-instance CEA 1 </span><br><span class="line">[PE2-ospf-1]area 0 </span><br><span class="line">[PE2-ospf-1-area-0.0.0.0]network 10.1.2.0 0.0.0.255</span><br></pre></td></tr></table></figure>

<p>检查：</p>
<p>display ip routing-table vpn-instance CEA  </p>
<img src="/2023/01/26/ICT%E7%AC%AC%E5%8D%81%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221215162527027.png" class="" title="image-20221215162527027">

<img src="/2023/01/26/ICT%E7%AC%AC%E5%8D%81%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221215162540749.png" class="" title="image-20221215162540749">

<p>ping -vpn-instance CEA 10.1.1.2</p>
<h6 id="配置四-配置ISP路由器IP地址信息-："><a href="#配置四-配置ISP路由器IP地址信息-：" class="headerlink" title="配置四  	配置ISP路由器IP地址信息 ："></a>配置四  	配置ISP路由器IP地址信息 ：</h6><p>PE1:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[PE1]int g0/0/2</span><br><span class="line">[PE1-GigabitEthernet0/0/2]ip add 12.1.1.1 24</span><br><span class="line">[PE1-GigabitEthernet0/0/2]int lo 0</span><br><span class="line">[PE1-LoopBack0]ip add 1.1.1.1 32</span><br></pre></td></tr></table></figure>

<p>P:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[P]int g0/0/0</span><br><span class="line">[P-GigabitEthernet0/0/0]ip add 12.1.1.2 24</span><br><span class="line">[P-GigabitEthernet0/0/0]inter g0/0/1</span><br><span class="line">[P-GigabitEthernet0/0/1]ip add 23.1.1.2 24</span><br><span class="line">[P-GigabitEthernet0/0/1]inter lo 0</span><br><span class="line">[P-LoopBack0]ip add 2.2.2.2 24</span><br></pre></td></tr></table></figure>

<p>PE2：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[PE2]inter g0/0/0</span><br><span class="line">[PE2-GigabitEthernet0/0/0]ip add 23.1.1.3 24</span><br><span class="line">[PE2-GigabitEthernet0/0/0]inter lo 0</span><br><span class="line">[PE2-LoopBack0]ip add 3.3.3.3 24</span><br></pre></td></tr></table></figure>

<h6 id="配置五配置单播路由协议ospf-："><a href="#配置五配置单播路由协议ospf-：" class="headerlink" title="配置五	配置单播路由协议ospf ："></a>配置五	配置单播路由协议ospf ：</h6><p>PE1：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[PE1]ospf 2</span><br><span class="line">[PE1-ospf-2]area 0	</span><br><span class="line">[PE1-ospf-2-area-0.0.0.0]network 12.1.1.0 0.0.0.255</span><br><span class="line">[PE1-ospf-2-area-0.0.0.0]network 1.1.1.1 0.0.0.0</span><br></pre></td></tr></table></figure>

<p>P:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[PE2]ospf 2 </span><br><span class="line">[PE2-ospf-2]area 0</span><br><span class="line">[PE2-ospf-2-area-0.0.0.0]network 12.1.1.0 0.0.0.255</span><br><span class="line">[PE2-ospf-2-area-0.0.0.0]network 23.1.1.0 0.0.0.255</span><br><span class="line">[PE2-ospf-2-area-0.0.0.0]network 2.2.2.2 0.0.0.0</span><br></pre></td></tr></table></figure>

<p>PE2:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[PE2]ospf 2 </span><br><span class="line">[PE2-ospf-2]area 0</span><br><span class="line">[PE2-ospf-2-area-0.0.0.0]network 23.1.1.0 0.0.0.255</span><br><span class="line">[PE2-ospf-2-area-0.0.0.0]network 3.3.3.3 0.0.0.0</span><br></pre></td></tr></table></figure>

<h6 id="配置六配置MP-BGP"><a href="#配置六配置MP-BGP" class="headerlink" title="配置六	配置MP BGP"></a>配置六	配置MP BGP</h6><p>PE1：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[PE1]bgp 123</span><br><span class="line">[PE1-bgp]peer 3.3.3.3 as-number 123</span><br><span class="line">[PE1-bgp]peer 3.3.3.3 connect-interface lo 0 </span><br><span class="line">[PE1-bgp]ipv4-family  vpnv4 unicast </span><br><span class="line"></span><br><span class="line">[PE1-bgp-af-vpnv4]peer 3.3.3.3 enable </span><br></pre></td></tr></table></figure>

<p>PE2:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[PE2]bgp 123</span><br><span class="line">[PE2-bgp]peer 1.1.1.1 as-number 123</span><br><span class="line">[PE2-bgp]peer 1.1.1.1 connect-interface lo 0 </span><br><span class="line">[PE2-bgp]ipv4-family vpnv4 unicast </span><br><span class="line">[PE2-bgp-af-vpnv4]peer 1.1.1.1 enable </span><br></pre></td></tr></table></figure>

<p>通过 display bgp vpnv4 all peer来检查</p>
<img src="/2023/01/26/ICT%E7%AC%AC%E5%8D%81%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221216155617686.png" class="" title="image-20221216155617686">

<h6 id="配置七路由引入"><a href="#配置七路由引入" class="headerlink" title="配置七	路由引入"></a>配置七	路由引入</h6><p>PE1：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[PE1]ospf 1 vpn-instance CEA</span><br><span class="line">[PE1-ospf-1] import-route bgp</span><br><span class="line">[PE1-ospf-1]bgp 123</span><br><span class="line">[PE1-bgp]ipv4-family vpn-instance CEA </span><br><span class="line">[PE1-bgp-CEA]  import-route direct</span><br><span class="line">[PE1-bgp-CEA]  import-route ospf 1</span><br></pre></td></tr></table></figure>

<p>PE2:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[PE2]bgp 123</span><br><span class="line">[PE2-bgp] ipv4-family vpn-instance CEA </span><br><span class="line">[PE2-bgp-CEA]  import-route ospf 1</span><br><span class="line">[PE2-bgp-CEA]ospf 1 vpn-instance CEA</span><br><span class="line">[PE2-ospf-1] import-route bgp</span><br></pre></td></tr></table></figure>

<h6 id="配置八配置MPLS转发及LDP便签分发协议"><a href="#配置八配置MPLS转发及LDP便签分发协议" class="headerlink" title="配置八	配置MPLS转发及LDP便签分发协议"></a>配置八	配置MPLS转发及LDP便签分发协议</h6><p>PE1:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[PE1]mpls lsr-id 1.1.1.1 </span><br><span class="line">[PE1]mpls </span><br><span class="line">[PE1-mpls]mpls ldp</span><br><span class="line">[PE1-mpls-ldp]quit</span><br><span class="line"></span><br><span class="line">[PE1]interface g0/0/2</span><br><span class="line">[PE1-GigabitEthernet0/0/2]mpls </span><br><span class="line">[PE1-GigabitEthernet0/0/2]mpls ldp </span><br><span class="line">[PE1-GigabitEthernet0/0/2]quit</span><br><span class="line">[PE1]route recursive-lookup tunnel </span><br></pre></td></tr></table></figure>

<p>P:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[P]mpls </span><br><span class="line">[P-mpls]mpls ldp</span><br><span class="line">[P-mpls-ldp]</span><br><span class="line">[P-mpls-ldp]quit</span><br><span class="line"></span><br><span class="line">[P]int g0/0/0</span><br><span class="line">[P-GigabitEthernet0/0/0]mpls </span><br><span class="line">[P-GigabitEthernet0/0/0]mpls ldp</span><br><span class="line"></span><br><span class="line">[P-GigabitEthernet0/0/0]int g0/0/1</span><br><span class="line">[P-GigabitEthernet0/0/1]mpls </span><br><span class="line">[P-GigabitEthernet0/0/1]mpls ldp</span><br><span class="line">[P-GigabitEthernet0/0/1]quit</span><br><span class="line"></span><br><span class="line">[P]route recursive-lookup tunnel</span><br></pre></td></tr></table></figure>

<p>PE2:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[PE2]mpls lsr-id 3.3.3.3</span><br><span class="line">[PE2]mpls </span><br><span class="line">[PE2]mpls ldp </span><br><span class="line"></span><br><span class="line">[PE2]interface GigabitEthernet 0/0/0</span><br><span class="line">[PE2-GigabitEthernet0/0/0]mpls </span><br><span class="line">[PE2-GigabitEthernet0/0/0]mpls ldp </span><br><span class="line">[PE2]route recursive-lookup tunnel </span><br></pre></td></tr></table></figure>

<p>配置九	确保client1和client2之间互通</p>
<p>PE1:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[PE1]bgp 123</span><br><span class="line">[PE1-bgp]ipv4-family vpn-instance CEB</span><br><span class="line">[PE1-bgp-CEB]import-route direct </span><br></pre></td></tr></table></figure>

<p>PE2:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[PE2]bgp 123</span><br><span class="line">[PE2-bgp]ipv4-family vpn-instance CEB</span><br><span class="line">[PE2-bgp-CEB]import-route direct </span><br></pre></td></tr></table></figure>



<p>总结</p>
<img src="/2023/01/26/ICT%E7%AC%AC%E5%8D%81%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221216175529751.png" class="" title="image-20221216175529751">

      
    </div>
    <footer class="article-footer">
      <a data-url="http://lanyangyangy.github.io/2023/01/26/ICT%E7%AC%AC%E5%8D%81%E6%AC%A1%E7%AC%94%E8%AE%B0/" data-id="cldfxvtai000hvg9ubauchoxi" data-title="ICT第十次笔记" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ICT-%E6%95%B0%E9%80%9A/" rel="tag">ICT 数通</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-ICT第九次笔记" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/01/26/ICT%E7%AC%AC%E4%B9%9D%E6%AC%A1%E7%AC%94%E8%AE%B0/" class="article-date">
  <time class="dt-published" datetime="2023-01-26T04:52:06.000Z" itemprop="datePublished">2023-01-26</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/01/26/ICT%E7%AC%AC%E4%B9%9D%E6%AC%A1%E7%AC%94%E8%AE%B0/">ICT第九次笔记</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h3 id="组播"><a href="#组播" class="headerlink" title="组播"></a>组播</h3><p>定义：单一的信息流沿组播分发时被同时发送给一组用户，相同的组播数据流在每一条链路上至多有一份。</p>
<p>相对于单播和广播，使用组播的好处如下：</p>
<p>相比$\textcolor{blue}{单播}$，用户的增加不会导致信息源负载的过重，不会导致网络资源消耗的显著增加。</p>
<p>相比$\textcolor{blue}{广播}$，不会造成网络资源的浪费，并能提高信息传输的安全性，并且组播可以实现跨网段的传输。</p>
<h5 id="组播报文结构"><a href="#组播报文结构" class="headerlink" title="组播报文结构"></a>组播报文结构</h5><img src="/2023/01/26/ICT%E7%AC%AC%E4%B9%9D%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221205163251755.png" class="" title="image-20221205163251755">

<h5 id="组播IP地址"><a href="#组播IP地址" class="headerlink" title="组播IP地址"></a>组播IP地址</h5><p>在IPv4地址空间中，D类地址(224.0.0.1~239.255.255.254)被用于组播。一个组播地址就表示一个点到多点的数据流。</p>
<p>在大多数情况下，同一个组播网络里不同的业务就需要使用不同的组播IP地址。</p>
<img src="/2023/01/26/ICT%E7%AC%AC%E4%B9%9D%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221205165123390.png" class="" title="image-20221205165123390">

<h5 id="组播MAC地址"><a href="#组播MAC地址" class="headerlink" title="组播MAC地址"></a>组播MAC地址</h5><p>以太网传输IPv4单播报文时，目的MAC地址使用的是接收者的MAC地址。但是在传输组播数据时，其目的地就不再是一个具体的接收者，而是一个成员不确定组，要使用IPv4组播MAC地址。</p>
<p>组播IP可以一对多，用于多台设备，相当于他们在同一个组里。</p>
<img src="/2023/01/26/ICT%E7%AC%AC%E4%B9%9D%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221205165511443.png" class="" title="image-20221205165511443">

<h5 id="组播网络基本架构"><a href="#组播网络基本架构" class="headerlink" title="组播网络基本架构"></a>组播网络基本架构</h5><img src="/2023/01/26/ICT%E7%AC%AC%E4%B9%9D%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221205165952967.png" class="" title="image-20221205165952967">



<p>基本实验</p>
<img src="/2023/01/26/ICT%E7%AC%AC%E4%B9%9D%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221205173118053.png" class="" title="image-20221205173118053">

<p>目的：实现PC1与MCS1组播</p>
<p>路由器配置：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[Huawei]multicast routing-enable </span><br><span class="line">[Huawei]in g0/0/0</span><br><span class="line">[Huawei-GigabitEthernet0/0/0]pim</span><br><span class="line">[Huawei-pim]quit</span><br><span class="line">[Huawei]igmp    //初始化igmp</span><br><span class="line">[Huawei-igmp]int g0/0/0</span><br><span class="line">[Huawei-GigabitEthernet0/0/0]pim dm</span><br><span class="line">[Huawei-GigabitEthernet0/0/0]int g0/0/1</span><br><span class="line">[Huawei-GigabitEthernet0/0/0]igmp version 2</span><br></pre></td></tr></table></figure>



<h5 id="组播服务模型"><a href="#组播服务模型" class="headerlink" title="组播服务模型"></a>组播服务模型</h5><p>ASM（任意源组播）：组成员加入组播组后，组成员可以收到$\textcolor{pink}{任意源}$发送到该组的数据</p>
<p>SSM（指定源组播）：组成员加入组播组后，组成员只会收到$\textcolor{pink}{指定源}$发送到改组的数据。</p>
<img src="/2023/01/26/ICT%E7%AC%AC%E4%B9%9D%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221205205235297.png" class="" title="image-20221205205235297">



<p>组播路由表除了目的网络和出接口外还需要添加组播源和入接口的信息。设备仅转发从特定唯一的入接口收到的数据，从而避免组播转发时产生环路、次优、重复报文（部分解决）等问题。</p>
<p>对于相同的组播源，设备通过RPF（$\textcolor{red}{反向路径转发}$)检查可以确定设备上唯一的组播流量入接口。</p>
<img src="/2023/01/26/ICT%E7%AC%AC%E4%B9%9D%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221205210915267.png" class="" title="image-20221205210915267">

<p>组播协议：</p>
<p>成员网络协议IGMP：用于告知组播网络，组成员的位置与所加组播组。</p>
<p>转发网络协议</p>
<p>PIM（协议无关组播）：生成AS域内的组播分发树。</p>
<p>MSDP（组播源发现协议）：帮助生成AS域间的组播分发树。</p>
<p>MBGP（组播BGP）：帮助跨域进行RPF校验。</p>
<h4 id="IGMP"><a href="#IGMP" class="headerlink" title="IGMP"></a>IGMP</h4><h5 id="IGMPv1"><a href="#IGMPv1" class="headerlink" title="IGMPv1"></a>IGMPv1</h5><p>IGMPv1主要基于查询和响应机制完成组播组管理。</p>
<p>查询和响应机制由两种报文实现：</p>
<ul>
<li>普遍组查询报文（Query）：查询器向共享网络上所有主机和路由器发送的查询报文，用于查询哪些组播组存在成员。</li>
<li>成员关系报告报文：主机向查询器发送的报告报文，用于申请加入某个组播组或者应答查询报文。</li>
</ul>
<p>由于IGMP报文是组播报文，因此一个多路访问网络里只需要一个组播路由器发送查询报文即可，该组播路由器则被称为IGMP查询器。</p>
<p>IGMPv1离组不通知，使用超时机制，依赖PIM协议</p>
<h5 id="IGMPv2"><a href="#IGMPv2" class="headerlink" title="IGMPv2"></a>IGMPv2</h5><p>IGMPv2增加了离组机制</p>
<img src="/2023/01/26/ICT%E7%AC%AC%E4%B9%9D%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221206162108677.png" class="" title="image-20221206162108677">

<h5 id="版本差异"><a href="#版本差异" class="headerlink" title="版本差异"></a>版本差异<img src="/2023/01/26/ICT%E7%AC%AC%E4%B9%9D%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221206195606421.png" class="" title="image-20221206195606421"></h5><img src="/2023/01/26/ICT%E7%AC%AC%E4%B9%9D%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221206195853432.png" class="" title="image-20221206195853432">

<h5 id="IGMP-Snooping"><a href="#IGMP-Snooping" class="headerlink" title="IGMP Snooping"></a>IGMP Snooping</h5><img src="/2023/01/26/ICT%E7%AC%AC%E4%B9%9D%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221206195916247.png" class="" title="image-20221206195916247">



<img src="/2023/01/26/ICT%E7%AC%AC%E4%B9%9D%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221206200229160.png" class="" title="image-20221206200229160">

<img src="/2023/01/26/ICT%E7%AC%AC%E4%B9%9D%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221206201541434.png" class="" title="image-20221206201541434">



<p>组播分发树：</p>
<ul>
<li>以组播源为根，组播成员为叶子的组播分发树称为<strong>SPT</strong>，在PIM-DM与PIM-SM中均有使用。</li>
<li>以RP为根，组播组成员为叶子的组播分发树称为<strong>RPT</strong>，在PIM-SM中使用。</li>
</ul>
<h4 id="PIM-DM"><a href="#PIM-DM" class="headerlink" title="PIM-DM"></a>PIM-DM</h4><p>主要用在组成员较少且相对密集的网络中，通过“扩散-剪枝”的方式来形成组播转发树。</p>
<img src="/2023/01/26/ICT%E7%AC%AC%E4%B9%9D%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221208190338130.png" class="" title="image-20221208190338130">

<h5 id="扩散机制"><a href="#扩散机制" class="headerlink" title="扩散机制"></a>扩散机制</h5><p>组播源发送的组播报文会在全网内扩散。当PIM路由器接收到组播报文，先进行RPF检查，通过后会在该路由器上创建（S,G）表项，之后会向所有PIM邻居发送。</p>
<p>PIM-DM形成的（S-G）表项有老化时间（静默210s)，如果老化时间超时前没有收到新的组播报文，则删除（S-G）表项。</p>
<img src="/2023/01/26/ICT%E7%AC%AC%E4%B9%9D%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221208191618865.png" class="" title="image-20221208191618865">

<h5 id="剪枝机制"><a href="#剪枝机制" class="headerlink" title="剪枝机制"></a>剪枝机制</h5><p>对于没有组成员连接的组播路由器，组播网络无需再将组播流量继续放往该设备。通过剪枝机制，组播可以将此类路径剪枝。</p>
<img src="/2023/01/26/ICT%E7%AC%AC%E4%B9%9D%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221208191838413.png" class="" title="image-20221206220909094">

<h5 id="嫁接机制"><a href="#嫁接机制" class="headerlink" title="嫁接机制"></a>嫁接机制</h5><p>叶子路由通过IGMP了解到与其相连的用户网段上，组播组G有新的成员加入。随后叶子路由器会<strong>基于本址的组播路由表</strong>向上有发送Graft报文，请求上有路由器恢复相应出接口转发，将其添加在（S-G)表项下游接口列表中。</p>
<p><img src="/ICT%E7%AC%AC%E4%B9%9D%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221208192243290.png" alt="image-20221206220820358"><img src="/ICT%E7%AC%AC%E4%B9%9D%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221206205204072.png" alt="image-20221206205204072"></p>
<h5 id="PIM-DM协议报文"><a href="#PIM-DM协议报文" class="headerlink" title="PIM-DM协议报文"></a><img src="/2023/01/26/ICT%E7%AC%AC%E4%B9%9D%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221206210757887.png" class="" title="image-20221206210735893">PIM-DM协议报文</h5><img src="/2023/01/26/ICT%E7%AC%AC%E4%B9%9D%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221208190450691.png" class="" title="image-20221208190450691">



<h5 id="实验：组播路由协议pim-dm"><a href="#实验：组播路由协议pim-dm" class="headerlink" title="实验：组播路由协议pim-dm"></a>实验：组播路由协议pim-dm</h5><p>拓扑图：<img src="/2023/01/26/ICT%E7%AC%AC%E4%B9%9D%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221208192542678.png" class="" title="image-20221208192542678">配置PIM-DM：</p>
<p>R1:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">multicast routing-enable</span><br><span class="line">interface GigabitEthernet0/0/0</span><br><span class="line"> pim dm</span><br><span class="line"> </span><br><span class="line">interface GigabitEthernet0/0/1</span><br><span class="line"> pim dm</span><br><span class="line"></span><br><span class="line">interface GigabitEthernet0/0/2</span><br><span class="line"> pim dm</span><br></pre></td></tr></table></figure>

<p>R2:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">multicast routing-enable</span><br><span class="line">interface GigabitEthernet0/0/0</span><br><span class="line"> pim dm</span><br><span class="line"> </span><br><span class="line">interface GigabitEthernet0/0/1</span><br><span class="line"> pim dm</span><br></pre></td></tr></table></figure>

<p>R3:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">multicast routing-enable</span><br><span class="line">interface GigabitEthernet0/0/0</span><br><span class="line"> pim dm</span><br><span class="line"> </span><br><span class="line">interface GigabitEthernet0/0/1</span><br><span class="line"> pim dm</span><br></pre></td></tr></table></figure>

<p>R4:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">multicast routing-enable</span><br><span class="line">interface GigabitEthernet0/0/0</span><br><span class="line"> pim dm</span><br><span class="line"> </span><br><span class="line">interface GigabitEthernet0/0/1</span><br><span class="line"> pim dm</span><br></pre></td></tr></table></figure>

<p>配置igmp：</p>
<p>R4：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">interface GigabitEthernet0/0/2</span><br><span class="line">igmp version 2</span><br><span class="line">igmp enable</span><br></pre></td></tr></table></figure>

<p>PC1:</p>
<img src="/2023/01/26/ICT%E7%AC%AC%E4%B9%9D%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221208192813009.png" class="" title="image-20221208192813009">

<h4 id="PIM-SM"><a href="#PIM-SM" class="headerlink" title="PIM-SM"></a>PIM-SM</h4><p>PIM-DM的局限性</p>
<img src="/2023/01/26/ICT%E7%AC%AC%E4%B9%9D%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221208192949324.png" class="" title="image-20221206221042897">

<h5 id="PIM-SM协议报文"><a href="#PIM-SM协议报文" class="headerlink" title="PIM-SM协议报文"></a>PIM-SM协议报文</h5><img src="/2023/01/26/ICT%E7%AC%AC%E4%B9%9D%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221206221111088.png" class="" title="image-20221206221111088">



<h5 id="汇聚点RP"><a href="#汇聚点RP" class="headerlink" title="汇聚点RP"></a>汇聚点RP</h5><p>用于处理源端DR注册信息机组成员请求加入，网络中的所有PIM路由器都必须知道RP的地址。</p>
<ul>
<li>静态RP：在网络中的所有PIM路由器都必须配置相同的RP地址，静态指定RP的位置。</li>
<li>动态RP：通过选举机制在多个C-RP之间选举出RP</li>
</ul>
<h5 id="RPT创建"><a href="#RPT创建" class="headerlink" title="RPT创建"></a>RPT创建</h5><img src="/2023/01/26/ICT%E7%AC%AC%E4%B9%9D%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221206231253925.png" class="" title="image-20221206231253925">

<h5 id="首次形成组播分发树"><a href="#首次形成组播分发树" class="headerlink" title="首次形成组播分发树"></a>首次形成组播分发树</h5><p>PIM-SM模式首次形成组播分发树主要依赖RPT构建机制，组播源注册机制与DR选举机制。</p>
<p>RPT构建机制：组播叶子路由器主动建立到RP的组播分发树</p>
<p>组播源注册机制：通过该机制形成组播源到RP的组播分发树。</p>
<p>DR选举机制：DR负责源端或组成员端组播报文的手法，避免重复组播报文，同时成员端DR还负责发送Join加组信息。</p>
<h6 id="组播源注册机制"><a href="#组播源注册机制" class="headerlink" title="组播源注册机制"></a>组播源注册机制</h6><img src="/2023/01/26/ICT%E7%AC%AC%E4%B9%9D%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221206231405457.png" class="" title="image-20221206214421461">

<h6 id="DR选举机制"><a href="#DR选举机制" class="headerlink" title="DR选举机制"></a>DR选举机制</h6><img src="/2023/01/26/ICT%E7%AC%AC%E4%B9%9D%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221206231426336.png" class="" title="image-20221206231426336">

<h5 id="PIM-SM-1"><a href="#PIM-SM-1" class="headerlink" title="PIM-SM"></a>PIM-SM</h5><img src="/2023/01/26/ICT%E7%AC%AC%E4%B9%9D%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221208194554020.png" class="" title="image-20221208194554020">

<p>配置：</p>
<p>R1:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">multicast routing-enable </span><br><span class="line"></span><br><span class="line">interface GigabitEthernet0/0/0</span><br><span class="line"> pim sm</span><br><span class="line"> </span><br><span class="line">interface GigabitEthernet0/0/1</span><br><span class="line"> pim sm</span><br><span class="line"> </span><br><span class="line">pim</span><br><span class="line">static-rp 2.2.2.2     //静态</span><br><span class="line"></span><br><span class="line">int loopback 0     //动态</span><br><span class="line">pim sm </span><br><span class="line"></span><br><span class="line">pim</span><br><span class="line">c-bsr loopback 0</span><br></pre></td></tr></table></figure>

<p>R2:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">multicast routing-enable </span><br><span class="line">interface GigabitEthernet0/0/0</span><br><span class="line">pim sm</span><br><span class="line"></span><br><span class="line">interface GigabitEthernet0/0/1</span><br><span class="line">pim sm </span><br><span class="line"></span><br><span class="line">interface GigabitEthernet0/0/2</span><br><span class="line">pim sm</span><br><span class="line"> </span><br><span class="line">pim</span><br><span class="line">static-rp 2.2.2.2    //静态</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>R3:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">multicast routing-enable </span><br><span class="line">interface GigabitEthernet0/0/0</span><br><span class="line">pim sm</span><br><span class="line"></span><br><span class="line">pim</span><br><span class="line">static-rp 2.2.2.2     //配置静态RP</span><br></pre></td></tr></table></figure>

<p>R4:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">multicast routing-enable </span><br><span class="line">interface GigabitEthernet0/0/0</span><br><span class="line">pim sm</span><br><span class="line"></span><br><span class="line">pim</span><br><span class="line">static-rp 2.2.2.2  </span><br></pre></td></tr></table></figure>

<p>配置IGMP</p>
<p>R5:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">interface GigabitEthernet0/0/1</span><br><span class="line">igmp version 2</span><br><span class="line">igmp enable</span><br></pre></td></tr></table></figure>

<img src="/2023/01/26/ICT%E7%AC%AC%E4%B9%9D%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221213145857442.png" class="" title="image-20221213145857442">

<p>成为BSR后仍可以是RP</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://lanyangyangy.github.io/2023/01/26/ICT%E7%AC%AC%E4%B9%9D%E6%AC%A1%E7%AC%94%E8%AE%B0/" data-id="cldfxvtaa0003vg9u3p2f6hwc" data-title="ICT第九次笔记" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ICT-%E6%95%B0%E9%80%9A/" rel="tag">ICT 数通</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-ICT第八次笔记" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/01/26/ICT%E7%AC%AC%E5%85%AB%E6%AC%A1%E7%AC%94%E8%AE%B0/" class="article-date">
  <time class="dt-published" datetime="2023-01-26T04:44:53.000Z" itemprop="datePublished">2023-01-26</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/01/26/ICT%E7%AC%AC%E5%85%AB%E6%AC%A1%E7%AC%94%E8%AE%B0/">ICT第八次笔记</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h4 id="IPv6"><a href="#IPv6" class="headerlink" title="IPv6"></a>IPv6</h4><h5 id="IPv6的优势"><a href="#IPv6的优势" class="headerlink" title="IPv6的优势"></a>IPv6的优势</h5><p>1.“<strong>无限”地址空间</strong> 		$\textcolor{purple}{地址长度为128bit}$，海量的地址空间，满足物联网等新兴业务、有利于业务演进及扩展。 </p>
<p>2.<strong>层次化的地址结构</strong> 	相较于IPv4地址，IPv6地址的分配更加规范，利于路由聚合（缩减IPv6路由表规模）、路由快速查询。</p>
<ol start="3">
<li><strong>即插即用</strong> 					IPv6支持无状态地址自动配置（SLAAC），终端接入更简单。 </li>
<li><strong>简化的报文头部</strong>         简化报文头，提高效率；通过扩展包头支持新应用，利于路由器等网络设备的转发处理，降低投资成本。 </li>
<li><strong>安全特性</strong> 				   IPsec、真实源地址认证等保证端到端安全；避免NAT破坏端到端通信的完整性。</li>
<li><strong>移动性</strong>                      对移动网络实时通信有较大改进，整个移动网络性能有比较大的提升。</li>
<li><strong>增强的QoS特性</strong>       额外定义了流标签字段，可为应用程序或者终端所用，针对特殊的服务和数据流，分配特定的资源</li>
</ol>
<h5 id="IPv4-to-IPv6"><a href="#IPv4-to-IPv6" class="headerlink" title="IPv4 to IPv6"></a>IPv4 to IPv6</h5><p>IPv4网络演变为IPv6网络主要有以下三种技术： </p>
<ul>
<li>双栈技术：在一台设备上同时启用IPv4协议栈和IPv6协议栈的技术。</li>
<li>隧道技术：将一种协议的数据封装在另一种协议中的技术。 </li>
<li>转换技术：将IPv6地址和IPv4地址进行转换的一种技术。</li>
</ul>
<img src="/2023/01/26/ICT%E7%AC%AC%E5%85%AB%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221127152227390.png" class="" title="image-20221127152227390">



<p>与IPv4地址类似，IPv6也用“IPv6地址&#x2F;掩码长度”的方式来表示IPv6地址。</p>
<h5 id="IPv6地址格式"><a href="#IPv6地址格式" class="headerlink" title="IPv6地址格式"></a>IPv6地址格式</h5><p>1.首选格式</p>
<p>冒号分割为8段，每一段16bit，每一段内用十六进制表示。 </p>
<p> 用“IPv6地址&#x2F;掩码长度”的方式来表示。 </p>
<p>例如：2001:0DB8:0000:0001:0000:0000:0000:45ff&#x2F;64</p>
<p>IPv6地址&#x3D;网络前缀+接口标识</p>
<table>
<thead>
<tr>
<th>IPv6地址或前缀</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>2001::&#x2F;16</td>
<td>用于IPv6 Internet，类似于IPv4公网地址</td>
</tr>
<tr>
<td>2002::&#x2F;16</td>
<td>用于6to4隧道</td>
</tr>
<tr>
<td>FE80::&#x2F;10</td>
<td>链路本地地址前缀，用于本地链路范围内的通信</td>
</tr>
<tr>
<td>FF00::&#x2F;</td>
<td>组播地址前缀，用于IPv6组播</td>
</tr>
<tr>
<td>::&#x2F;128</td>
<td>未指定地址，类似于IPv4中的0.0.0.0</td>
</tr>
<tr>
<td>::1&#x2F;12</td>
<td>环回地址，类似于IPv4中的127.0.0.1</td>
</tr>
</tbody></table>
<h5 id="IPv6地址接口标识"><a href="#IPv6地址接口标识" class="headerlink" title="IPv6地址接口标识"></a>IPv6地址接口标识</h5><p>接口ID可通过三种方式生成：手工配置、系统自动生成、<strong>基于IEEE EUI-64规范生成</strong>。</p>
<p>基于IEEE EUI-64规范生成使用最为普遍，其是基于接口的MAC地址转为IPv6地址接口标识</p>
<img src="/2023/01/26/ICT%E7%AC%AC%E5%85%AB%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221127190507339.png" class="" title="image-20221127190507339">

<p>改动：在第四个位置插入FFFE </p>
<p>​			同时第7bit取反</p>
<h5 id="IPv6地址类型"><a href="#IPv6地址类型" class="headerlink" title="IPv6地址类型"></a>IPv6地址类型</h5><img src="ICT第八次笔记/image-20221127191153879.png" alt="image-20221127191153879" style="zoom:150%;" />

<p> <strong>单播地址</strong>：标识一个接口，目的地址为单播地址的报文会被送到被标识的接口。   在IPv6中，<strong>一个接口拥有多个IPv6地址是非常常见的现象。</strong></p>
<p><strong>组播地址</strong>：标识多个接口，目的地址为组播地址的报文会被送到被标识的<strong>所有</strong>接口。只有加入相应组播组的设备接口才会侦听发往该组播地址的报文。</p>
<p><strong>任播地址</strong>： 任播地址标识一组网络接口（通常属于不同的节点）。目标地址是任播地址的数据包将 发送给其中路由意义上最近的一个网络接口。</p>
<p>$\textcolor{red}{IPv6没有定义广播地址}$</p>
<h5 id="GUA-全球单播地址"><a href="#GUA-全球单播地址" class="headerlink" title="GUA(全球单播地址)"></a>GUA(全球单播地址)</h5><p>该类地址全球唯一， 用于需要有互联网访问需求的主机，相当于IPv4的公网地址。</p>
<img src="ICT第八次笔记/image-20221127201430041.png" alt="image-20221127201430041" style="zoom:150%;" />

<h5 id="ULA"><a href="#ULA" class="headerlink" title="ULA"></a>ULA</h5><p>IPv6私网地址，只能够在内网中使用。该地址空间在 IPv6公网中不可被路由，因此不能直接访问公网。</p>
<img src="ICT第八次笔记/image-20221127201523887.png" alt="image-20221127201523887" style="zoom:150%;" />

<h5 id="LLA"><a href="#LLA" class="headerlink" title="LLA"></a>LLA</h5><p>IPv6中另一种应用范围受限制的地址类型。 LLA的有效范围是本地链路，	前缀为FE80：：&#x2F;10。</p>
<img src="ICT第八次笔记/image-20221127193808065.png" alt="image-20221127193808065" style="zoom:150%;" />

<p>• LLA用于一条单一链路层面的通信，例如IPv6地址 无状态自动配置、IPv6邻居发现等。</p>
<p>• 源或目的IPv6地址为链路本地地址的数据包将不 会被转发到始发的链路之外，换句话说，链路本 地地址的有效范围为本地链路。 </p>
<p>• 每一个IPv6接口都必须具备一个链路本地地址。 华为设备支持<strong>自动生成</strong>和<strong>手工指定</strong>两种配置方式。</p>
<h5 id="IPv6组播"><a href="#IPv6组播" class="headerlink" title="IPv6组播"></a>IPv6组播</h5><p>IPv6组播地址</p>
<p>IPv6组播地址标识某个组，目的为组播地址的报文会被送到该组播组内的成员。组播地址由</p>
<p>​							前缀 （FF::&#x2F;8）</p>
<p>​							标志（Flag）字段</p>
<p>​							范围（Scope）字段</p>
<p>​							组播组ID</p>
<img src="ICT第八次笔记/image-20221127200001524.png" alt="image-20221127200001524" style="zoom:150%;" />

<p>组播MAC</p>
<p>组播MAC的前16bit为“33:33” ，是专门为IPv6组播预留的MAC地址前缀。后32bit从组播IPv6地址 的后32bit直接映射而来。</p>
<img src="/2023/01/26/ICT%E7%AC%AC%E5%85%AB%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221127200930729.png" class="" title="image-20221127200930729">







<h5 id="静态路由"><a href="#静态路由" class="headerlink" title="静态路由"></a>静态路由</h5><img src="/2023/01/26/ICT%E7%AC%AC%E5%85%AB%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221127205934813.png" class="" title="image-20221127205934813">

<p>基础配置：</p>
<p>AR5:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[Huawei]ipv6</span><br><span class="line">[Huawei]int g0/0/1</span><br><span class="line">[Huawei-GigabitEthernet0/0/1]ipv6 enable</span><br><span class="line">[Huawei-GigabitEthernet0/0/1]ipv6 address 2012::1/64 </span><br></pre></td></tr></table></figure>

<p>AR6</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[Huawei]ipv6</span><br><span class="line">[Huawei]int g0/0/0</span><br><span class="line">[Huawei-GigabitEthernet0/0/0]ipv6 enable</span><br><span class="line">[Huawei-GigabitEthernet0/0/0]ipv6 address 2012::2/64 </span><br><span class="line">[Huawei-GigabitEthernet0/0/0]int loop 0</span><br><span class="line">[Huawei-LoopBack0]ipv6 en</span><br><span class="line">[Huawei-LoopBack0]ipv6 address 2022::1 64</span><br></pre></td></tr></table></figure>

<p>静态路由：</p>
<p>AR5：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei]ipv6 route-static 2022:: 64 2012::2</span><br></pre></td></tr></table></figure>



<h5 id="动态路由"><a href="#动态路由" class="headerlink" title="动态路由"></a>动态路由</h5><h6 id="ospfv3"><a href="#ospfv3" class="headerlink" title="ospfv3"></a>ospfv3</h6><p>Router ID  来源方式 手动配置 环回口  物理口</p>
<p>AR5</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[Huawei]ospfv3</span><br><span class="line">[Huawei-ospfv3-1]router-id 1.1.1.1</span><br><span class="line">[Huawei-ospfv3-1]area 0</span><br><span class="line">[Huawei-ospfv3-1-area-0.0.0.0]quit</span><br><span class="line">[Huawei-ospfv3-1]int g0/0/1</span><br><span class="line">[Huawei-GigabitEthernet0/0/1]ospfv3 1 area 0</span><br></pre></td></tr></table></figure>

<p>AR6</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[Huawei]ospfv3 </span><br><span class="line">[Huawei-ospfv3-1]router-id 2.2.2.2</span><br><span class="line">[Huawei-ospfv3-1]area 0</span><br><span class="line">[Huawei-ospfv3-1-area-0.0.0.0]quit</span><br><span class="line">[Huawei-ospfv3-1]int g0/0/0</span><br><span class="line">[Huawei-GigabitEthernet0/0/0]ospfv3 1 area 0</span><br><span class="line">[Huawei-GigabitEthernet0/0/0]int g0/0/1</span><br><span class="line">Huawei-GigabitEthernet0/0/1]ipv6 add	</span><br><span class="line">[Huawei-GigabitEthernet0/0/1]ipv6 address 2023::1 64</span><br><span class="line">[Huawei-GigabitEthernet0/0/1]ospfv3 1 area 0</span><br></pre></td></tr></table></figure>

<p>AR7</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[Huawei]ipv6</span><br><span class="line">[Huawei]int g0/0/0</span><br><span class="line">[Huawei-GigabitEthernet0/0/0]ipv6 en</span><br><span class="line">[Huawei-GigabitEthernet0/0/0]ipv6 add 2022::2 64</span><br><span class="line">[Huawei-GigabitEthernet0/0/0]quit</span><br><span class="line">[Huawei]ospfv3</span><br><span class="line">[Huawei-ospfv3-1]router-id 3.3.3.3</span><br><span class="line">[Huawei-ospfv3-1]area 0</span><br><span class="line">[Huawei-ospfv3-1-area-0.0.0.0]quit</span><br><span class="line">[Huawei]int g0/0/0</span><br><span class="line">[Huawei-GigabitEthernet0/0/0]ospfv3 1 area 0</span><br><span class="line">[Huawei-GigabitEthernet0/0/0]quit</span><br></pre></td></tr></table></figure>



<p>查看邻居关系</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">display ospfv3 peer</span><br></pre></td></tr></table></figure>

<h6 id="BGP"><a href="#BGP" class="headerlink" title="BGP"></a>BGP</h6><p>R5</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[Huawei]bgp 1</span><br><span class="line">[Huawei-bgp]router-id 1.1.1.1 </span><br><span class="line">[Huawei-bgp]peer 2022::2 as-number 1</span><br><span class="line">[Huawei-bgp]ipv6-family unicast</span><br><span class="line">[Huawei-bgp-af-ipv6]peer 2022::2 enable</span><br></pre></td></tr></table></figure>

<p>R7</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[Huawei]bgp 1</span><br><span class="line">[Huawei-bgp]router-id 3.3.3.3 </span><br><span class="line">[Huawei-bgp]peer 2012::1 as-number 1</span><br><span class="line">[Huawei-bgp]ipv6-family unicast</span><br><span class="line">[Huawei-bgp-af-ipv6]peer 2012::1 enable</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">display bgp ipv6 peer   //查看bgp邻居状态</span><br></pre></td></tr></table></figure>

<img src="/2023/01/26/ICT%E7%AC%AC%E5%85%AB%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221127224159032.png" class="" title="image-20221127224159032">





<h5 id="ICMPv6"><a href="#ICMPv6" class="headerlink" title="ICMPv6"></a>ICMPv6</h5><p>Path MTU</p>
<img src="/2023/01/26/ICT%E7%AC%AC%E5%85%AB%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221130233130647.png" class="" title="image-20221130233130647">

<img src="/2023/01/26/ICT%E7%AC%AC%E5%85%AB%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221130233259212.png" class="" title="image-20221130233259212">

<img src="/2023/01/26/ICT%E7%AC%AC%E5%85%AB%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221130233633155.png" class="" title="image-20221130233633155">

<h5 id="无状态自动配置"><a href="#无状态自动配置" class="headerlink" title="无状态自动配置"></a>无状态自动配置</h5><img src="/2023/01/26/ICT%E7%AC%AC%E5%85%AB%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221201000426054.png" class="" title="image-20221201000426054">

<p>1.在R1&#x2F;R2（$\textcolor{blue}{服务端&#x2F;用户端}$)使能IPv6，并且让接口自动生成链路本地地址</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;Huawei&gt;sysname</span><br><span class="line"></span><br><span class="line">[Huawei]sysname R1</span><br><span class="line">[R1]ipv6</span><br><span class="line">[R1]int g0/0/0</span><br><span class="line">[R1-GigabitEthernet0/0/0]ipv6 enable   端口启用IPv6</span><br><span class="line">[R1-GigabitEthernet0/0/0]ipv6 address auto link-local   #接口生成link-local地址</span><br></pre></td></tr></table></figure>

<p>同理R2($\textcolor{blue}{用户端}$)的配置与R1一致</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;Huawei&gt;sys</span><br><span class="line">[Huawei]sysname R2</span><br><span class="line">[R2]ipv6</span><br><span class="line">[R2]int g0/0/0</span><br><span class="line">[R2-GigabitEthernet0/0/0]ipv6 enable</span><br><span class="line">[R2-GigabitEthernet0/0/0]ipv6 address auto link-local</span><br></pre></td></tr></table></figure>

<pre><code> 2.在R2($\textcolor&#123;blue&#125;&#123;用户端&#125;$)的接口上配置IPv6全球单播地址
</code></pre>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[R2]int g0/0/0</span><br><span class="line">[R2-GigabitEthernet0/0/0]ipv6 address 2001::2/64</span><br></pre></td></tr></table></figure>

<p>3.在R2（$\textcolor{blue}{用户端}$）使能发布RA报文的功能。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[R2-GigabitEthernet0/0/0]undo ipv6 nd ra halt</span><br></pre></td></tr></table></figure>

<p>4.配置R1（$\textcolor{blue}{服务器}$）的GE0&#x2F;0&#x2F;0接口自动火区IPv6地址。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[R1]int g0/0/0</span><br><span class="line">[R1-GigabitEthernet0/0/0]ipv6 address auto global</span><br></pre></td></tr></table></figure>

<p>5.检查R1的IP地址</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[R1]display ipv6 interface brief </span><br></pre></td></tr></table></figure>

<img src="/2023/01/26/ICT%E7%AC%AC%E5%85%AB%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221201002805753.png" class="" title="image-20221201002805753">

<h5 id="DHCPv6配置"><a href="#DHCPv6配置" class="headerlink" title="DHCPv6配置"></a>DHCPv6配置</h5><p>1.配置R2接口IPv6信息</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[R2]int g0/0/1</span><br><span class="line">[R2-GigabitEthernet0/0/1]ipv6 enable </span><br><span class="line">[R2-GigabitEthernet0/0/1]ipv6 address 2002::2/64</span><br><span class="line">[R2-GigabitEthernet0/0/1]ipv6 address auto link-local</span><br><span class="line">[R2-GigabitEthernet0/0/1]undo ipv6 nd ra halt</span><br></pre></td></tr></table></figure>

<p>2.配置R2上的DHCPv6服务器功能</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[R2]dhcp enable </span><br><span class="line">[R2]dhcpv6 pool pool1</span><br><span class="line">[R2-dhcpv6-pool-pool1]address prefix 2002::/64</span><br><span class="line">[R2-dhcpv6-pool-pool1]excluded-address 2002::1</span><br><span class="line">[R2-dhcpv6-pool-pool1]dns-server 240e:47:0:701::1</span><br><span class="line">[R2-dhcpv6-pool-pool1]int g0/0/1</span><br><span class="line">[R2-GigabitEthernet0/0/1]dhcpv6 server pool1</span><br></pre></td></tr></table></figure>

<p>3.在R3的G0&#x2F;0&#x2F;0接口通过dhcpv6获取ipv6地址</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[Huawei]ipv6</span><br><span class="line">[Huawei]dhcp enable</span><br><span class="line">[Huawei]int g0/0/0</span><br><span class="line">[Huawei-GigabitEthernet0/0/0]ipv6 enable</span><br><span class="line">[Huawei-GigabitEthernet0/0/0]ipv6 address auto link-local</span><br><span class="line">[Huawei-GigabitEthernet0/0/0]ipv6 address auto dhcp</span><br></pre></td></tr></table></figure>

<p>4.查看获取到的IPv6地址</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">display ipv6 interface brief</span><br></pre></td></tr></table></figure>

<img src="/2023/01/26/ICT%E7%AC%AC%E5%85%AB%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221201004352972.png" class="" title="image-20221201004352972">

<h5 id="IP4-IPv6"><a href="#IP4-IPv6" class="headerlink" title="IP4-IPv6"></a>IP4-IPv6</h5><p>实验</p>
<img src="/2023/01/26/ICT%E7%AC%AC%E5%85%AB%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221201170558874.png" class="" title="image-20221201170558874">

<p>图上所示地址均已配置</p>
<p>先在R1上配置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;R1&gt;sys</span><br><span class="line">[R1]interface Tunnel 0/0/0</span><br><span class="line">[R1-Tunnel0/0/0]tunnel-protocol ipv4-ipv6</span><br><span class="line">[R1-Tunnel0/0/0]source 2012::1</span><br><span class="line">[R1-Tunnel0/0/0]destination 2023::3</span><br><span class="line">[R1-Tunnel0/0/0]ip address 13.1.1.1 24</span><br></pre></td></tr></table></figure>

<p>R3配置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;R3&gt;sys</span><br><span class="line">[R3]interface Tunnel 0/0/0</span><br><span class="line">[R3-Tunnel0/0/0]tunnel-protocol ipv4-ipv6</span><br><span class="line">[R3-Tunnel0/0/0]source 2023::3</span><br><span class="line">[R3-Tunnel0/0/0]destination 2012::1</span><br><span class="line">[R3-Tunnel0/0/0]ip address 13.1.1.3 24</span><br></pre></td></tr></table></figure>

<p>再配置R1、R3的路由</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">R1</span><br><span class="line"></span><br><span class="line">[R1]ospf 1</span><br><span class="line">[R1-ospf-1]area 0</span><br><span class="line">[R1-ospf-1-area-0.0.0.0]netw	</span><br><span class="line">[R1-ospf-1-area-0.0.0.0]network 13.1.1.0 0.0.0.255</span><br><span class="line">[R1-ospf-1-area-0.0.0.0]net	</span><br><span class="line">[R1-ospf-1-area-0.0.0.0]network 192.168.1.0 0.0.0.255</span><br><span class="line"></span><br><span class="line">R3</span><br><span class="line"></span><br><span class="line">[R3]ospf 1</span><br><span class="line">[R3-ospf-1]area 0</span><br><span class="line">[R3-ospf-1-area-0.0.0.0]netw	</span><br><span class="line">[R3-ospf-1-area-0.0.0.0]network 192.168.2.0 0.0.0.255</span><br><span class="line">[R3-ospf-1-area-0.0.0.0]netw	</span><br><span class="line">[R3-ospf-1-area-0.0.0.0]network 13.1.1.0 0.0.0.255</span><br></pre></td></tr></table></figure>

<h5 id="IPV6-IPV4"><a href="#IPV6-IPV4" class="headerlink" title="IPV6-IPV4"></a>IPV6-IPV4</h5><img src="/2023/01/26/ICT%E7%AC%AC%E5%85%AB%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221201215719946.png" class="" title="image-20221201215719946">

<h6 id="实验配置"><a href="#实验配置" class="headerlink" title="实验配置"></a>实验配置</h6><p>R1：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;R1&gt;sys</span><br><span class="line">[R1]interface Tunnel0/0/0</span><br><span class="line">[R1-Tunnel0/0/0] ipv6 enable </span><br><span class="line">[R1-Tunnel0/0/0] ipv6 address auto link-local</span><br><span class="line">[R1-Tunnel0/0/0] tunnel-protocol ipv6-ipv4 6to4</span><br><span class="line">[R1-Tunnel0/0/0] source 12.1.1.1</span><br><span class="line">[R1-Tunnel0/0/0]quit</span><br><span class="line">[R1]ipv6  route-static 2002:1701:0103:: 64 Tunnel 0/0/0</span><br></pre></td></tr></table></figure>

<p>R2</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[R2] interface Tunnel0/0/0</span><br><span class="line">[R2-Tunnel0/0/0] ipv6 enable </span><br><span class="line">[R2-Tunnel0/0/0] ipv6 address auto link-local</span><br><span class="line">Info: Please enable IPv6 function in system view. </span><br><span class="line">[R2-Tunnel0/0/0] tunnel-protocol ipv6-ipv4 6to4</span><br><span class="line">[R2-Tunnel0/0/0] source 23.1.1.3</span><br><span class="line">[R2-Tunnel0/0/0]quit</span><br><span class="line">[R2]ipv6 route-static 2001:0c01:0101:: 64 Tunnel 0/0/0   </span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://lanyangyangy.github.io/2023/01/26/ICT%E7%AC%AC%E5%85%AB%E6%AC%A1%E7%AC%94%E8%AE%B0/" data-id="cldfxvtag000dvg9u2bdg5q67" data-title="ICT第八次笔记" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ICT-%E6%95%B0%E9%80%9A/" rel="tag">ICT 数通</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-ICT第七次笔记" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/01/26/ICT%E7%AC%AC%E4%B8%83%E6%AC%A1%E7%AC%94%E8%AE%B0/" class="article-date">
  <time class="dt-published" datetime="2023-01-26T04:44:43.000Z" itemprop="datePublished">2023-01-26</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/01/26/ICT%E7%AC%AC%E4%B8%83%E6%AC%A1%E7%AC%94%E8%AE%B0/">ICT第七次笔记</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h4 id="路径控制"><a href="#路径控制" class="headerlink" title="路径控制"></a>路径控制</h4><p>​      传统的路由转发原理是首先根据报文的目的地址查找路由表，然后进行报文转发。但是目前越来越多的用户希望能够在传统路由转发的基础上根据自己定义的策略进行报文转发和选路。策略路由使网络管理者不仅能够根据报文的目的地址，而且能够根据报文的源地址、报文大小和链路质量等属性来制定策略路由，以改变数据包转发路径，满足用户需求。</p>
<h5 id="拓扑图："><a href="#拓扑图：" class="headerlink" title="拓扑图："></a>拓扑图：</h5><img src="/2023/01/26/ICT%E7%AC%AC%E4%B8%83%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221120211946322.png" class="" title="image-20221120211946322">

<h5 id="实验要求："><a href="#实验要求：" class="headerlink" title="实验要求："></a>实验要求：</h5><p>源地址为4.4.4.4的数据包走CNC（联通）出网 </p>
<p>源地址为192.168.1.0&#x2F;24的数据包走CT（电信）出网</p>
<h5 id="实验配置："><a href="#实验配置：" class="headerlink" title="实验配置："></a>实验配置：</h5><h6 id="基本配置："><a href="#基本配置：" class="headerlink" title="基本配置："></a>基本配置：</h6><p>除CE，R4外其余IP配置均已完成</p>
<p>配置CE：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[CE]inter g0/0/0</span><br><span class="line">[CE-GigabitEthernet0/0/0]ip add 183.165.11.2 30</span><br><span class="line">[CE]inter g0/0/1</span><br><span class="line">[CE-GigabitEthernet0/0/1]ip add 61.16.18.2 30</span><br><span class="line">[CE]inter g0/0/2</span><br><span class="line">[CE-GigabitEthernet0/0/2]ip add 192.168.1.1 24</span><br><span class="line">[CE]ip route-static 4.4.4.4 32 192.168.1.2    #配置静态路由指向R4环回口</span><br></pre></td></tr></table></figure>

<p>配置NAT：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[CE]acl number 2100 </span><br><span class="line">[CE-acl-basic-2100]rule  permit    #匹配所有流量</span><br><span class="line">[CE]inter g0/0/0</span><br><span class="line">[CE-GigabitEthernet0/0/0]nat outbound 2100</span><br><span class="line">[CE]inter g0/0/1     </span><br><span class="line">[CE-GigabitEthernet0/0/1]nat outbound 2100</span><br></pre></td></tr></table></figure>

<p>AR4 IP配置：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[R4]inter g0/0/0</span><br><span class="line">[R4-GigabitEthernet0/0/0]ip add 192.168.1.2 24</span><br><span class="line">[R4]ip  route-static 0.0.0.0 0.0.0.0 192.168.1.1</span><br><span class="line">[R4]int LoopBack 0					配置环回口地址</span><br><span class="line">[R4-LoopBack0]ip add 4.4.4.4 32  </span><br></pre></td></tr></table></figure>

<h6 id="配置基于接口-策略路由"><a href="#配置基于接口-策略路由" class="headerlink" title="配置基于接口 策略路由"></a>配置基于接口 策略路由</h6><p>使用traffic-class流量分类</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[CE]acl number 2000</span><br><span class="line">[CE-acl-basic-2000]rule permit source 4.4.4.4 0</span><br><span class="line">[CE-acl-basic-2000]rule deny </span><br><span class="line">[CE]acl number 2001 </span><br><span class="line"></span><br><span class="line">[CE-acl-basic-2001]rule  permit source 192.168.1.0 0.0.0.255</span><br><span class="line"></span><br><span class="line">[CE]traffic classifier CT</span><br><span class="line">[CE-classifier-CT]if-match acl 2001</span><br><span class="line"></span><br><span class="line">[CE]traffic classifier CNC</span><br><span class="line">[CE-classifier-CNC]if-match acl 2000</span><br></pre></td></tr></table></figure>

<p>使用traffic-behave设置对应动作</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[CE]traffic behavior CT</span><br><span class="line">[CE-behavior-CT]redirect ip-nexthop 61.16.18.1   //指向电信</span><br><span class="line">[CE]traffic behavior CNC          </span><br><span class="line">[CE-behavior-CNC]redirect ip-nexthop 183.165.11.1 	//指向联通</span><br></pre></td></tr></table></figure>

<p>实验用traffic-polic关联流量和动作</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[CE]traffic policy PBR</span><br><span class="line">[CE-trafficpolicy-PBR]classifier CT behavior CT</span><br><span class="line">[CE-trafficpolicy-PBR]classifier CNC behavior CNC</span><br></pre></td></tr></table></figure>



<p>路由控制步骤：</p>
<ol>
<li>进行分类</li>
<li>设置动作，移动方向</li>
<li>进行关联</li>
</ol>
<h5 id="2、基于链路检测策略路由"><a href="#2、基于链路检测策略路由" class="headerlink" title="2、基于链路检测策略路由"></a>2、基于链路检测策略路由</h5><img src="/2023/01/26/ICT%E7%AC%AC%E4%B8%83%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221120211946322.png" class="" title="image-20221120211946322">

<p>需求：</p>
<p>源地址为4.4.4.4的数据包走CNC（联通）出网，当链路出现故障时候走电信 </p>
<p>源地址为192.168.1.0&#x2F;24的数据包走CT（电信）出网，当链路出现故障时候走联通</p>
<h6 id="配置NQA检测链路："><a href="#配置NQA检测链路：" class="headerlink" title="配置NQA检测链路："></a>配置NQA检测链路：</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[CE]nqa test-instance icmp CT</span><br><span class="line">[CE-nqa-icmp-CT]test-type icmp</span><br><span class="line">[CE-nqa-icmp-CT]source-address ipv4 61.16.18.2 </span><br><span class="line"></span><br><span class="line">[CE-nqa-icmp-CT]destination-address ipv4 61.16.18.1</span><br><span class="line">[CE-nqa-icmp-CT]frequency 20 </span><br><span class="line">[CE-nqa-icmp-CT]probe-count 1</span><br><span class="line">[CE-nqa-icmp-CT]start now </span><br><span class="line"></span><br><span class="line">[CE]nqa test-instance icmp CNC</span><br><span class="line"></span><br><span class="line">[CE-nqa-icmp-CNC]test-type icmp</span><br><span class="line"></span><br><span class="line">[CE-nqa-icmp-CNC]source-address ipv4 183.165.11.2</span><br><span class="line">[CE-nqa-icmp-CNC]destination-address ipv4 183.165.11.1</span><br><span class="line">[CE-nqa-icmp-CNC]frequency 20 </span><br><span class="line"></span><br><span class="line">[CE-nqa-icmp-CNC]probe-count 1</span><br><span class="line">[CE-nqa-icmp-CNC]start now </span><br></pre></td></tr></table></figure>

<h6 id="将NAQ和traffic-behave关联"><a href="#将NAQ和traffic-behave关联" class="headerlink" title="将NAQ和traffic behave关联"></a>将NAQ和traffic behave关联</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[CE]traffic behavior CT                              </span><br><span class="line">[CE-behavior-CT]redirect ip-nexthop 61.16.18.1 track nqa icmp CT</span><br><span class="line"></span><br><span class="line">[CE]traffic behavior CNC</span><br><span class="line"></span><br><span class="line">[CE-behavior-CNC]redirect ip-nexthop 183.165.11.1 track nqa icmp CNC </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h6 id="使用traffic-class流量分类"><a href="#使用traffic-class流量分类" class="headerlink" title="使用traffic-class流量分类"></a>使用traffic-class流量分类</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[CE]acl number 2000</span><br><span class="line">[CE-acl-basic-2000]rule permit source 4.4.4.4 0</span><br><span class="line">[CE-acl-basic-2000]rule deny </span><br><span class="line">[CE]acl number 2001 </span><br><span class="line"></span><br><span class="line">[CE-acl-basic-2001]rule  permit source 192.168.1.0 0.0.0.255</span><br><span class="line"></span><br><span class="line">[CE]traffic classifier CT</span><br><span class="line"></span><br><span class="line">[CE-classifier-CT]if-match acl 2001</span><br><span class="line">[CE]traffic classifier CNC</span><br><span class="line"></span><br><span class="line">[CE-classifier-CNC]if-match acl 2000</span><br></pre></td></tr></table></figure>

<h6 id="实验用traffic-polic关联流量和动作"><a href="#实验用traffic-polic关联流量和动作" class="headerlink" title="实验用traffic-polic关联流量和动作"></a>实验用traffic-polic关联流量和动作</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[CE]traffic policy PBR</span><br><span class="line">[CE-trafficpolicy-PBR]classifier CT behavior CT preference 10   #最后的命令在ensp上是没有的需要真机或者eve-ng上的ar1000v</span><br><span class="line"></span><br><span class="line">[CE-trafficpolicy-PBR]classifier CNC behavior CNC preference 30</span><br></pre></td></tr></table></figure>

<h6 id="华为路由器默认不切换，只是失效，失效后安装路由进行数据转发"><a href="#华为路由器默认不切换，只是失效，失效后安装路由进行数据转发" class="headerlink" title="华为路由器默认不切换，只是失效，失效后安装路由进行数据转发"></a>华为路由器默认不切换，只是失效，失效后安装路由进行数据转发</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ip route-static 0.0.0.0 0.0.0.0 61.16.18.1 track nqa CT icmp</span><br><span class="line">ip route-static 0.0.0.0 0.0.0.0 183.165.11.1 track nqa CNC icmp</span><br></pre></td></tr></table></figure>

<p>可以参考<a target="_blank" rel="noopener" href="https://support.huawei.com/enterprise/zh/doc/EDOC1000178149/70bbde5f">华为官方配置</a></p>
<h4 id="NAT"><a href="#NAT" class="headerlink" title="NAT"></a>NAT</h4><p>NAT都是应用在端口上</p>
<img src="/2023/01/26/ICT%E7%AC%AC%E4%B8%83%E6%AC%A1%E7%AC%94%E8%AE%B0/41531.png" class="" title="img">



<h5 id="1-basic-nat"><a href="#1-basic-nat" class="headerlink" title="1.basic nat"></a>1.basic nat</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[Huawei]nat address-group 1 192.168.1.15 192.168.1.16  #定义公网地址池</span><br><span class="line">[Huawei]acl number 2000 </span><br><span class="line"></span><br><span class="line">[Huawei-acl-basic-2000]rule permit source 192.168.10.0 0.0.0.2255     #定义那些内网地址进行nat转换</span><br><span class="line">[Huawei-acl-basic-2000]rule deny </span><br><span class="line">[Huawei]interface GigabitEthernet 0/0/1</span><br><span class="line">[Huawei-GigabitEthernet0/0/1]nat outbound 2000 address-group 1 no-pat </span><br></pre></td></tr></table></figure>

<blockquote>
<p>NO-PAT（Not Port Address Translation）模式下，一个外网地址同一时间只能分配给一个内网地址进行地址转换，不能同时被多个内网地址共用。当使用某外网地址的内网用户停止访问外网时，NAT会将其占用的外网地址释放并分配给其他内网用户使用。</p>
<p>该模式下，NAT设备只对报文的IP地址进行NAT转换，同时会建立一个NO-PAT表项用于记录IP地址映射关系，并可支持所有IP协议的报文。</p>
</blockquote>
<h6 id="2-PAT"><a href="#2-PAT" class="headerlink" title="2.PAT"></a>2.PAT</h6><p>PAT（Port Address Translation）模式下，一个NAT地址可以同时分配给多个内网地址共用。该模式下，NAT设备需要对报文的<strong>IP地址</strong>和<strong>传输层端口</strong>同时进行转换，且只支持TCP、UDP和ICMP（Internet Control Message Protocol，互联网控制消息协议）查询报文。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[Huawei]nat address-group 1 192.168.1.15 192.168.1.16  #定义公网地址池</span><br><span class="line">[Huawei]acl number 2000 </span><br><span class="line"></span><br><span class="line">[Huawei-acl-basic-2000]rule permit source 192.168.10.0 0.0.0.2255     #定义那些内网地址进行nat转换</span><br><span class="line">[Huawei-acl-basic-2000]rule deny </span><br><span class="line">[Huawei]interface GigabitEthernet 0/0/1</span><br><span class="line">[Huawei-GigabitEthernet0/0/1]nat outbound 2000 address-group 1</span><br></pre></td></tr></table></figure>

<h6 id="3-Easy-IP"><a href="#3-Easy-IP" class="headerlink" title="3.Easy 	IP"></a>3.Easy 	IP</h6><p><strong>NAT设备直接使用出接口的IP地址作为转换后的源地址</strong></p>
<p><strong>不用预先配置地址池</strong></p>
<p><strong>工作原理与普通NAPT相同，是NAPT的一种特例</strong></p>
<p><strong>适用于拨号接入Internet或动态获得IP地址的场合</strong></p>
<p>配置步骤：</p>
<img src="/2023/01/26/ICT%E7%AC%AC%E4%B8%83%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221123184819223.png" class="" title="image-20221123184819223">

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[Huawei]acl number 2000 </span><br><span class="line"></span><br><span class="line">[Huawei-acl-basic-2000]rule permit source 192.168.10.0 0.0.0.2255     #定义那些内网地址进行nat转换</span><br><span class="line">[Huawei-acl-basic-2000]rule deny </span><br><span class="line"></span><br><span class="line">[Huawei]inter g0/0/1</span><br><span class="line">[Huawei-GigabitEthernet0/0/1]nat   outbound 2000</span><br></pre></td></tr></table></figure>

<h6 id="4-静态NAT"><a href="#4-静态NAT" class="headerlink" title="4.静态NAT"></a>4.静态NAT</h6><p>允许外网访问内网web服务器所有服务，相当于给服务器配置一个独立公网地址</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nat static global 192.168.1.15 inside 192.168.10.250</span><br></pre></td></tr></table></figure>

<h6 id="5-端口映射"><a href="#5-端口映射" class="headerlink" title="5.端口映射"></a>5.端口映射</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[Huawei-GigabitEthernet0/0/1]nat static protocol tcp global current-interface  8081 inside 192.168.10.250 80</span><br><span class="line">配置nat端口映射，将公网当前接口G0/0/1的ip对应8081端口的数据流，转换为内网192.168.10.250ip及端口80发送到目标地址</span><br></pre></td></tr></table></figure>

<h4 id="VRRP"><a href="#VRRP" class="headerlink" title="VRRP"></a>VRRP</h4><img src="/2023/01/26/ICT%E7%AC%AC%E4%B8%83%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221123235153721.png" class="" title="image-20221123235153721">

<h5 id="基本配置：-1"><a href="#基本配置：-1" class="headerlink" title="基本配置："></a>基本配置：</h5><p>AR2、AR3、AR4同配置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">int g0/0/0</span><br><span class="line">vrrp vrid 1 virtual-ip 10.234.1.1</span><br></pre></td></tr></table></figure>

<p>可以发现AR2被选为Master</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">display vrrp</span><br></pre></td></tr></table></figure>

<img src="/2023/01/26/ICT%E7%AC%AC%E4%B8%83%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221123232007338.png" class="" title="image-20221123232007338">

<p>AR3、AR4</p>
<img src="/2023/01/26/ICT%E7%AC%AC%E4%B8%83%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221123232018620.png" class="">

<p>IP地址不具有抢占</p>
<p>优先级存在抢占  master断掉后就不再是master</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vrrp vrid 1 priority 110  //更改优先级</span><br><span class="line"></span><br><span class="line">vrrp vrid 1preempt disable 不主动参与优先级比较，但是重新进行选举时，仍会参与选举。</span><br></pre></td></tr></table></figure>

<p>在修改R2的优先级，断开R2的g&#x2F;0&#x2F;0&#x2F;0后发现R3成为了Master</p>
<img src="/2023/01/26/ICT%E7%AC%AC%E4%B8%83%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221124000252920.png" class="" title="image-20221124000252920">

<p>在R2的线重连后，重新竞选后R2成为了Master,R3又是backup</p>
<img src="/2023/01/26/ICT%E7%AC%AC%E4%B8%83%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221124000411237.png" class="" title="image-20221124000411237">

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vrrp只是与端口上关联，而与上方不关联</span><br><span class="line">vrrpvrid 1track nqa vrrpicmp reduce xx   //xx为优先级减少的数量    即断开后该优先级会减少xx</span><br><span class="line">increase  增加</span><br><span class="line"></span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://lanyangyangy.github.io/2023/01/26/ICT%E7%AC%AC%E4%B8%83%E6%AC%A1%E7%AC%94%E8%AE%B0/" data-id="cldfxvta80001vg9u59yi5fgf" data-title="ICT第七次笔记" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ICT-%E6%95%B0%E9%80%9A/" rel="tag">ICT 数通</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-ICT第六次笔记" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/01/26/ICT%E7%AC%AC%E5%85%AD%E6%AC%A1%E7%AC%94%E8%AE%B0/" class="article-date">
  <time class="dt-published" datetime="2023-01-26T04:44:35.000Z" itemprop="datePublished">2023-01-26</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/01/26/ICT%E7%AC%AC%E5%85%AD%E6%AC%A1%E7%AC%94%E8%AE%B0/">ICT第六次笔记</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h4 id="自治系统"><a href="#自治系统" class="headerlink" title="自治系统"></a>自治系统</h4><p>由同一技术管理机构管理、使用同一选路策略的一些路由器的集合。</p>
<p>自治系统内部的路由协议–IGP</p>
<p>自治系统之间的路由协议–EGP</p>
<img src="/2023/01/26/ICT%E7%AC%AC%E5%85%AD%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221108154330732.png" class="" title="image-20221108154330732">

<h4 id="BGP"><a href="#BGP" class="headerlink" title="BGP"></a>BGP</h4><p><strong>原理</strong>：BGP自治系统间的路由协议</p>
<p>BGP外部路由协议，是一种增强的<strong>距离矢量路由协议</strong>。</p>
<p>可以根据链路状态数据库画出整个网络拓扑图。</p>
<p>BGP边界网关协议，用于AS与AS之间的路由协议</p>
<img src="/2023/01/26/ICT%E7%AC%AC%E5%85%AD%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221108154941466.png" class="" title="image-20221108154941466">

<p>BGP：支持CIDR<br>传输协议：<strong>TCP</strong>，端口号：<strong>179</strong><br>无需周期性更新<br>可靠的路由更新：只发送增量路由<br>周期性发送keepAlive报文检测TCP连通性</p>
<h5 id="BGP报文-5种"><a href="#BGP报文-5种" class="headerlink" title="BGP报文(5种)"></a>BGP报文(5种)</h5><ul>
<li>Open包：负责和对等体peer建立邻居关系。(<strong>建立</strong>)</li>
<li>KeepAlive：该消息在对等体之间周期性地发送，用以维护连接。(<strong>维护</strong>)</li>
<li>Update：该消息被用来在BGP对等体之间传递路由信息。(<strong>更新</strong>)</li>
<li>Notification：当 BGP Speaker检测到错误的时候，就发送该消息给对等体。(<strong>纠错</strong>)</li>
<li>Route-refresh：用来通知对等体自己支持路由刷新能力。</li>
<li><img src="/2023/01/26/ICT%E7%AC%AC%E5%85%AD%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221108174353222.png" class="" title="image-20221108174353222"></li>
</ul>
<h5 id="BGP路由传递"><a href="#BGP路由传递" class="headerlink" title="BGP路由传递"></a>BGP路由传递</h5><p>EBGP水平分割：经过那个AS，反过来不能再进入该AS<br>IBGP水平分割：通过IBGP学习到的路由条目反过来不能发给IBGP</p>
<p>AS号<br>公有AS：1 ~ 64511<br>私有AS：64512 ~ 65535</p>
<h5 id="BGP两种邻居关系"><a href="#BGP两种邻居关系" class="headerlink" title="BGP两种邻居关系"></a>BGP两种邻居关系</h5><p>IBGP、EBGP<br>当BGP被用在一个AS内部：IBGP<br>当BGP被用在AS之间：EBGP</p>
<p>BGP只能使用一个进程号</p>
<p>bash</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># todo AR1：展示BGP只能使用一个进程号</span></span><br><span class="line">[R1]bgp 1</span><br><span class="line">[R1-bgp]bgp 2</span><br><span class="line">Error: BGP is already running. The AS is 1.</span><br></pre></td></tr></table></figure>

<p>注：<br>1.BGP宣告路由信息必须和路由表一致<br>2.BGP建立邻居关系建议直接使用物理接口<br>3.BGP建立邻居关系：<code>peer [对方IP] as-number [AS号]</code><br>4.BGP邻居关系建立30s-60s</p>
<img src="/2023/01/26/ICT%E7%AC%AC%E5%85%AD%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221108174740129.png" class="" title="image-20221108174740129">

<h4 id="BGP配置"><a href="#BGP配置" class="headerlink" title="BGP配置"></a>BGP配置</h4><img src="/2023/01/26/ICT%E7%AC%AC%E5%85%AD%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221108174242748.png" class="" title="image-20221108174242748">

<p>AR1—–AR2</p>
<p>AR1</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">bgp 1</span><br><span class="line">peer 12.1.1.2 as-number 16  //配邻居</span><br><span class="line">network 1.1.1.1 32   //宣告自己的路由条目</span><br><span class="line">dis bgp peer //查看自己的邻居信息</span><br></pre></td></tr></table></figure>

<p>AR2</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bgp 16</span><br><span class="line">peer 12.1.1.1 as-number 1 </span><br></pre></td></tr></table></figure>

<p>AR2—–AR4(使用环回口进行建立BGP邻居关系)  </p>
<p>AR2</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">bgp 16</span><br><span class="line">peer 4.4.4.4 as-number 16 </span><br><span class="line">peer 4.4.4.4 connect-interface LoopBack 0 </span><br></pre></td></tr></table></figure>

<p>AR4</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">bgp 16</span><br><span class="line">peer 2.2.2.2 as-number 16 </span><br><span class="line">peer 2.2.2.2 connect-interface LoopBack 0</span><br></pre></td></tr></table></figure>

<p>AR4—–AR1</p>
<p>AR2</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer 4.4.4.4 next-hop-local   //告知把AR2当作下一跳   解决下一跳不可达</span><br></pre></td></tr></table></figure>



<p>AR4</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[R4]ip route-static 66.66.66.66 32 64.1.1.6</span><br><span class="line">[R4]ping -a 4.4.4.4 66.66.66.66     //指定4.4.4.4ping66.66.66.66</span><br><span class="line">[R4]bgp 16</span><br><span class="line">[R4-bgp]peer 66.66.66.66 as-number 6</span><br><span class="line">[R4-bgp]peer 66.66.66.66 connect-interface LoopBack 0	</span><br><span class="line">[R4-bgp]peer 66.66.66.66 ebgp-max-hop  100    //修改EBGP的生存时间</span><br></pre></td></tr></table></figure>

<p>AR6</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[R6]int lo 1</span><br><span class="line">[R6-LoopBack1]ip add 66.66.66.66 32</span><br><span class="line">[R6]ip route-static 0.0.0.0 0.0.0.0 64.1.1.4</span><br><span class="line">[R6]bgp 6</span><br><span class="line">[R6-bgp]peer 4.4.4.4 as-number 16</span><br><span class="line">[R6-bgp]peer 4.4.4.4 connect-interface LoopBack 1</span><br><span class="line">[R6-bgp]peer 4.4.4.4 ebgp-max-hop  100 //修改EBGP的生存时间</span><br></pre></td></tr></table></figure>

<p>IBGP  timelive最大 255	</p>
<p>EBGP多跳  timelive 1</p>
<p>AR6—–AR1</p>
<p>AR6</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[R6]ip route-static 4.4.4.4 32 64.1.1.4</span><br><span class="line">[R6]bgp 6</span><br><span class="line">[R6-bgp]network 6.6.6.6 32</span><br></pre></td></tr></table></figure>

<p>AR4</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[R4-bgp]peer 2.2.2.2 next-hop-local</span><br><span class="line">[R4]mpls lsr-id 4.4.4.4</span><br><span class="line">[R4]mpls</span><br><span class="line">[R4-mpls]quit</span><br><span class="line">[R4]mpls  ldp</span><br><span class="line">[R4-mpls-ldp]quit</span><br><span class="line">[R4]int g0/0/0</span><br><span class="line">[R4-GigabitEthernet0/0/0]mpls</span><br><span class="line">[R4-GigabitEthernet0/0/0]mpls ldp</span><br><span class="line">[R4-GigabitEthernet0/0/0]int g0/0/1</span><br><span class="line">[R4-GigabitEthernet0/0/1]mpls</span><br><span class="line">[R4-GigabitEthernet0/0/1]mpls ldp</span><br><span class="line"></span><br><span class="line">[R4]route recursive-lookup  tunnel </span><br></pre></td></tr></table></figure>

<p>AR2</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[R2]mpls lsr-id 2.2.2.2</span><br><span class="line">[R2]mpls</span><br><span class="line">[R2-mpls]quit</span><br><span class="line">[R2]mpls  ldp </span><br><span class="line">[R2-mpls-ldp]quit</span><br><span class="line">[R2-GigabitEthernet0/0/1]mpls</span><br><span class="line">[R2-GigabitEthernet0/0/1]mpls ldp</span><br><span class="line">[R2]route recursive-lookup  tunnel </span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>AR3</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[R3]mpls lsr-id 3.3.3.3</span><br><span class="line">[R3]mpls</span><br><span class="line">[R3-mpls]quit</span><br><span class="line">[R3]mpls  ldp</span><br><span class="line">[R3-mpls-ldp]quit</span><br><span class="line">[R3]int g0/0/0</span><br><span class="line">[R3-GigabitEthernet0/0/0]mpls</span><br><span class="line">[R3-GigabitEthernet0/0/0]mpls ldp</span><br><span class="line">[R3-GigabitEthernet0/0/0]int g0/0/1</span><br><span class="line">[R3-GigabitEthernet0/0/1]mpls</span><br><span class="line">[R3-GigabitEthernet0/0/1]mpls ldp</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<img src="/2023/01/26/ICT%E7%AC%AC%E5%85%AD%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221105120128996.png" class="">





<h4 id="BGP路径选择过程"><a href="#BGP路径选择过程" class="headerlink" title="BGP路径选择过程"></a>BGP路径选择过程</h4><img src="/2023/01/26/ICT%E7%AC%AC%E5%85%AD%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221108205632379.png" class="" title="image-20221108205632379">

<img src="/2023/01/26/ICT%E7%AC%AC%E5%85%AD%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221108214557870.png" class="" title="image-20221108214557870">



<h5 id="实验："><a href="#实验：" class="headerlink" title="实验："></a>实验：</h5><img src="/2023/01/26/ICT%E7%AC%AC%E5%85%AD%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221108210606875.png" class="" title="image-20221108210606875">

<h6 id="Preferred-Value（本地有效）"><a href="#Preferred-Value（本地有效）" class="headerlink" title="Preferred-Value（本地有效）"></a><strong>Preferred-Value</strong>（本地有效）</h6><p>使得R2选择R6作为下一跳路由器</p>
<p>R2:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[Huawei-bgp]peer 26.1.1.6 preferred-value 100 //修改preferred-Value</span><br><span class="line">    Network            NextHop        MED        LocPrf    PrefVal Path/Ogn</span><br><span class="line"></span><br><span class="line"> *&gt;   4.4.4.4/32       26.1.1.6                              100    24i   </span><br></pre></td></tr></table></figure>

<p>R2</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[Huawei]ip ip-prefix 4  permit 4.4.4.4 32   //设置前缀列表4，匹配路由条目4.4.4.4/32</span><br><span class="line">[Huawei]route-policy PVL permit node 10   // 配置策略路由命名为PVL允许策略内路由通过并设置序列号为10</span><br><span class="line">Info: New Sequence of this List.</span><br><span class="line">[Huawei-route-policy]if-match ip-prefix 4    //匹配前缀列表4</span><br><span class="line">[Huawei-route-policy]apply preferred-value 100  //修改preferred-value的值为100</span><br><span class="line">[Huawei-route-policy]bgp 1</span><br><span class="line">[Huawei-bgp]peer 26.1.1.6 route-policy PVL import  //指定邻居26.1.1.6学习到的路由匹配路由策略PVL</span><br><span class="line">[Huawei-bgp]</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>Local-Preference</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1、仅在AS内部传递</span><br><span class="line">2、越大越优</span><br><span class="line">3、在AS内的IN或OUT,AS之间仅IN方向</span><br></pre></td></tr></table></figure>

<p>R2</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ip ip-prefix 4  permit 4.4.4.4 32   # 设置前缀列表4，匹配路由条目4.4.4.4/32</span><br><span class="line"></span><br><span class="line">route-policy LP permit node 10 </span><br><span class="line"> if-match ip-prefix 4 </span><br><span class="line"> apply local-preference 101 </span><br><span class="line"></span><br><span class="line">[Huawei]bgp 1 </span><br><span class="line">[Huawei-bgp]peer 26.1.1.6 route-policy LP import</span><br></pre></td></tr></table></figure>

<h6 id="AS-PATH"><a href="#AS-PATH" class="headerlink" title="AS-PATH"></a>AS-PATH</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1、仅在AS之间</span><br><span class="line">2、越短越优先</span><br><span class="line">3、在AS之间的IN和OUT方向</span><br></pre></td></tr></table></figure>

<p>R2</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">ip ip-prefix 4  permit 4.4.4.4 32    设置前缀列表4，匹配路由条目4.4.4.4/32</span><br><span class="line"></span><br><span class="line">route-policy AS permit node 10 </span><br><span class="line"> if-match ip-prefix 4 </span><br><span class="line"> apply as-path 24 24 24 additive</span><br><span class="line"> </span><br><span class="line">                                           </span><br><span class="line">[Huawei]bgp 1 </span><br><span class="line"></span><br><span class="line">[Huawei-bgp]peer 23.1.1.3 route-policy AS import </span><br></pre></td></tr></table></figure>

<h6 id="Origin属性"><a href="#Origin属性" class="headerlink" title="Origin属性"></a><strong>Origin属性</strong></h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1、所有路由器</span><br><span class="line">2、i&gt;e&gt;?</span><br><span class="line">3、在AS内部或外部的IN或OUT</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ip ip-prefix 4  permit 4.4.4.4 32    设置前缀列表4，匹配路由条目4.4.4.4/32</span><br><span class="line"></span><br><span class="line">route-policy OR permit node 10 </span><br><span class="line"> if-match ip-prefix 4 </span><br><span class="line"> apply origin incomplete   </span><br><span class="line"> </span><br><span class="line"> bgp 1</span><br><span class="line"></span><br><span class="line"> peer 23.1.1.3 route-policy OR import </span><br></pre></td></tr></table></figure>

<p>RR反射器防环：解决BGP水平分割问题(IBGP和EBGP的水平分割)<br>IBGP水平分割：通过IBGP学习的条目不能再发送给其他IBGP<br>EBGP水平分割：从某个接口上学习来的路由信息将不再从该接口上通告出去。就是从那个口进来的不再从这个口出去。</p>
<h4 id="BGP路由反射器与联盟"><a href="#BGP路由反射器与联盟" class="headerlink" title="BGP路由反射器与联盟"></a>BGP路由反射器与联盟</h4><h5 id="反射器"><a href="#反射器" class="headerlink" title="反射器"></a>反射器</h5><p>路由发射器RR：<br>1.当RR从客户机收到一个路由更新时，会将它发送给客户机和非客户机。<br>2.当RR从非客户机收到一个路由更新时，只发送给客户机路由器，而不发送给其他非客户机路由器<br>3.当RR从EBGP收到一个路由更新时，会将它发送给客户机和非客户机。</p>
<p>实验：</p>
<img src="/2023/01/26/ICT%E7%AC%AC%E5%85%AD%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221108215458365.png" class="" title="image-20221108215458365">

<ol>
<li></li>
</ol>
<p>R4学到1.1.1.1</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[R3]bgp 2     </span><br><span class="line">[R3-bgp]peer 23.1.1.2 reflect-client </span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[R4]dis bgp rou</span><br><span class="line"> BGP Local router ID is 34.1.1.4 </span><br><span class="line"> Status codes: * - valid, &gt; - best, d - damped,</span><br><span class="line">               h - history,  i - internal, s - suppressed, S - Stale</span><br><span class="line">               Origin : i - IGP, e - EGP, ? - incomplete</span><br><span class="line"> Total Number of Routes: 1</span><br><span class="line">      Network            NextHop        MED        LocPrf    PrefVal Path/Ogn</span><br><span class="line"> *&gt;i  1.1.1.1/32         12.1.1.1        0          100        0      1i</span><br></pre></td></tr></table></figure>

<ol start="2">
<li></li>
</ol>
<p>R5学到1.1.1.1</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[R4]bgp 2</span><br><span class="line">[R4-bgp]peer 45.1.1.5 reflect-client  # 设置为RR，45.1.1.5为client</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[R5]dis bgp routing-table</span><br><span class="line"></span><br><span class="line"> BGP Local router ID is 45.1.1.5 </span><br><span class="line"> Status codes: * - valid, &gt; - best, d - damped,</span><br><span class="line">               h - history,  i - internal, s - suppressed, S - Stale</span><br><span class="line">               Origin : i - IGP, e - EGP, ? - incomplete</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> Total Number of Routes: 1</span><br><span class="line">      Network            NextHop        MED        LocPrf    PrefVal Path/Ogn</span><br><span class="line"></span><br><span class="line"> *&gt;i  1.1.1.1/32         12.1.1.1        0          100        0      1i</span><br><span class="line">[R5]</span><br></pre></td></tr></table></figure>

<h5 id="建立联邦"><a href="#建立联邦" class="headerlink" title="建立联邦"></a>建立联邦</h5><p>大AS中建立小AS，AS外部建立邻居关系通过大AS。</p>
<img src="/2023/01/26/ICT%E7%AC%AC%E5%85%AD%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221108221010811.png" class="" title="image-20221108221010811">

<p>R2</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">bgp 64512             //配置小bgp</span><br><span class="line">confederation id 2    //声明大bgp</span><br><span class="line">peer 12.1.1.1 as-number 1   //添加邻居</span><br><span class="line"> peer 23.1.1.3 as-number 64512  </span><br></pre></td></tr></table></figure>

<p>R3</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">bgp 64512</span><br><span class="line"> confederation id 2</span><br><span class="line"> confederation peer-as 64513      //同大AS下添加为小AS</span><br><span class="line"> peer 23.1.1.2 as-number 64512 </span><br><span class="line"> peer 34.1.1.4 as-number 64513 </span><br></pre></td></tr></table></figure>

<p>R4</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">bgp 64513</span><br><span class="line"> confederation id 2</span><br><span class="line"> confederation peer-as 64512       //同大AS下添加为小AS</span><br><span class="line"> peer 34.1.1.3 as-number 64512 </span><br><span class="line"> peer 45.1.1.5 as-number 64513 </span><br></pre></td></tr></table></figure>

<p>R5</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">bgp 64513</span><br><span class="line">confederation id 2</span><br><span class="line">peer 45.1.1.4 as-number 64513 </span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://lanyangyangy.github.io/2023/01/26/ICT%E7%AC%AC%E5%85%AD%E6%AC%A1%E7%AC%94%E8%AE%B0/" data-id="cldfxvtaf000avg9ueofrf692" data-title="ICT第六次笔记" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ICT-%E6%95%B0%E9%80%9A/" rel="tag">ICT 数通</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-ICT第五次笔记" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/01/26/ICT%E7%AC%AC%E4%BA%94%E6%AC%A1%E7%AC%94%E8%AE%B0/" class="article-date">
  <time class="dt-published" datetime="2023-01-26T04:44:26.000Z" itemprop="datePublished">2023-01-26</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/01/26/ICT%E7%AC%AC%E4%BA%94%E6%AC%A1%E7%AC%94%E8%AE%B0/">ICT第五次笔记</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h4 id="自治系统"><a href="#自治系统" class="headerlink" title="自治系统"></a>自治系统</h4><p>由同一技术管理机构管理、使用同一选路策略的一些路由器的集合。</p>
<p>自治系统内部的路由协议–IGP</p>
<p>自治系统之间的路由协议–EGP</p>
<img src="/2023/01/26/ICT%E7%AC%AC%E4%BA%94%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221108154330732.png" class="" title="image-20221108154330732">

<h4 id="BGP"><a href="#BGP" class="headerlink" title="BGP"></a>BGP</h4><p><strong>原理</strong>：BGP自治系统间的路由协议</p>
<p>BGP外部路由协议，是一种增强的<strong>距离矢量路由协议</strong>。</p>
<p>可以根据链路状态数据库画出整个网络拓扑图。</p>
<p>BGP边界网关协议，用于AS与AS之间的路由协议</p>
<img src="/2023/01/26/ICT%E7%AC%AC%E4%BA%94%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221108154941466.png" class="" title="image-20221108154941466">

<p>BGP：支持CIDR<br>传输协议：<strong>TCP</strong>，端口号：<strong>179</strong><br>无需周期性更新<br>可靠的路由更新：只发送增量路由<br>周期性发送keepAlive报文检测TCP连通性</p>
<h5 id="BGP报文-5种"><a href="#BGP报文-5种" class="headerlink" title="BGP报文(5种)"></a>BGP报文(5种)</h5><ul>
<li>Open包：负责和对等体peer建立邻居关系。(<strong>建立</strong>)</li>
<li>KeepAlive：该消息在对等体之间周期性地发送，用以维护连接。(<strong>维护</strong>)</li>
<li>Update：该消息被用来在BGP对等体之间传递路由信息。(<strong>更新</strong>)</li>
<li>Notification：当 BGP Speaker检测到错误的时候，就发送该消息给对等体。(<strong>纠错</strong>)</li>
<li>Route-refresh：用来通知对等体自己支持路由刷新能力。</li>
<li><img src="/2023/01/26/ICT%E7%AC%AC%E4%BA%94%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221108174353222.png" class="" title="image-20221108174353222"></li>
</ul>
<h5 id="BGP路由传递"><a href="#BGP路由传递" class="headerlink" title="BGP路由传递"></a>BGP路由传递</h5><p>EBGP水平分割：经过那个AS，反过来不能再进入该AS<br>IBGP水平分割：通过IBGP学习到的路由条目反过来不能发给IBGP</p>
<p>AS号<br>公有AS：1 ~ 64511<br>私有AS：64512 ~ 65535</p>
<h5 id="BGP两种邻居关系"><a href="#BGP两种邻居关系" class="headerlink" title="BGP两种邻居关系"></a>BGP两种邻居关系</h5><p>IBGP、EBGP<br>当BGP被用在一个AS内部：IBGP<br>当BGP被用在AS之间：EBGP</p>
<p>BGP只能使用一个进程号</p>
<p>bash</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># todo AR1：展示BGP只能使用一个进程号</span></span><br><span class="line">[R1]bgp 1</span><br><span class="line">[R1-bgp]bgp 2</span><br><span class="line">Error: BGP is already running. The AS is 1.</span><br></pre></td></tr></table></figure>

<p>注：<br>1.BGP宣告路由信息必须和路由表一致<br>2.BGP建立邻居关系建议直接使用物理接口<br>3.BGP建立邻居关系：<code>peer [对方IP] as-number [AS号]</code><br>4.BGP邻居关系建立30s-60s</p>
<img src="/2023/01/26/ICT%E7%AC%AC%E4%BA%94%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221108174740129.png" class="" title="image-20221108174740129">

<h4 id="BGP配置"><a href="#BGP配置" class="headerlink" title="BGP配置"></a>BGP配置</h4><img src="/2023/01/26/ICT%E7%AC%AC%E4%BA%94%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221108174242748.png" class="" title="image-20221108174242748">

<p>AR1—–AR2</p>
<p>AR1</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">bgp 1</span><br><span class="line">peer 12.1.1.2 as-number 16  //配邻居</span><br><span class="line">network 1.1.1.1 32   //宣告自己的路由条目</span><br><span class="line">dis bgp peer //查看自己的邻居信息</span><br></pre></td></tr></table></figure>

<p>AR2</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bgp 16</span><br><span class="line">peer 12.1.1.1 as-number 1 </span><br></pre></td></tr></table></figure>

<p>AR2—–AR4(使用环回口进行建立BGP邻居关系)  </p>
<p>AR2</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">bgp 16</span><br><span class="line">peer 4.4.4.4 as-number 16 </span><br><span class="line">peer 4.4.4.4 connect-interface LoopBack 0 </span><br></pre></td></tr></table></figure>

<p>AR4</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">bgp 16</span><br><span class="line">peer 2.2.2.2 as-number 16 </span><br><span class="line">peer 2.2.2.2 connect-interface LoopBack 0</span><br></pre></td></tr></table></figure>

<p>AR4—–AR1</p>
<p>AR2</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer 4.4.4.4 next-hop-local   //告知把AR2当作下一跳   解决下一跳不可达</span><br></pre></td></tr></table></figure>



<p>AR4</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[R4]ip route-static 66.66.66.66 32 64.1.1.6</span><br><span class="line">[R4]ping -a 4.4.4.4 66.66.66.66     //指定4.4.4.4ping66.66.66.66</span><br><span class="line">[R4]bgp 16</span><br><span class="line">[R4-bgp]peer 66.66.66.66 as-number 6</span><br><span class="line">[R4-bgp]peer 66.66.66.66 connect-interface LoopBack 0	</span><br><span class="line">[R4-bgp]peer 66.66.66.66 ebgp-max-hop  100    //修改EBGP的生存时间</span><br></pre></td></tr></table></figure>

<p>AR6</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[R6]int lo 1</span><br><span class="line">[R6-LoopBack1]ip add 66.66.66.66 32</span><br><span class="line">[R6]ip route-static 0.0.0.0 0.0.0.0 64.1.1.4</span><br><span class="line">[R6]bgp 6</span><br><span class="line">[R6-bgp]peer 4.4.4.4 as-number 16</span><br><span class="line">[R6-bgp]peer 4.4.4.4 connect-interface LoopBack 1</span><br><span class="line">[R6-bgp]peer 4.4.4.4 ebgp-max-hop  100 //修改EBGP的生存时间</span><br></pre></td></tr></table></figure>

<p>IBGP  timelive最大 255	</p>
<p>EBGP多跳  timelive 1</p>
<p>AR6—–AR1</p>
<p>AR6</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[R6]ip route-static 4.4.4.4 32 64.1.1.4</span><br><span class="line">[R6]bgp 6</span><br><span class="line">[R6-bgp]network 6.6.6.6 32</span><br></pre></td></tr></table></figure>

<p>AR4</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[R4-bgp]peer 2.2.2.2 next-hop-local</span><br><span class="line">[R4]mpls lsr-id 4.4.4.4</span><br><span class="line">[R4]mpls</span><br><span class="line">[R4-mpls]quit</span><br><span class="line">[R4]mpls  ldp</span><br><span class="line">[R4-mpls-ldp]quit</span><br><span class="line">[R4]int g0/0/0</span><br><span class="line">[R4-GigabitEthernet0/0/0]mpls</span><br><span class="line">[R4-GigabitEthernet0/0/0]mpls ldp</span><br><span class="line">[R4-GigabitEthernet0/0/0]int g0/0/1</span><br><span class="line">[R4-GigabitEthernet0/0/1]mpls</span><br><span class="line">[R4-GigabitEthernet0/0/1]mpls ldp</span><br><span class="line"></span><br><span class="line">[R4]route recursive-lookup  tunnel </span><br></pre></td></tr></table></figure>

<p>AR2</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[R2]mpls lsr-id 2.2.2.2</span><br><span class="line">[R2]mpls</span><br><span class="line">[R2-mpls]quit</span><br><span class="line">[R2]mpls  ldp </span><br><span class="line">[R2-mpls-ldp]quit</span><br><span class="line">[R2-GigabitEthernet0/0/1]mpls</span><br><span class="line">[R2-GigabitEthernet0/0/1]mpls ldp</span><br><span class="line">[R2]route recursive-lookup  tunnel </span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>AR3</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[R3]mpls lsr-id 3.3.3.3</span><br><span class="line">[R3]mpls</span><br><span class="line">[R3-mpls]quit</span><br><span class="line">[R3]mpls  ldp</span><br><span class="line">[R3-mpls-ldp]quit</span><br><span class="line">[R3]int g0/0/0</span><br><span class="line">[R3-GigabitEthernet0/0/0]mpls</span><br><span class="line">[R3-GigabitEthernet0/0/0]mpls ldp</span><br><span class="line">[R3-GigabitEthernet0/0/0]int g0/0/1</span><br><span class="line">[R3-GigabitEthernet0/0/1]mpls</span><br><span class="line">[R3-GigabitEthernet0/0/1]mpls ldp</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<img src="/2023/01/26/ICT%E7%AC%AC%E4%BA%94%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221105120128996.png" class="">





<h4 id="BGP路径选择过程"><a href="#BGP路径选择过程" class="headerlink" title="BGP路径选择过程"></a>BGP路径选择过程</h4><img src="/2023/01/26/ICT%E7%AC%AC%E4%BA%94%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221108205632379.png" class="" title="image-20221108205632379">

<img src="/2023/01/26/ICT%E7%AC%AC%E4%BA%94%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221108214557870.png" class="" title="image-20221108214557870">



<h5 id="实验："><a href="#实验：" class="headerlink" title="实验："></a>实验：</h5><img src="/2023/01/26/ICT%E7%AC%AC%E4%BA%94%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221108210606875.png" class="" title="image-20221108210606875">

<h6 id="Preferred-Value（本地有效）"><a href="#Preferred-Value（本地有效）" class="headerlink" title="Preferred-Value（本地有效）"></a><strong>Preferred-Value</strong>（本地有效）</h6><p>使得R2选择R6作为下一跳路由器</p>
<p>R2:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[Huawei-bgp]peer 26.1.1.6 preferred-value 100 //修改preferred-Value</span><br><span class="line">    Network            NextHop        MED        LocPrf    PrefVal Path/Ogn</span><br><span class="line"></span><br><span class="line"> *&gt;   4.4.4.4/32       26.1.1.6                              100    24i   </span><br></pre></td></tr></table></figure>

<p>R2</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[Huawei]ip ip-prefix 4  permit 4.4.4.4 32   //设置前缀列表4，匹配路由条目4.4.4.4/32</span><br><span class="line">[Huawei]route-policy PVL permit node 10   // 配置策略路由命名为PVL允许策略内路由通过并设置序列号为10</span><br><span class="line">Info: New Sequence of this List.</span><br><span class="line">[Huawei-route-policy]if-match ip-prefix 4    //匹配前缀列表4</span><br><span class="line">[Huawei-route-policy]apply preferred-value 100  //修改preferred-value的值为100</span><br><span class="line">[Huawei-route-policy]bgp 1</span><br><span class="line">[Huawei-bgp]peer 26.1.1.6 route-policy PVL import  //指定邻居26.1.1.6学习到的路由匹配路由策略PVL</span><br><span class="line">[Huawei-bgp]</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>Local-Preference</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1、仅在AS内部传递</span><br><span class="line">2、越大越优</span><br><span class="line">3、在AS内的IN或OUT,AS之间仅IN方向</span><br></pre></td></tr></table></figure>

<p>R2</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ip ip-prefix 4  permit 4.4.4.4 32   # 设置前缀列表4，匹配路由条目4.4.4.4/32</span><br><span class="line"></span><br><span class="line">route-policy LP permit node 10 </span><br><span class="line"> if-match ip-prefix 4 </span><br><span class="line"> apply local-preference 101 </span><br><span class="line"></span><br><span class="line">[Huawei]bgp 1 </span><br><span class="line">[Huawei-bgp]peer 26.1.1.6 route-policy LP import</span><br></pre></td></tr></table></figure>

<h6 id="AS-PATH"><a href="#AS-PATH" class="headerlink" title="AS-PATH"></a>AS-PATH</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1、仅在AS之间</span><br><span class="line">2、越短越优先</span><br><span class="line">3、在AS之间的IN和OUT方向</span><br></pre></td></tr></table></figure>

<p>R2</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">ip ip-prefix 4  permit 4.4.4.4 32    设置前缀列表4，匹配路由条目4.4.4.4/32</span><br><span class="line"></span><br><span class="line">route-policy AS permit node 10 </span><br><span class="line"> if-match ip-prefix 4 </span><br><span class="line"> apply as-path 24 24 24 additive</span><br><span class="line"> </span><br><span class="line">                                           </span><br><span class="line">[Huawei]bgp 1 </span><br><span class="line"></span><br><span class="line">[Huawei-bgp]peer 23.1.1.3 route-policy AS import </span><br></pre></td></tr></table></figure>

<h6 id="Origin属性"><a href="#Origin属性" class="headerlink" title="Origin属性"></a><strong>Origin属性</strong></h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1、所有路由器</span><br><span class="line">2、i&gt;e&gt;?</span><br><span class="line">3、在AS内部或外部的IN或OUT</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ip ip-prefix 4  permit 4.4.4.4 32    设置前缀列表4，匹配路由条目4.4.4.4/32</span><br><span class="line"></span><br><span class="line">route-policy OR permit node 10 </span><br><span class="line"> if-match ip-prefix 4 </span><br><span class="line"> apply origin incomplete   </span><br><span class="line"> </span><br><span class="line"> bgp 1</span><br><span class="line"></span><br><span class="line"> peer 23.1.1.3 route-policy OR import </span><br></pre></td></tr></table></figure>

<p>RR反射器防环：解决BGP水平分割问题(IBGP和EBGP的水平分割)<br>IBGP水平分割：通过IBGP学习的条目不能再发送给其他IBGP<br>EBGP水平分割：从某个接口上学习来的路由信息将不再从该接口上通告出去。就是从那个口进来的不再从这个口出去。</p>
<h4 id="BGP路由反射器与联盟"><a href="#BGP路由反射器与联盟" class="headerlink" title="BGP路由反射器与联盟"></a>BGP路由反射器与联盟</h4><h5 id="反射器"><a href="#反射器" class="headerlink" title="反射器"></a>反射器</h5><p>路由发射器RR：<br>1.当RR从客户机收到一个路由更新时，会将它发送给客户机和非客户机。<br>2.当RR从非客户机收到一个路由更新时，只发送给客户机路由器，而不发送给其他非客户机路由器<br>3.当RR从EBGP收到一个路由更新时，会将它发送给客户机和非客户机。</p>
<p>实验：</p>
<img src="/2023/01/26/ICT%E7%AC%AC%E4%BA%94%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221108215458365.png" class="" title="image-20221108215458365">

<ol>
<li></li>
</ol>
<p>R4学到1.1.1.1</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[R3]bgp 2     </span><br><span class="line">[R3-bgp]peer 23.1.1.2 reflect-client </span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[R4]dis bgp rou</span><br><span class="line"> BGP Local router ID is 34.1.1.4 </span><br><span class="line"> Status codes: * - valid, &gt; - best, d - damped,</span><br><span class="line">               h - history,  i - internal, s - suppressed, S - Stale</span><br><span class="line">               Origin : i - IGP, e - EGP, ? - incomplete</span><br><span class="line"> Total Number of Routes: 1</span><br><span class="line">      Network            NextHop        MED        LocPrf    PrefVal Path/Ogn</span><br><span class="line"> *&gt;i  1.1.1.1/32         12.1.1.1        0          100        0      1i</span><br></pre></td></tr></table></figure>

<ol start="2">
<li></li>
</ol>
<p>R5学到1.1.1.1</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[R4]bgp 2</span><br><span class="line">[R4-bgp]peer 45.1.1.5 reflect-client  # 设置为RR，45.1.1.5为client</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[R5]dis bgp routing-table</span><br><span class="line"></span><br><span class="line"> BGP Local router ID is 45.1.1.5 </span><br><span class="line"> Status codes: * - valid, &gt; - best, d - damped,</span><br><span class="line">               h - history,  i - internal, s - suppressed, S - Stale</span><br><span class="line">               Origin : i - IGP, e - EGP, ? - incomplete</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> Total Number of Routes: 1</span><br><span class="line">      Network            NextHop        MED        LocPrf    PrefVal Path/Ogn</span><br><span class="line"></span><br><span class="line"> *&gt;i  1.1.1.1/32         12.1.1.1        0          100        0      1i</span><br><span class="line">[R5]</span><br></pre></td></tr></table></figure>

<h5 id="建立联邦"><a href="#建立联邦" class="headerlink" title="建立联邦"></a>建立联邦</h5><p>大AS中建立小AS，AS外部建立邻居关系通过大AS。</p>
<img src="/2023/01/26/ICT%E7%AC%AC%E4%BA%94%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221108221010811.png" class="" title="image-20221108221010811">

<p>R2</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">bgp 64512             //配置小bgp</span><br><span class="line">confederation id 2    //声明大bgp</span><br><span class="line">peer 12.1.1.1 as-number 1   //添加邻居</span><br><span class="line"> peer 23.1.1.3 as-number 64512  </span><br></pre></td></tr></table></figure>

<p>R3</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">bgp 64512</span><br><span class="line"> confederation id 2</span><br><span class="line"> confederation peer-as 64513      //同大AS下添加为小AS</span><br><span class="line"> peer 23.1.1.2 as-number 64512 </span><br><span class="line"> peer 34.1.1.4 as-number 64513 </span><br></pre></td></tr></table></figure>

<p>R4</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">bgp 64513</span><br><span class="line"> confederation id 2</span><br><span class="line"> confederation peer-as 64512       //同大AS下添加为小AS</span><br><span class="line"> peer 34.1.1.3 as-number 64512 </span><br><span class="line"> peer 45.1.1.5 as-number 64513 </span><br></pre></td></tr></table></figure>

<p>R5</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">bgp 64513</span><br><span class="line">confederation id 2</span><br><span class="line">peer 45.1.1.4 as-number 64513 </span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://lanyangyangy.github.io/2023/01/26/ICT%E7%AC%AC%E4%BA%94%E6%AC%A1%E7%AC%94%E8%AE%B0/" data-id="cldfxvtad0008vg9udkchc1ni" data-title="ICT第五次笔记" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ICT-%E6%95%B0%E9%80%9A/" rel="tag">ICT 数通</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-ICT第四次笔记" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/01/26/ICT%E7%AC%AC%E5%9B%9B%E6%AC%A1%E7%AC%94%E8%AE%B0/" class="article-date">
  <time class="dt-published" datetime="2023-01-26T04:44:06.000Z" itemprop="datePublished">2023-01-26</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/01/26/ICT%E7%AC%AC%E5%9B%9B%E6%AC%A1%E7%AC%94%E8%AE%B0/">ICT第四次笔记</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="第四次笔记"><a href="#第四次笔记" class="headerlink" title="第四次笔记"></a>第四次笔记</h1><p>交换机PC连接   *down 管理员将端口shutdown</p>
<p>dis current-configuration 显示当前配置</p>
<p>display mac-address |include xxxx     只显示与xxxx有关的内容</p>
<p>排错思路：哪个设备  什么技术 什么原因</p>
<p><strong>路由器转发原理：路由器基于路由表进行数据包转发</strong></p>
<p>路由转发要从一端到另一端的路由器的路由表中都有目的网段。</p>
<p>例：</p>
<img src="/2023/01/26/ICT%E7%AC%AC%E5%9B%9B%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221029151115327.png" class="" title="image-20221029151115327">

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">R1</span><br><span class="line">dhcp enable</span><br><span class="line"></span><br><span class="line">interface GigabitEthernet0/0/0</span><br><span class="line"> ip address 192.168.1.1 255.255.255.0 </span><br><span class="line"> dhcp select interface</span><br><span class="line"></span><br><span class="line">interface GigabitEthernet0/0/1</span><br><span class="line"> ip address 12.1.1.1 255.255.255.0 </span><br><span class="line"> </span><br><span class="line">ip route-static 192.168.2.0 255.255.255.0 12.1.1.2//配置PC1去PC2的静态路由</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">R2</span><br><span class="line">interface GigabitEthernet0/0/0</span><br><span class="line"> ip address 12.1.1.2 255.255.255.0 </span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/1</span><br><span class="line"> ip address 23.1.1.2 255.255.255.0 </span><br><span class="line"> </span><br><span class="line">ip route-static 192.168.2.0 255.255.255.0 23.1.1.3 //配置PC1去PC2的静态路由</span><br><span class="line">ip route-static 192.168.1.0 255.255.255.0 12.1.1.1 //配置PC2回PC1的静态路由</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">R3</span><br><span class="line">dhcp enable</span><br><span class="line">interface GigabitEthernet0/0/0</span><br><span class="line"> ip address 23.1.1.3 255.255.255.0 </span><br><span class="line"></span><br><span class="line">interface GigabitEthernet0/0/1</span><br><span class="line"> ip address 192.168.2.1 255.255.255.0 </span><br><span class="line"> dhcp select interface </span><br><span class="line"> </span><br><span class="line"> ip route-static 192.168.1.0 255.255.255.0 23.1.1.2//配置PC2回PC1的静态路由</span><br></pre></td></tr></table></figure>

<p>这里只配置了PC1与PC2进行ping，但PC1不能ping通R3，需要再配置静态路由。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">R1</span><br><span class="line">ip route-static 23.1.1.0 255.255.255.0 12.1.1.2</span><br></pre></td></tr></table></figure>



<p>静态路由：</p>
<ul>
<li>由网络管理员手工指定的路由</li>
<li>当网络拓扑发生变化时，<strong>管理员需要手工更新静态路由</strong>。</li>
</ul>
<p>动态路由：</p>
<ul>
<li><p>路由器使用路由协议从<strong>其他路由器</strong>那里获悉的路由</p>
</li>
<li><p>当网络拓扑发生变化时，<strong>路由器会自动更新</strong>路由信息。</p>
<img src="/2023/01/26/ICT%E7%AC%AC%E5%9B%9B%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221031212827831.png" class="" title="image-20221031212827831"></li>
</ul>
<p>Destination&#x2F;Mask           proto（协议）                    pref  （优先级）        cost（同一路由协议获取到的路径比较）            Nexthop                    Interface    </p>
<p><strong><img src="/2023/01/26/ICT%E7%AC%AC%E5%9B%9B%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221031214421810.png" class="" title="image-20221031214421810"></strong> </p>
<p>路由的度量在同一路由协议下才能进行比较。</p>
<p>等价路由(ECMP)      ：同一路由协议，到同一个目的地有几条相同度量值的路由时，这些路由都会被加入到路由表中，IP包会在这几个链路上负载分担。</p>
<h5 id="最长匹配原则"><a href="#最长匹配原则" class="headerlink" title="最长匹配原则"></a>最长匹配原则</h5><ol>
<li>查找路由表</li>
<li>目的地址与掩码分别做“与”操作</li>
<li>与路由表中的目的地址作比较</li>
<li>挑选出最长匹配项</li>
</ol>
<h2 id="OSPF"><a href="#OSPF" class="headerlink" title="OSPF"></a>OSPF</h2><p>OSPF协议基于链路状态算法，直接运行于IP协议上，IP协议号89.</p>
<h5 id="OSPF基本特点"><a href="#OSPF基本特点" class="headerlink" title="OSPF基本特点"></a>OSPF基本特点</h5><img src="/2023/01/26/ICT%E7%AC%AC%E5%9B%9B%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221031223237665.png" class="" title="image-20221031223237665">

<p>OSPF协议基于链路状态算法，直接运行于IP协议上，IP协议号89</p>
<p>邻居表  full 才可以交换路由协议</p>
<p> RIP协议不带掩码		</p>
<img src="/2023/01/26/ICT%E7%AC%AC%E5%9B%9B%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221031224334178.png" class="" title="image-20221031224334178">

<p>hello报文  建立和维护邻居关系</p>
<p>DD报文	隐式确认</p>
<p>LSU报文 更新报文</p>
<p>LACK   	确认报文</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">display ospf interface g0/0/0   </span><br></pre></td></tr></table></figure>

<p>route-id ：</p>
<p>1.管理员手动配置</p>
<p>2.环回口最大IP作为route-id</p>
<p>3.物理接口最大IP作为route-id</p>
<p>route-id建立后无法修改，除非进程重启</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ospf 1</span><br><span class="line">area-ping</span><br><span class="line">network 10.0.0.2 0.0.0.255</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">display ospf peer		//查看邻居路由条目</span><br><span class="line">TransNet	中间路由   			StubNet		末梢路由</span><br></pre></td></tr></table></figure>

<h4 id="区域"><a href="#区域" class="headerlink" title="区域"></a>区域</h4><img src="/2023/01/26/ICT%E7%AC%AC%E5%9B%9B%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221102235903343.png" class="" title="image-20221102235903343">

<p>route ID不是IP地址，必须存在</p>
<p>区域是一组网段的集合</p>
<p>区域间（维护区域内LSDB)不会传递链路状态信息</p>
<img src="ICT第四次笔记/image-20221102235927649.png" alt="image-20221102235927649"  />

<p>非骨干区域必须与骨干区域相连；</p>
<p>非骨干之间不传递LSA</p>
<p>路由器分类：</p>
<img src="/2023/01/26/ICT%E7%AC%AC%E5%9B%9B%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221106144637446.png" class="" title="image-20221106144637446">



<h4 id="OSPF基本配置"><a href="#OSPF基本配置" class="headerlink" title="OSPF基本配置"></a>OSPF基本配置</h4><p><strong>环回接口习惯上被称为Loopback接口</strong>，是路由器上的一个逻辑、虚拟接口。 除非设备瘫痪，否则其状态一直是up。 因为环回接口的稳定性，我们常使用一个环回接口地址来作为Router-ID，使整个设备的标识稳定可靠。</p>
<img src="/2023/01/26/ICT%E7%AC%AC%E5%9B%9B%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221106145146325.png" class="" title="image-20221106145146325">



<p>RTA：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ospf</span><br><span class="line">ospf router id 1.1.1.1</span><br><span class="line"></span><br><span class="line">area 1</span><br><span class="line">network 1.1.1.1 0.0.0.0</span><br><span class="line">network 10.1.1.0 0.0.0.255</span><br></pre></td></tr></table></figure>

<p>RTB:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ospf</span><br><span class="line">ospf router id 2.2.2.2 </span><br><span class="line">area 1</span><br><span class="line">network 2.2.2.2 0.0.0.0</span><br><span class="line">network 10.1.1.0 0.0.0.255</span><br><span class="line"></span><br><span class="line">area 0</span><br><span class="line">network 10.1.2.0 0.0.0.255</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>RTC:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ospf</span><br><span class="line">ospf router id 3.3.3.3</span><br><span class="line"></span><br><span class="line">area 2</span><br><span class="line">network 3.3.3.3 0.0.0.0</span><br><span class="line">network 10.1.3.0 0.0.0.255</span><br><span class="line"></span><br><span class="line">area 0</span><br><span class="line">network 10.1.2.0 0.0.0.255</span><br></pre></td></tr></table></figure>

<p>RTD:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ospf</span><br><span class="line">ospf router id 4.4.4.4</span><br><span class="line"></span><br><span class="line">area 2</span><br><span class="line">network 4.4.4.4 0.0.0.0</span><br><span class="line">network 10.1.3.0 0.0.0.255</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dis ospf peer brief //查看邻居</span><br></pre></td></tr></table></figure>



<h4 id="邻居与邻接关系"><a href="#邻居与邻接关系" class="headerlink" title="邻居与邻接关系"></a>邻居与邻接关系</h4><p>点到点，点到播不选举DR BDR</p>
<p>邻居：2-way（只是知道对方存在）		邻接：full（相互交互LSA）</p>
<p>掩码不一致时，邻居关系建立不起来</p>
<img src="/2023/01/26/ICT%E7%AC%AC%E5%9B%9B%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221106152858574.png" class="" title="image-20221106152858574">

<h5 id="虚连接："><a href="#虚连接：" class="headerlink" title="虚连接："></a><strong>虚连接</strong>：</h5><p>让非主干区域连接到主干区域</p>
<p>使用情况：</p>
<p>​			（1）没有直接与主干区域连接</p>
<p>​               (2)   分割主干区域</p>
<p>​				(3）没有主干区域</p>
<p>​			   (4)区域备份</p>
<img src="/2023/01/26/ICT%E7%AC%AC%E5%9B%9B%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221106161029913.png" class="" title="image-20221106161029913">

<img src="/2023/01/26/ICT%E7%AC%AC%E5%9B%9B%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221106161047751.png" class="" title="image-20221106161047751">



<img src="/2023/01/26/ICT%E7%AC%AC%E5%9B%9B%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221106161128440.png" class="" title="image-20221106161128440">

<img src="/2023/01/26/ICT%E7%AC%AC%E5%9B%9B%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221106161203847.png" class="" title="image-20221106161203847">



<p>配置：哪个区域	哪个位置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dis ospf interface G0/0/0 </span><br></pre></td></tr></table></figure>

<h5 id="DR-BDR"><a href="#DR-BDR" class="headerlink" title="DR   BDR"></a>DR   BDR</h5><img src="ICT第四次笔记/image-20221106153857254.png" alt="image-20221106153857254"  />



<h6 id="选举DR-BDR"><a href="#选举DR-BDR" class="headerlink" title="选举DR BDR"></a>选举DR BDR</h6><p>DR（选完即止，不会进行多次选举）:</p>
<ol>
<li><p>比较优先级  大优先          (缺省100)       优先级为零时不参与选举</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ospf dr-priority xxx 修改端口的route优先级 </span><br></pre></td></tr></table></figure>


</li>
<li><p>比较router id     大优先     从左到右一位一位进行比较</p>
</li>
</ol>
<img src="/2023/01/26/ICT%E7%AC%AC%E5%9B%9B%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221106154634364.png" class="" title="image-20221106154634364">

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1.指定邻居关系</span><br><span class="line">ospf</span><br><span class="line">peer x.x.x.x  手动建立邻接状态</span><br><span class="line"></span><br><span class="line">2.改变网络连接方式</span><br><span class="line">int g0/0/0</span><br><span class="line">ospf network-type ?</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="OSPF报文"><a href="#OSPF报文" class="headerlink" title="OSPF报文"></a>OSPF报文</h4><p>使用IP承接OSPF报文  IP协议号为89</p>
<h5 id="OSPF报文头部"><a href="#OSPF报文头部" class="headerlink" title="OSPF报文头部"></a>OSPF报文头部</h5><img src="/2023/01/26/ICT%E7%AC%AC%E5%9B%9B%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221106163617325.png" class="" title="image-20221106163617325">

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">端口认证</span><br><span class="line">int g0/0/0</span><br><span class="line">ospf authentication-mode simple plain huawei  //配置认证 </span><br><span class="line"></span><br><span class="line">区域认证</span><br><span class="line">ospf</span><br><span class="line">area 0</span><br><span class="line">authentication-mode ?</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<img src="/2023/01/26/ICT%E7%AC%AC%E5%9B%9B%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221106164813602.png" class="" title="image-20221106164813602">

<img src="/2023/01/26/ICT%E7%AC%AC%E5%9B%9B%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221106165321234.png" class="" title="image-20221106165321234">

<p><strong>除Hello都有LSA</strong></p>
<img src="/2023/01/26/ICT%E7%AC%AC%E5%9B%9B%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221106165421377.png" class="" title="image-20221106165421377">

<p>一二类LSA作用：计算区域路由</p>
<img src="/2023/01/26/ICT%E7%AC%AC%E5%9B%9B%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221106165758655.png" class="" title="image-20221106165758655">

<img src="/2023/01/26/ICT%E7%AC%AC%E5%9B%9B%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221106170043153.png" class="" title="image-20221106170043153">

<p>第五类LSA在传播过程中不会发生改变</p>
<img src="/2023/01/26/ICT%E7%AC%AC%E5%9B%9B%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221106170441881.png" class="" title="image-20221106170441881">





<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dis ospf lsdb router self-orig   //查看 LSA</span><br></pre></td></tr></table></figure>

<img src="/2023/01/26/ICT%E7%AC%AC%E5%9B%9B%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221106170806148.png" class="" title="image-20221106170806148">

<img src="/2023/01/26/ICT%E7%AC%AC%E5%9B%9B%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221106170819822.png" class="" title="image-20221106170819822">

<h4 id="建立OSPF邻居与邻接关系"><a href="#建立OSPF邻居与邻接关系" class="headerlink" title="建立OSPF邻居与邻接关系"></a>建立OSPF邻居与邻接关系</h4><h5 id="HELLO包"><a href="#HELLO包" class="headerlink" title="HELLO包"></a>HELLO包</h5><img src="/2023/01/26/ICT%E7%AC%AC%E5%9B%9B%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221106181317274.png" class="" title="image-20221106181317274">

<img src="/2023/01/26/ICT%E7%AC%AC%E5%9B%9B%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221106181345055.png" class="" title="image-20221106181345055">

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">display ospf peer //查看邻居状态 </span><br></pre></td></tr></table></figure>

<h5 id="邻居状态变换（邻接关系）"><a href="#邻居状态变换（邻接关系）" class="headerlink" title="邻居状态变换（邻接关系）"></a>邻居状态变换（邻接关系）</h5><img src="/2023/01/26/ICT%E7%AC%AC%E5%9B%9B%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221106135137700.png" class="" title="image-20221106135137700">

<img src="/2023/01/26/ICT%E7%AC%AC%E5%9B%9B%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221106141138070.png" class="" title="image-20221106141138070"> 

<p>Down  	发送Hello包来进入Init状态</p>
<p>Attempt 	暂存状态，在收到包后进入Init状态</p>
<p>init		初始化状态	收到HELLO包回复后进入2-way</p>
<p>2-way	选举DR,BDR		一直选不出来可能是优先级都为0</p>
<p>2-way 	进入ExStart状态条件   （1）40s	（2）选出DR	BDR</p>
<p>ExStart	选择Master		隐式确认	从一直重复主发送的信息 </p>
<p>Exchange	交互列表信息，查看需要的信息 </p>
<p>Loading  	交互完整信息（LSA)</p>
<p>Full 			配置完成，信息交换完毕</p>
<p>​					在Full后，只需要Update完成更新。</p>
<img src="/2023/01/26/ICT%E7%AC%AC%E5%9B%9B%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221106183913407.png" class="" title="image-20221106183913407">

<img src="/2023/01/26/ICT%E7%AC%AC%E5%9B%9B%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221106215038425.png" class="" title="image-20221106215038425">

<img src="/2023/01/26/ICT%E7%AC%AC%E5%9B%9B%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221106215114407.png" class="" title="image-20221106215114407">

<h4 id="计算OSPF区域内路由"><a href="#计算OSPF区域内路由" class="headerlink" title="计算OSPF区域内路由"></a>计算OSPF区域内路由</h4><h5 id="LSDB"><a href="#LSDB" class="headerlink" title="LSDB"></a>LSDB</h5><h6 id="Stub网段（一般是环回口）"><a href="#Stub网段（一般是环回口）" class="headerlink" title="Stub网段（一般是环回口）"></a>Stub网段（一般是环回口）</h6><img src="/2023/01/26/ICT%E7%AC%AC%E5%9B%9B%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221106220927765.png" class="" title="image-20221106220927765">

<h6 id="Transit网段"><a href="#Transit网段" class="headerlink" title="Transit网段"></a>Transit网段</h6><p>有至少两台路由器的广播型网段或NBMA网段就是一种Transit网段</p>
<img src="/2023/01/26/ICT%E7%AC%AC%E5%9B%9B%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221106221148762.png" class="" title="image-20221106221148762">

<h6 id="点到点网段（point-to-point"><a href="#点到点网段（point-to-point" class="headerlink" title="点到点网段（point to point)"></a>点到点网段（point to point)</h6><h5 id="配置接口开销"><a href="#配置接口开销" class="headerlink" title="配置接口开销"></a>配置接口开销</h5><p>OSPF接口cost计算规则是：在接口下配置的cost值优先；如果没有在接口下配置cost，则cost&#x3D;参考带宽&#x2F;接口带宽。OSPF默认参考带宽为100M。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">1.接口下配置cost</span><br><span class="line">int g0/0/0 </span><br><span class="line">ospf cost x</span><br><span class="line"></span><br><span class="line">2.修改参考带宽</span><br><span class="line">ospf</span><br><span class="line">bandwidth-reference x   //bandwidth-reference默认为100M </span><br></pre></td></tr></table></figure>



<h4 id="一类LSA"><a href="#一类LSA" class="headerlink" title="一类LSA"></a>一类LSA</h4><img src="/2023/01/26/ICT%E7%AC%AC%E5%9B%9B%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221106222851452.png" class="" title="image-20221106222851452">

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dis ospf lsdb router self-originate    //查看1类LSA</span><br></pre></td></tr></table></figure>

<img src="/2023/01/26/ICT%E7%AC%AC%E5%9B%9B%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221106223122363.png" class="" title="image-20221106223122363">

<img src="/2023/01/26/ICT%E7%AC%AC%E5%9B%9B%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221106223317457.png" class="" title="image-20221106223317457">

<h6 id="使用Router-LSA描述点到点接口"><a href="#使用Router-LSA描述点到点接口" class="headerlink" title="使用Router-LSA描述点到点接口"></a>使用Router-LSA描述点到点接口</h6><img src="/2023/01/26/ICT%E7%AC%AC%E5%9B%9B%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221106223829499.png" class="" title="image-20221106223829499">

<p>stubnet</p>
<h6 id="使用Router-LSA描述广播型接口或NBMA接口"><a href="#使用Router-LSA描述广播型接口或NBMA接口" class="headerlink" title="使用Router-LSA描述广播型接口或NBMA接口"></a>使用Router-LSA描述广播型接口或NBMA接口</h6><p>TransNet</p>
<img src="/2023/01/26/ICT%E7%AC%AC%E5%9B%9B%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221107165345163.png" class="" title="image-20221107165345163">

<h5 id="二类LSA（Network"><a href="#二类LSA（Network" class="headerlink" title="二类LSA（Network)"></a>二类LSA（Network)</h5><h6 id="使用Router-LSA描述广播型接口或NBMA接口-1"><a href="#使用Router-LSA描述广播型接口或NBMA接口-1" class="headerlink" title="使用Router-LSA描述广播型接口或NBMA接口"></a>使用Router-LSA描述广播型接口或NBMA接口</h6><img src="/2023/01/26/ICT%E7%AC%AC%E5%9B%9B%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221107165529903.png" class="" title="image-20221107165529903">

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dis ospf lsdb router network   //查看1类LSA</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://lanyangyangy.github.io/2023/01/26/ICT%E7%AC%AC%E5%9B%9B%E6%AC%A1%E7%AC%94%E8%AE%B0/" data-id="cldfxvtaj000jvg9uc8282i2n" data-title="ICT第四次笔记" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ICT-%E6%95%B0%E9%80%9A/" rel="tag">ICT 数通</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-ICT第三次笔记" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/01/26/ICT%E7%AC%AC%E4%B8%89%E6%AC%A1%E7%AC%94%E8%AE%B0/" class="article-date">
  <time class="dt-published" datetime="2023-01-26T04:44:00.000Z" itemprop="datePublished">2023-01-26</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/01/26/ICT%E7%AC%AC%E4%B8%89%E6%AC%A1%E7%AC%94%E8%AE%B0/">ICT第三次笔记</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <blockquote>
<p>能复制粘贴就不要手写</p>
<p>主机ping通自己的网关不能排除什么问题</p>
</blockquote>
<img src="/2023/01/26/ICT%E7%AC%AC%E4%B8%89%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221022140119099.png" class="" title="image-20221022140119099">

<p> 对于一个STP网络，<strong>根桥在全网中只有一个</strong>，它是整个网络的逻辑中心，但不一定是物理中心。根桥会根据网络拓扑的变化而动态变化。</p>
<p>生成树的生成计算有两大基本度量依据：<strong>ID</strong>和<strong>路径开销</strong>。</p>
<p>ID&#x3D;BID(桥ID）+PID（端口ID)</p>
<p>BID桥优先级占据高16位，其余的低48位是MAC地址。</p>
<p>在一个STP网络中，某端口到根桥的路径开销就是所经过的各个桥上的出端口的路径开销累加而成，这个值叫做根路径开销。</p>
<p>$\textcolor{red}{在STP网络中，桥ID最小的设备会被选举为根桥。}$</p>
<p>生成树：802.1D       802.1W		802.1S </p>
<p>​                  STP           RSTP           MSTP</p>
<p><strong>根桥RB</strong></p>
<p>根桥就是网桥ID最小的桥，通过交互配置BPDU协议报文选出最小的BID。</p>
<p><strong>根端口RP</strong></p>
<p>所谓根端口就是去往根桥路径开销最小的端口，根端口负责向根桥方向转发数据，这个端口的选择标准是依据根路径开销判定。在一台设备上所有使能STP的端口中，根路径开销最小者，就是根端口。很显然，在一个运行STP协议的设备上根端口有且只有一个，根桥上没有根端口。</p>
<ol>
<li><p>比较根桥ID大小    </p>
</li>
<li><p>比较到达根桥累计路径开销 		GE开销为20000         XG 开销为2000		FA(百兆)开销为200000</p>
</li>
<li><p>比较邻接交换机的桥ID大小</p>
</li>
<li><p>比较发送端口ID大小     选小</p>
</li>
<li><p>比较自身端口ID</p>
<p>一根网线连接一个冲突域</p>
<p>根桥的端口一般都是指定端口。</p>
<p><strong>指定端口DP</strong></p>
<table>
<thead>
<tr>
<th>分类</th>
<th>指定桥</th>
<th>指定端口</th>
</tr>
</thead>
<tbody><tr>
<td>对于一台设备而言</td>
<td>与本机直接相连并且负责向本机转发配置消息的设备</td>
<td>指定桥向本机转发配置消息的端口</td>
</tr>
<tr>
<td>对于一个局域网而言</td>
<td>负责向本网段转发配置消息的设备</td>
<td>指定桥向本网段转发配置消息的端口</td>
</tr>
</tbody></table>
</li>
</ol>
<p>一旦根桥、根端口、指定端口选举成功，则整个树形拓扑建立完毕。在拓扑稳定后，只有根端口和指定端口转发流量，其他的非根非指定端口都处于阻塞（Blocking）状态，它们只接收STP协议报文而不转发用户流量。</p>
<p>华为默认MSTP</p>
<p>根桥开销为0，接收开销与发送开销无关。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">dis stp</span><br><span class="line"></span><br><span class="line">dis stp brief</span><br><span class="line"></span><br><span class="line">stp cost xxx 改开销</span><br><span class="line">stp pathcost-standard &#123; dot1d-1998 | dot1t | legacy &#125;  配置端口路径开销计算方法。</span><br><span class="line">stp bridge-diameter diameter 配置网络直径</span><br><span class="line"></span><br><span class="line">interface interface-type interface-number，进入参与生成树协议计算的接口视图。</span><br><span class="line">stp port priority  设置优先级 缺省情况下，交换设备的优先级取值是32768。</span><br><span class="line"></span><br><span class="line">stp timer-factor factor   配置未收到上游的BPDU就重新开始生成树计算的超时时间。</span><br><span class="line">缺省情况下，设备未收到上游的BPDU就重新开始生成树计算的超时时间是Hello Timer的9倍。</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="STP端口状态"><a href="#STP端口状态" class="headerlink" title="STP端口状态"></a>STP端口状态</h5><table>
<thead>
<tr>
<th>端口状态</th>
<th>目的</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>Forwarding</td>
<td>端口既转发用户流量也处理BPDU报文。</td>
<td>只有根端口或指定端口才能进入Forwarding状态。</td>
</tr>
<tr>
<td>Learning</td>
<td>设备会根据收到的用户流量构建MAC地址表，<strong>但不转发用户流量。</strong></td>
<td><strong>过渡状态</strong>，增加Learning状态防止临时环路。</td>
</tr>
<tr>
<td>Listening</td>
<td>确定端口角色，将选举出根桥、根端口和指定端口。</td>
<td><strong>过渡状态。</strong></td>
</tr>
<tr>
<td>Blocking</td>
<td>端口仅仅接收并处理BPDU，不转发用户流量。</td>
<td>阻塞端口的最终状态。</td>
</tr>
<tr>
<td>Disabled</td>
<td>端口不仅不处理BPDU报文，也不转发用户流量。</td>
<td>端口状态为Down。</td>
</tr>
</tbody></table>
<h5 id="MSTP端口状态"><a href="#MSTP端口状态" class="headerlink" title="MSTP端口状态"></a>MSTP端口状态</h5><table>
<thead>
<tr>
<th>端口状态</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>Forwarding</td>
<td>在这种状态下，端口既转发用户流量又处理BPDU报文。</td>
</tr>
<tr>
<td>Learning</td>
<td>这是一种过渡状态。在Learning下，交换设备会根据收到的用户流量，构建MAC地址表，但不转发用户流量，所以叫做学习状态。Learning状态的端口处理BPDU报文。</td>
</tr>
<tr>
<td>Discarding</td>
<td>Discarding状态的端口只接收BPDU报文。</td>
</tr>
</tbody></table>
<p>Discarding&#x3D;Listening+Blocking</p>
<h6 id="STP参数"><a href="#STP参数" class="headerlink" title="STP参数"></a>STP参数</h6><table>
<thead>
<tr>
<th>参数</th>
<th>缺省值</th>
<th>取值范围</th>
</tr>
</thead>
<tbody><tr>
<td>Hello Time</td>
<td>200厘秒（2秒）</td>
<td>100～1000</td>
</tr>
<tr>
<td>Max Age(老化时间)</td>
<td>2000厘秒（20秒）</td>
<td>600～4000</td>
</tr>
<tr>
<td>Forward Delay</td>
<td>1500厘秒（15秒）</td>
<td>400～3000</td>
</tr>
</tbody></table>
<p>一个老化时间20s,一个转发时间15s.</p>
<p>Learning+Listening&#x3D;30s</p>
<ul>
<li>TCN BPDU报文主要用来向上游设备乃至根桥通知拓扑变化。</li>
<li>置位的TCA标记的配置BPDU报文主要是上游设备用来告知下游设备已经知道拓扑变化，通知下游设备停止发送TCN BPDU报文。</li>
<li>置位的TC标记的配置BPDU报文主要是上游设备用来告知下游设备拓扑发生变化，请下游设备直接删除桥MAC地址表项，从而达到快速收敛的目的。</li>
</ul>
<p>在RSTP中检测拓扑是否发生变化只有一个标准：一个非边缘端口迁移到Forwarding状态。一旦检测到拓扑发生变化，将进行如下处理：</p>
<ul>
<li><p>为本交换设备的所有非边缘指定端口启动一个TC While Timer，该计时器值是Hello Time的两倍。</p>
</li>
<li><p>在这个时间内，清空所有端口上学习到的MAC地址。同时，由非边缘端口向外发送RST BPDU，其中TC置位。一旦TC While Timer超时，则停止发送RST BPDU。</p>
</li>
<li><p>其他交换设备接收到RST BPDU后，清空所有端口学习到MAC地址，除了收到RST BPDU的端口。然后也为自己所有的非边缘指定端口和根端口启动TC While Timer，重复上述过程。</p>
<p>$\textcolor{red}{RSTP的状态规范把原来的5种状态缩减为3种}$：</p>
</li>
<li><ul>
<li>如果不转发用户流量也不学习MAC地址，那么端口状态就是Discarding状态。</li>
<li>如果不转发用户流量但是学习MAC地址，那么端口状态就是Learning状态。</li>
<li>如果既转发用户流量又学习MAC地址，那么端口状态就是Forwarding状态。</li>
</ul>
</li>
</ul>
<p>支持STP&#x2F;RSTP的设备都有默认的配置，实际应用的配置可以基于默认配置进行修改。</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>缺省值</th>
</tr>
</thead>
<tbody><tr>
<td>生成树协议工作模式</td>
<td>MSTP模式</td>
</tr>
<tr>
<td>STP&#x2F;RSTP功能</td>
<td>全局STP&#x2F;RSTP功能使能，端口的STP&#x2F;RSTP功能使能。</td>
</tr>
<tr>
<td>交换设备的优先级</td>
<td>32768</td>
</tr>
<tr>
<td>端口的优先级</td>
<td>128</td>
</tr>
<tr>
<td>路径开销的计算方法</td>
<td>Dot1t，即IEEE 802.1t标准</td>
</tr>
<tr>
<td>Forward Delay Time</td>
<td>1500厘秒（15秒）</td>
</tr>
<tr>
<td>Hello Time</td>
<td>200厘秒（2秒）</td>
</tr>
<tr>
<td>Max Age Time</td>
<td>2000厘秒（20秒）</td>
</tr>
</tbody></table>
<h5 id="将设备配置为根桥："><a href="#将设备配置为根桥：" class="headerlink" title="将设备配置为根桥："></a>将设备配置为根桥：</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">system-view</span><br><span class="line">stp root primary   配置当前设备为根桥设备。</span><br><span class="line">缺省情况下，交换设备不作为任何生成树的根桥。配置后该设备优先级数值自动为0，并且不能更改设备优先级。</span><br></pre></td></tr></table></figure>

<h5 id="将设备配置为备份根桥："><a href="#将设备配置为备份根桥：" class="headerlink" title="将设备配置为备份根桥："></a>将设备配置为备份根桥：</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">system-view</span><br><span class="line">stp root secondary</span><br><span class="line">缺省情况下，交换设备不作为任何生成树的备份根桥。配置后该设备优先级数值为4096，并且不能更改设备优先级。</span><br></pre></td></tr></table></figure>



<h4 id="MSTP"><a href="#MSTP" class="headerlink" title="MSTP"></a>MSTP</h4><p><strong>要想设备处于同一MSTP域</strong>，需要：</p>
<ol>
<li>都启动了MSTP;</li>
<li>具有相同的域名；</li>
<li>具有相同的VLAN到生成树实例映射到配置；</li>
<li>具有相同的MSTP修订级别配置。</li>
</ol>
<p>VLAN默认在实例1</p>
<p><strong>配置代码</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">SW1,2,3:</span><br><span class="line">vlan batch 10 20</span><br><span class="line">SW1,2,3:</span><br><span class="line">interface GigabitEthernet 0/0/1</span><br><span class="line">port link-type trunk</span><br><span class="line">port trunk allow-pass vlan 10 20</span><br><span class="line">interface GigabitEthernet 0/0/2</span><br><span class="line">port link-type trunk</span><br><span class="line">port trunk allow-pass vlan 10 20</span><br><span class="line">SW1,2,3:</span><br><span class="line">stp region-configuration </span><br><span class="line">region-name benben #MSTP域名</span><br><span class="line">instance 10 vlan 10</span><br><span class="line">instance 20 vlan 20 #实例到vlan的映射</span><br><span class="line">revision-level 1 #配置修改号</span><br><span class="line">active region-configuration</span><br><span class="line">SW1：</span><br><span class="line">stp instance 10 priority 0</span><br><span class="line">SW2:</span><br><span class="line">stp instance 20 priority 0</span><br></pre></td></tr></table></figure>

<p>MSTI是所有运行STP&#x2F;RSTP&#x2F;MSTP的交换设备经MSTP协议计算后形成的树状网络。</p>
<p>MST域是多生成树域，由交换网络中的多台交换设备以及它们之间的网段所构成。</p>
<p>一个局域网可以存在多个MST域，各MST域之间在物理上直接或间接相连。<strong>用户可以通过MSTP配置命令把多台交换设备划分在同一个MST域内。</strong></p>
<h5 id="域根"><a href="#域根" class="headerlink" title="域根"></a>域根</h5><p>域根（RegionalRoot）分为IST（Internal Spanning Tree）域根和MSTI域根。</p>
<h6 id="IST域根"><a href="#IST域根" class="headerlink" title="IST域根"></a>IST域根</h6><p>IST在B0、C0和D0中，IST生成树中距离总根（CISTRoot）最近的交换设备是IST域根。</p>
<img src="/2023/01/26/ICT%E7%AC%AC%E4%B8%89%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221026231416465.png" class="" title="image-20221026231416465">



<h6 id="MSTI域根"><a href="#MSTI域根" class="headerlink" title="MSTI域根"></a>MSTI域根</h6><p>一个MST域内可以生成多棵生成树，每棵生成树都称为一个MSTI。MSTI域根是每个多生成树实例的树根。域中不同的MSTI有各自的域根。</p>
<img src="/2023/01/26/ICT%E7%AC%AC%E4%B8%89%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221026231126077.png" class="" title="image-20221026231126077">

<p><strong>MSTI之间彼此独立，MSTI可以与一个或者多个VLAN对应。但一个VLAN只能与一个MSTI对应。</strong></p>
<h6 id="主桥"><a href="#主桥" class="headerlink" title="主桥"></a><strong>主桥</strong></h6><p>主桥（Master Bridge）也就是ISTMaster，它是域内距离总根最近的交换设备。如<a target="_blank" rel="noopener" href="https://support.huawei.com/enterprise/zh/doc/EDOC1100075491/f7e8e63c#fig_dc_fd_stp_001202">图10-4</a>中的S1。</p>
<p>如果总根在MST域中，则总根为该域的主桥。</p>
<h6 id="CST"><a href="#CST" class="headerlink" title="CST"></a>CST</h6><p>公共生成树CST（CommonSpanning Tree）是连接交换网络内所有MST域的一棵生成树。</p>
<p><strong>IST</strong></p>
<p>内部生成树IST（InternalSpanning Tree）是各MST域内的一棵生成树。</p>
<p>IST是一个特殊的MSTI，MSTI的ID为0，通常称为MSTI0。</p>
<p>IST是CIST在MST域中的一个片段。</p>
<p><strong>SST构成单生成树SST（SingleSpanning Tree）有两种情况：</strong></p>
<ul>
<li>运行STP或RSTP的交换设备只能属于一个生成树。</li>
<li>MST域中只有一个交换设备，这个交换设备构成单生成树。</li>
</ul>
<h5 id="端口角色"><a href="#端口角色" class="headerlink" title="端口角色"></a>端口角色</h5><p>MSTP的端口角色共有7种：根端口、指定端口、Alternate端口、Backup端口、边缘端口、Master端口和域边缘端口</p>
<table>
<thead>
<tr>
<th>端口角色</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>根端口</td>
<td>在非根桥上，离根桥最近的端口是本交换设备的根端口。根交换设备没有根端口。根端口负责向树根方向转发数据。</td>
</tr>
<tr>
<td>指定端口</td>
<td>对一台交换设备而言，它的指定端口是向下游交换设备转发BPDU报文的端口。</td>
</tr>
<tr>
<td>Alternate端口</td>
<td>从配置BPDU报文发送角度来看，Alternate端口就是由于学习到其它网桥发送的配置BPDU报文而阻塞的端口。从用户流量角度来看，Alternate端口提供了从指定桥到根的另一条可切换路径，作为根端口的备份端口。</td>
</tr>
<tr>
<td>Backup端口</td>
<td>从配置BPDU报文发送角度来看，Backup端口就是由于学习到自己发送的配置BPDU报文而阻塞的端口。从用户流量角度来看，Backup端口作为指定端口的备份，提供了另外一条从根节点到叶节点的备份通路。</td>
</tr>
<tr>
<td>Master端口</td>
<td>Master端口是MST域和总根相连的所有路径中最短路径上的端口，它是交换设备上连接MST域到总根的端口。Master端口是域中的报文去往总根的必经之路。Master端口是特殊域边缘端口，Master端口在CIST上的角色是RootPort，在其它各实例上的角色都是Master端口。</td>
</tr>
<tr>
<td>域边缘端口</td>
<td>域边缘端口是指位于MST域的边缘并连接其它MST域或SST的端口。进行MSTP计算时，域边缘端口在MSTI上的角色和CIST实例的角色保持一致。即如果边缘端口在CIST实例上的角色是Master端口（域和总根相连的所有路径中最短路径上的端口），则它在域内所有MSTI上的角色也是Master端口。</td>
</tr>
<tr>
<td>边缘端口</td>
<td>如果指定端口位于整个域的边缘，不再与任何交换设备连接，这种端口叫做边缘端口。边缘端口一般与用户终端设备直接连接。端口使能MSTP功能后，会默认启用边缘端口自动探测功能，当端口在（2 × Hello Timer +1）秒的时间内收不到BPDU报文，自动将端口设置为边缘端口，否则设置为非边缘端口。</td>
</tr>
</tbody></table>
<h5 id="端口状态和端口角色对应表"><a href="#端口状态和端口角色对应表" class="headerlink" title="端口状态和端口角色对应表"></a>端口状态和端口角色对应表</h5><table>
<thead>
<tr>
<th>端口状态</th>
<th>根端口&#x2F;Master端口</th>
<th>指定端口</th>
<th>域边缘端口</th>
<th>Alternate端口</th>
<th>Backup端口</th>
</tr>
</thead>
<tbody><tr>
<td>Forwarding</td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td>No</td>
<td>No</td>
</tr>
<tr>
<td>Learning</td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td>No</td>
<td>No</td>
</tr>
<tr>
<td>Discarding</td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
</tr>
</tbody></table>
<ul>
<li><h6 id="优先级"><a href="#优先级" class="headerlink" title="优先级"></a>优先级</h6></li>
<li><p>参与CIST计算的优先级向量为：</p>
</li>
</ul>
<p>{ 根交换设备ID，外部路径开销，域根ID，内部路径开销，指定交换设备ID，指定端口ID，接收端口ID}</p>
<ul>
<li><ul>
<li>参与MSTI计算的优先级向量为：</li>
</ul>
</li>
</ul>
<p>{ 域根ID，内部路径开销，指定交换设备ID，指定端口ID，接收端口ID}</p>
<p><strong>同一向量比较，值最小的向量具有最高优先级。</strong></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://lanyangyangy.github.io/2023/01/26/ICT%E7%AC%AC%E4%B8%89%E6%AC%A1%E7%AC%94%E8%AE%B0/" data-id="cldfxvtaa0004vg9ugutq423m" data-title="ICT第三次笔记" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ICT-%E6%95%B0%E9%80%9A/" rel="tag">ICT 数通</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-ICT第二次笔记" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/01/26/ICT%E7%AC%AC%E4%BA%8C%E6%AC%A1%E7%AC%94%E8%AE%B0/" class="article-date">
  <time class="dt-published" datetime="2023-01-26T04:43:49.000Z" itemprop="datePublished">2023-01-26</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/01/26/ICT%E7%AC%AC%E4%BA%8C%E6%AC%A1%E7%AC%94%E8%AE%B0/">ICT第二次笔记</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="第二次笔记"><a href="#第二次笔记" class="headerlink" title="第二次笔记"></a>第二次笔记</h2><h4 id="DHCP"><a href="#DHCP" class="headerlink" title="DHCP:"></a>DHCP:</h4><p>DHCP特点：即插即用 	统一管理 	使用效率高    可跨网段实现</p>
<p>DHCP地址分配：手工分配 	自动分配	动态分配</p>
<p>操作：<br>一、基于端口DHCP</p>
<p>1.使能DHCP服务</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei]dhcp enable </span><br></pre></td></tr></table></figure>

<p>2.配置路由器端口的ip地址</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[Huawei]int g0/0/0</span><br><span class="line">[Huawei-GigabitEthernet0/0/0]ip add 10.1.1.1 24</span><br></pre></td></tr></table></figure>

<p>3.、在<strong>路由器端口</strong>配置一个地址池，也就是网段，其中包含：<strong>网段</strong>、<strong>网关</strong>、<strong>dns地址</strong>、<strong>租约时间</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[Huawei-GigabitEthernet0/0/0]dhcp select interface </span><br><span class="line">[Huawei-GigabitEthernet0/0/0]dhcp server dns-list 114.114.114.114    #分配DNS服务器</span><br><span class="line">[Huawei-GigabitEthernet0/0/0]dhcp server lease day 0 hour 2   #租约时间为2小时</span><br><span class="line">[Huawei-GigabitEthernet0/0/0]dhcp server excluded-ip-address 10.1.1.200 10.1.1.254  #排除200到254之间所有ip地址</span><br></pre></td></tr></table></figure>

<p>4.输入<strong>display ip pool</strong>查看dhcp服务信息，可以看到名称、网段、子网掩码以及IP地址总数和已使用的IP地址数量等信息</p>
<p>###在客户机上查看分配的dhcp信息，可以看到有IP地址、子网掩码、网关和dns地址（mac是本机网卡的）</p>
<p>二、基于全局DHCP</p>
<p>1.使能DHCP服务</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei]dhcp enable </span><br></pre></td></tr></table></figure>

<p>2.配置DHCP地址池</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[R3]ip pool 1                 创建地址池和名称 1</span><br><span class="line"></span><br><span class="line">[R3-ip-pool-1]network 10.1.1.0 mask 24        设置IP地址网段</span><br><span class="line"></span><br><span class="line">[R3-ip-pool-1]gateway-list 10.1.1.1       设置网关</span><br><span class="line"></span><br><span class="line">[R3-ip-pool-1]dns-list 114.114.114.114        设置DNS服务器</span><br><span class="line"></span><br><span class="line">[R3-ip-pool-1]lease day 2               租约时间2天</span><br><span class="line">[R3-ip-pool-1]excluded-ip-address 10.1.1.200 10.1.1.254     #排除200到254，不进行dhcp分配</span><br></pre></td></tr></table></figure>

<p>3.路由器端口配置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[R3] int e0/0/1</span><br><span class="line">[R3-Ethernet0/0/1]dhcp select global   设置全局</span><br><span class="line">[R3-Ethernet0/0/1]ip address 192.168.1.254 24        给接口设置IP地址</span><br></pre></td></tr></table></figure>



<p>三、DHCP中继</p>
<p>DHCP中继，其实就是在与DHCP Server不同而又需要申请DHCP服务的网络内，设置一个中继器，中继器在该网络中代替DHCP Server服务器接收DHCP Client的请求，并将DHCP Client发给DHCP Server的DCHP报文，以单播的形式发送给DHCP Server。DHCP Server在收到由DHCP发送来的DHCP 报文后，同样会把响应的DHCP报文发送给DHCP 中继。这样，DHCP其实是充当了一个中间人的作用，起到了在不同的网络中运行DHCP的目的。</p>
<img src="/2023/01/26/ICT%E7%AC%AC%E4%BA%8C%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221015224338853.png" class="" title="image-20221015224338853">

<hr>
<img src="/2023/01/26/ICT%E7%AC%AC%E4%BA%8C%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221015202829829.png" class="" title="image-20221015202829829">

<p>DHCP服务器：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">1.给路由端口配置IP地址</span><br><span class="line">&lt;Huawei&gt;sys</span><br><span class="line">[Huawei]int g0/0/0</span><br><span class="line">[Huawei-GigabitEthernet0/0/0]ip add 10.0.0.1 24</span><br><span class="line"></span><br><span class="line">2.配置一段路由（可静可动）</span><br><span class="line"></span><br><span class="line">[Huawei]ip route-static 192.168.1.0 255.255.255.0 10.0.0.2</span><br><span class="line"></span><br><span class="line">3.启用dhcp服务并配置一个dhcp池</span><br><span class="line">[Huawei]dhcp enable</span><br><span class="line">[Huawei]ip pool pool1</span><br><span class="line">[Huawei-ip-pool-pool1]network 192.168.1.0 mask 24</span><br><span class="line">[Huawei-ip-pool-pool1]gateway 192.168.1.254</span><br><span class="line">[Huawei-ip-pool-pool1]dns 192.168.1.100</span><br><span class="line">[Huawei-ip-pool-pool1]excluded-ip-address 192.168.1.100 192.168.1.120</span><br><span class="line">[Huawei-ip-pool-pool1]lease day 1</span><br><span class="line"></span><br><span class="line">4.在路由端口开启全局dhcp服务</span><br><span class="line"></span><br><span class="line">[Huawei]int g0/0/0</span><br><span class="line">[Huawei-GigabitEthernet0/0/0]dhcp select global </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>网关路由：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;Huawei&gt;sys</span><br><span class="line"></span><br><span class="line">1.配置与服务器（server)连接的端口IP地址（此地址要与服务器端口在同一网段上）</span><br><span class="line">[Huawei]int g0/0/0</span><br><span class="line">[Huawei-GigabitEthernet0/0/0]ip add 10.0.0.2 24</span><br><span class="line"></span><br><span class="line">2.配置与交换机连接的端口IP地址</span><br><span class="line">[Huawei-GigabitEthernet0/0/1]ip add 192.168.1.254 24</span><br><span class="line">3.在路由器(client)端口（不一定是网关）做代理，并且要指明要代理哪个dhcp服务器的端口</span><br><span class="line">[Huawei-GigabitEthernet0/0/1]dhcp select relay</span><br><span class="line">[Huawei-GigabitEthernet0/0/1]dhcp relay server-ip 10.0.0.1</span><br></pre></td></tr></table></figure>



<h4 id="LLDP协议"><a href="#LLDP协议" class="headerlink" title="LLDP协议"></a>LLDP协议</h4><p>查看与自己连接设备是什么</p>
<p>使用：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">1.启用LLDP</span><br><span class="line">lldp enable </span><br><span class="line">2.自动探测</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">查看lldp协议简要信息：</span><br><span class="line">[AR1]display lldp neighbor brief </span><br><span class="line">Local Intf   Neighbor Dev             Neighbor Intf             Exptime</span><br><span class="line">GE0/0/0      SW1                      GE0/0/3                   110    </span><br><span class="line">GE0/0/1      DHCP SERVER              GE0/0/0                   117  </span><br><span class="line">本地接口      对端设备名称             对端连接接口              老化时间（小于90时会发送请求，更新回120）</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">查看接口邻居详细信息</span><br><span class="line">[AR1]display lldp neighbor interface g0/0/0</span><br><span class="line">GigabitEthernet0/0/0 has 1 neighbors:</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Neighbor index : 1</span><br><span class="line">Chassis type   :macAddress </span><br><span class="line">Chassis ID     :4c1f-cc1a-2762 </span><br><span class="line">Port ID type   :interfaceName </span><br><span class="line">Port ID        :GigabitEthernet0/0/3     #邻居直连的接口号</span><br><span class="line">Port description    :NA                  #是否有接口描述，有的话内容是什么</span><br><span class="line">System name         :SW1                 #设备名称</span><br><span class="line">System description  :S5700-28C-HI        #设备型号</span><br><span class="line">Huawei Versatile Routing Platform Software </span><br><span class="line"> VRP (R) software,Version 3.30 (S5700 V200R001C00)     #系统版本信息</span><br><span class="line"> Copyright (C) 2007 Huawei Technologies Co., Ltd.</span><br><span class="line">System capabilities supported   :bridge </span><br><span class="line">System capabilities enabled     :bridge </span><br><span class="line">Management address type  :all802</span><br><span class="line">Management address       : 4c1f-cc1a-2762       #没有配置管理ip就显示mac</span><br><span class="line">Management address type  :ipV4</span><br><span class="line">Management address       : 10.1.1.166           #此处显示的是管理ip</span><br><span class="line">Expired time   :110s</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Auto-negotiation supported    :No </span><br><span class="line">Auto-negotiation enabled      :No</span><br><span class="line">OperMau   :speed(0)/duplex(Half)</span><br><span class="line">                                          </span><br><span class="line">Power port class         :PD </span><br><span class="line">PSE power supported      :No </span><br><span class="line">PSE power enabled        :No </span><br><span class="line">PSE pairs control ability:No </span><br><span class="line">Power pairs              :Unknown </span><br><span class="line">Port power classification:Unknown</span><br><span class="line"></span><br><span class="line">Link aggregation supported:Yes </span><br><span class="line">Link aggregation enabled :No </span><br><span class="line">Aggregation port ID      :0 </span><br><span class="line">Maximum frame Size       :9216</span><br><span class="line"></span><br><span class="line">MED Device information             </span><br><span class="line">Device class   :Network Connectivity</span><br><span class="line"></span><br><span class="line">HardwareRev       :VER B</span><br><span class="line">FirmwareRev       :NA</span><br><span class="line">SoftwareRev       :Version 3.30 V200R001C00</span><br><span class="line">SerialNum         :NA</span><br><span class="line">Manufacturer name :HUAWEI TECH CO., LTD</span><br><span class="line">Model name        :NA</span><br><span class="line">Asset tracking identifier :NA</span><br><span class="line"></span><br><span class="line">Power Type               :Unknown         </span><br><span class="line">PoE PSE power source     :Unknown </span><br><span class="line">Port PSE Priority        :Unknown </span><br><span class="line">Port Available power value:2</span><br></pre></td></tr></table></figure>





<h4 id="以太网交口技术"><a href="#以太网交口技术" class="headerlink" title="以太网交口技术"></a>以太网交口技术</h4><p>以太网接口的双工模式：</p>
<ul>
<li>全双工：端口同时发送和接收数据包</li>
<li>半双工：端口同一时刻只能发送数据包或接收数据包</li>
<li><strong>自协商</strong>：端口双工状态由本端口和对端端口自动协商而定</li>
</ul>
<p>以太网光接口只能工作在全双工模式下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">duplex&#123;full|half&#125; 设置双工模式</span><br><span class="line">undo duplex 恢复双工模式为缺省值</span><br><span class="line">negotiation auto 开启接口自动协商功能（默认开启）</span><br></pre></td></tr></table></figure>



<h5 id="端口聚合"><a href="#端口聚合" class="headerlink" title="端口聚合"></a>端口聚合</h5><p>端口聚合的优点：</p>
<p>提高链路带宽</p>
<p>流量负载分担</p>
<p>提高可靠性：同组成员彼此动态备份</p>
<p>手工模式：</p>
<img src="/2023/01/26/ICT%E7%AC%AC%E4%BA%8C%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221016110740335.png" class="" title="image-20221016110740335">

<p>SW1:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[SW1]interface Eth-Trunk 1</span><br><span class="line">[SW1-Eth-Trunk1]mode manual load-balance //选择为手动负载分担，缺省即为手工模式，可不配置</span><br><span class="line">[SW1-Eth-Trunk1]load-balance ? //查看可配置的模式，缺省为src-dst-ip，</span><br><span class="line"></span><br><span class="line">dst-ip According to destination IP hash arithmetic</span><br><span class="line">dst-mac According to destination MAC hash arithmetic</span><br><span class="line">src-dst-ip According to source/destination IP hash arithmetic //缺省的配置</span><br><span class="line">src-dst-mac According to source/destination MAC hash arithmetic</span><br><span class="line">src-ip According to source IP hash arithmetic</span><br><span class="line">src-mac According to source MAC hash arithmetic</span><br><span class="line"></span><br><span class="line">[SW1-Eth-Trunk1]load-balance src-dst-ip //此处使用src-dst-ip</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">方法一：</span><br><span class="line"></span><br><span class="line">[SW1-Eth-Trunk1]trunkport GigabitEthernet 0/0/1 to 0/0/2 //把GE0/0/1到GE0/0/2加入</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">方法二：</span><br><span class="line"></span><br><span class="line">[Huawei]interface g0/0/1</span><br><span class="line">[Huawei-GigabitEthernet0/0/1]eth-trunk 1 </span><br><span class="line"></span><br><span class="line">[Huawei-GigabitEthernet0/0/1]inter g0/0/2</span><br><span class="line">[Huawei-GigabitEthernet0/0/2]eth-trunk 1 </span><br></pre></td></tr></table></figure>

<p>SW2的配置与SW1的配置相同</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">display eth-trunk 1   使用该命令可以查看配置后的情况</span><br></pre></td></tr></table></figure>



<h4 id="LACP模式"><a href="#LACP模式" class="headerlink" title="LACP模式"></a><strong>LACP模式</strong></h4><p>在LACP模式下，部分链路是活动链路，所有活动链路均参与数据转发。如果某条活动链路故障，链路聚合组自动在非活动链路中选择一条链路作为活动链路，来参与数据转发。</p>
<img src="/2023/01/26/ICT%E7%AC%AC%E4%BA%8C%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221016140056246.png" class="" title="image-20221016140056246">

<p>SW1:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[SW1]interface Eth-Trunk 2 //创建eth-trunk 2聚合口</span><br><span class="line">[SW1-Eth-Trunk2]mode lacp-static //配置模式为lacp静态模式</span><br><span class="line">[SW1-Eth-Trunk2]trunkport GigabitEthernet 0/0/1 to 0/0/3 //把GE0/0/1 到GE0/0/3加入到聚合组</span><br><span class="line"></span><br><span class="line">[SW1]lacp priority 100        在SW1上配置系统优先级为100，使其成为LACP主动端</span><br><span class="line">[SW1]interface Eth-Trunk 2    在SW1上配置活动接口上限阈值为2</span><br><span class="line">[SW1-Eth-Trunk2]max active-linknumber 2</span><br><span class="line"></span><br><span class="line">在SW1进入物理接口配置接口优先级，确定活动链路，此处只配置GE1和GE2口，GE3口保持默认值32768。</span><br><span class="line">[SW1]interface GigabitEthernet 0/0/1</span><br><span class="line">[SW1-GigabitEthernet0/0/1]lacp priority 100</span><br><span class="line">[SW1]interface GigabitEthernet 0/0/2</span><br><span class="line">[SW1-GigabitEthernet0/0/2]lacp priority 100</span><br></pre></td></tr></table></figure>



<p>SW2:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[SW2]interface Eth-Trunk 2</span><br><span class="line">[SW2-Eth-Trunk2]mode lacp-static //配置模式为lacp静态模式</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">分别把GE0/0/1、GE0/0/2、GE0/0/3加入到聚合口（此处采用的另一种方法，不是批量加入了）</span><br><span class="line">[SW2]interface GigabitEthernet 0/0/1</span><br><span class="line">[SW2-GigabitEthernet0/0/1]eth-trunk 2</span><br><span class="line">[SW2]interface GigabitEthernet 0/0/2</span><br><span class="line">[SW2-GigabitEthernet0/0/2]eth-trunk 2</span><br><span class="line">[SW2]interface GigabitEthernet 0/0/3</span><br><span class="line">[SW2-GigabitEthernet0/0/3]eth-trunk 2</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">SW2上优先级保持默认，在SW2上配置活动接口上限阈值为2</span><br><span class="line">[SW2]interface Eth-Trunk 2</span><br><span class="line">[SW2-Eth-Trunk2]max active-linknumber 2</span><br></pre></td></tr></table></figure>





<h4 id="VLAN"><a href="#VLAN" class="headerlink" title="VLAN"></a>VLAN</h4><p>VLAN产生原因缺少转发控制手段的以太网 ，隔离其他广播域。</p>
<p>一个VLAN&#x3D;一个广播域&#x3D;一个独立网段</p>
<p>交换机上所有接口默认都在VLAN1上</p>
<h6 id="单交换机VLAN划分"><a href="#单交换机VLAN划分" class="headerlink" title="单交换机VLAN划分"></a>单交换机VLAN划分</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[Huawei]vlan 2</span><br><span class="line">[Huawei-vlan2]quit</span><br><span class="line">[Huawei]inter g0/0/2</span><br><span class="line">[Huawei-GigabitEthernet0/0/2]port link-type access   #交换机端口工作模式：access（PC,终端设备），trunk（和交换机互联）</span><br><span class="line">[Huawei-GigabitEthernet0/0/2]port default vlan 2     #将端口划入vlan2 </span><br></pre></td></tr></table></figure>

<p><strong>display vlan</strong>   检查VLAN划分</p>
<h6 id="多个交换机VLAN划分"><a href="#多个交换机VLAN划分" class="headerlink" title="多个交换机VLAN划分"></a>多个交换机VLAN划分</h6><p>该接口是交换机与交换机连接端口</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[Huawei]interface g0/0/4</span><br><span class="line"></span><br><span class="line">[Huawei-GigabitEthernet0/0/4]port link-type trunk       #默认情况下只允许vlan1 通过</span><br><span class="line">[Huawei-GigabitEthernet0/0/4]port trunk allow-pass vlan 1 2   #允许vlan1 和vlan2 同时通过trunk接口</span><br></pre></td></tr></table></figure>



<h6 id="修改trunk链路本征（本来特征，PVID）"><a href="#修改trunk链路本征（本来特征，PVID）" class="headerlink" title="修改trunk链路本征（本来特征，PVID）"></a>修改trunk链路本征（本来特征，PVID）</h6><p>配置PVID后，如果不是划分的pvid vlan 号就会打上vlan标签</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[Huawei]vlan 99 </span><br><span class="line">[Huawei-vlan99]inter g0/0/4</span><br><span class="line">[Huawei-GigabitEthernet0/0/4]port trunk pvid vlan 99</span><br></pre></td></tr></table></figure>





<h6 id="配置SVI"><a href="#配置SVI" class="headerlink" title="配置SVI"></a>配置SVI</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">interface Vlanif10  创建交换机虚拟接口(SVI) vlanif 10，属于三层接口，10 代表vlan 10 </span><br><span class="line">ip address 192.168.10.1 255.255.255.0 配置ip地址作为vlan 10 用户的网关</span><br><span class="line"></span><br></pre></td></tr></table></figure>











<h2 id="江老师小课堂——-textcolor-red-ping详解"><a href="#江老师小课堂——-textcolor-red-ping详解" class="headerlink" title="江老师小课堂——$\textcolor{red}{ping详解}$"></a>江老师小课堂——$\textcolor{red}{ping详解}$</h2><p><strong>ping</strong>可以理解为是一个应用程序，位于用户应用层（在系统应用层上方）</p>
<p>当发送ping命令后，主机会通过<strong>ICMP报文</strong>来封装信息</p>
<img src="ICT第二次笔记/image-20221011151208114.png" alt="image-20221011151208114" style="zoom:150%;" />

<p>ICMP报文会封装在<strong>IP数据报</strong>中，此时IP数据报中有一个标识位(RFC)为<strong>1</strong></p>
<blockquote>
<p>协议                 RFC</p>
<p>TCP					6</p>
<p>UDP				  17</p>
<p>ICMP				1</p>
<p>IGMP				2</p>
<p>OSPF                89</p>
</blockquote>
<img src="ICT第二次笔记/image-20221011155152139.png" alt="image-20221011155152139" style="zoom:150%;" />

<p>但是在第一次ping的时候，并不知道对方的MAC地址，帧无法发送。这是主机会发送一道帧（里面封装的是<strong>ARP报文</strong>），【交换机会记录源MAC地址】交换机接收到这道帧后，会立即泛洪，各个主机会查看是否是自己的IP地址，若是则会回应相同格式的帧，发送自己的MAC地址。交换机也会记录目的MAC。</p>
<p><strong>请求：</strong></p>
<img src="/2023/01/26/ICT%E7%AC%AC%E4%BA%8C%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221011162258243.png" class="">

<p>此时目的MAC里面装的是全0.</p>
<p><strong>响应</strong>：</p>
<img src="/2023/01/26/ICT%E7%AC%AC%E4%BA%8C%E6%AC%A1%E7%AC%94%E8%AE%B0/image-20221011162153475.png" class="" title="image-20221011162153475">

<p>源主机收到响应帧后会更新<strong>ARP表</strong>（里面记录的是MAC地址和IP地址的对应关系），在得到了目的MAC地址后，源主机可以将封装ICMP报文的帧补全，并发送出去。</p>
<p>至此Ping完成。</p>
<p>注意：</p>
<ol>
<li>ARP缓存表中，只存有IP和MAC的对应关系，主机并不需要知道到底目的主机到底是哪台，名字只是认为添加的。</li>
<li>主机是无法发送信息给交换机的，因此交换机发现帧的目的地址是自己时就会直接把帧丢弃。</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://lanyangyangy.github.io/2023/01/26/ICT%E7%AC%AC%E4%BA%8C%E6%AC%A1%E7%AC%94%E8%AE%B0/" data-id="cldfxvtab0005vg9u0b1v0m4u" data-title="ICT第二次笔记" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ICT-%E6%95%B0%E9%80%9A/" rel="tag">ICT 数通</a></li></ul>

    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/ICT-%E6%95%B0%E9%80%9A/" rel="tag">ICT 数通</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/numpy/" rel="tag">numpy</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python-%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/" rel="tag">python 面向对象</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/ICT-%E6%95%B0%E9%80%9A/" style="font-size: 20px;">ICT 数通</a> <a href="/tags/numpy/" style="font-size: 10px;">numpy</a> <a href="/tags/python-%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/" style="font-size: 10px;">python 面向对象</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/01/">January 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/12/">December 2022</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2023/01/26/ICT%E7%AC%AC%E5%8D%81%E4%B8%80%E6%AC%A1%E7%AC%94%E8%AE%B0/">ICT第十一次笔记</a>
          </li>
        
          <li>
            <a href="/2023/01/26/ICT%E7%AC%AC%E5%8D%81%E6%AC%A1%E7%AC%94%E8%AE%B0/">ICT第十次笔记</a>
          </li>
        
          <li>
            <a href="/2023/01/26/ICT%E7%AC%AC%E4%B9%9D%E6%AC%A1%E7%AC%94%E8%AE%B0/">ICT第九次笔记</a>
          </li>
        
          <li>
            <a href="/2023/01/26/ICT%E7%AC%AC%E5%85%AB%E6%AC%A1%E7%AC%94%E8%AE%B0/">ICT第八次笔记</a>
          </li>
        
          <li>
            <a href="/2023/01/26/ICT%E7%AC%AC%E4%B8%83%E6%AC%A1%E7%AC%94%E8%AE%B0/">ICT第七次笔记</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2023 懒懒当大厨<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>